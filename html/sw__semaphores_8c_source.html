<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>sw_semaphores.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_6aeebb853ebd8c514e6186653c592c82.html">otzone</a></li><li class="navelem"><a class="el" href="dir_fb44076c8b62c63869cf8a830933e50d.html">src</a></li><li class="navelem"><a class="el" href="dir_2d945ebfca6299adda500e2943a81344.html">lib</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">sw_semaphores.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="sw__semaphores_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* </span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment"> * OpenVirtualization: </span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment"> * For additional details and support contact developer@sierraware.com.</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment"> * Additional documentation can be found at www.openvirtualization.org</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment"> * Copyright (C) 2011 SierraWare</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment"> * This library is free software; you can redistribute it and/or</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment"> * modify it under the terms of the GNU General Public License</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment"> * as published by the Free Software Foundation; either version 2</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment"> * of the License, or (at your option) any later version.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment"> * This program is distributed in the hope that it will be useful,</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment"> * but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment"> * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment"> * GNU General Public License for more details.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment"> * </span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment"> * You should have received a copy of the GNU General Public License</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="comment"> * along with this program; if not, write to the Free Software</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment"> * Foundation, Inc., 59 Temple Place - Suite 330, Boston, MA  02111-1307, USA.</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"> * semaphore implementation functions</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment"> *</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="sw__semaphores_8h.html">sw_semaphores.h</a>&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="elf__loader_8h.html">elf_loader.h</a>&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="keyword">static</span> __inline <span class="keywordtype">void</span> sw_get_spinlock(<span class="keyword">volatile</span> <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *lock)</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;{</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;    <a class="code" href="sw__semaphores_8h.html#ab5028dc54dc18cb7c6e5ac85a5542403">sw_spinlock_s</a>((<span class="keywordtype">void</span>*)lock);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    <span class="comment">/*OTZ_READ_MEMORY_BARRIER</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">    __memory_changed();*/</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;    <a class="code" href="cpu_8c.html#a485c01a85ecf4219772d9df0db2c86a9">data_memory_barrier</a>();</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;}</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">static</span> __inline <span class="keywordtype">void</span> sw_release_spinlock(<span class="keyword">volatile</span> <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *lock)</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;{</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="comment">/*__memory_changed();</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">    OTZ_WRITE_MEMORY_BARRIER*/</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <a class="code" href="cpu_8c.html#aed669a97cf4695bb71f9d24330065976">data_sync_barrier</a>();</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;    <a class="code" href="sw__semaphores_8h.html#a6aac81e6777501983ca3af1d7230db1b">sw_spinunlock_s</a>((<span class="keywordtype">void</span>*)lock);</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;}</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="keyword">static</span> __inline <span class="keywordtype">int</span> sw_get_trylock(<span class="keyword">volatile</span> <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *lock)</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;{</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> lock_state;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    lock_state = <a class="code" href="sw__semaphores_8h.html#a88092c3fcb2539f67d3a376da0f6008a">sw_trylock_s</a>((<span class="keywordtype">void</span>*)lock);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="comment">/*OTZ_READ_MEMORY_BARRIER</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="comment">    __memory_changed();*/</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;    <a class="code" href="cpu_8c.html#a485c01a85ecf4219772d9df0db2c86a9">data_memory_barrier</a>();</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;    <span class="keywordflow">return</span>(lock_state);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;}</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="code" href="sw__semaphores_8c.html#a04367a7c0265aaf39c91f5490d227118">   87</a></span>&#160;<a class="code" href="sw__types_8h.html#aaf39421af243da7dea06fce58a8213b8">s32int</a> <a class="code" href="sw__semaphores_8h.html#a04367a7c0265aaf39c91f5490d227118" title="dymanic initialization of the mutex. The attribute parameter is kept for consistency and is not used...">sw_mutex_init</a>(<a class="code" href="structsw__mutex__t.html">sw_mutex_t</a> *mutex, <span class="keyword">const</span> <a class="code" href="sw__semaphores_8h.html#a2244ed712da6ca027f76cb840045e5e4">sw_mutexattr_t</a> *attribute)</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;{</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <span class="keywordflow">if</span>(mutex == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#ad644b8be68ed8327689bae20c2142c80">OTZ_INVALID</a>);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    mutex-&gt;<a class="code" href="structsw__mutex__t.html#a0705f3dd185c7552643d461b8c27da14">lock_param</a> = <a class="code" href="sw__semaphores_8h.html#abf435ec0b9f3b6e7ae76d9079bfe6084">OTZ_FREE</a>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;    mutex-&gt;<a class="code" href="structsw__mutex__t.html#a6c0e563741b69e50f8cd2003597f0259">init_param</a> = <a class="code" href="sw__semaphores_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;}</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="code" href="sw__semaphores_8c.html#a479d153ccca1ece612debff0558eba9e">  104</a></span>&#160;<a class="code" href="sw__types_8h.html#aaf39421af243da7dea06fce58a8213b8">s32int</a> <a class="code" href="sw__semaphores_8h.html#a479d153ccca1ece612debff0558eba9e" title="this function destroys the mutex object. Attempting to destroy a mutex that has already been destroye...">sw_mutex_destroy</a>(<a class="code" href="structsw__mutex__t.html">sw_mutex_t</a> *mutex)</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;{</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">if</span>(mutex == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#ad644b8be68ed8327689bae20c2142c80">OTZ_INVALID</a>);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">if</span>(mutex-&gt;<a class="code" href="structsw__mutex__t.html#a0705f3dd185c7552643d461b8c27da14">lock_param</a> != <a class="code" href="sw__semaphores_8h.html#abf435ec0b9f3b6e7ae76d9079bfe6084">OTZ_FREE</a>) {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#a3fd16a0b061bbb0bcbf50ad714050142">OTZ_BUSY</a>);</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    mutex-&gt;<a class="code" href="structsw__mutex__t.html#a6c0e563741b69e50f8cd2003597f0259">init_param</a> = <a class="code" href="sw__semaphores_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;}</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="code" href="sw__semaphores_8c.html#ac3c805367bdb75f13ac44f080f72e66e">  123</a></span>&#160;<a class="code" href="sw__types_8h.html#aaf39421af243da7dea06fce58a8213b8">s32int</a> <a class="code" href="sw__semaphores_8h.html#ac3c805367bdb75f13ac44f080f72e66e" title="this function locks the mutex object referenced. If the mutex is already locked, it blocks till it be...">sw_mutex_lock</a>(<a class="code" href="structsw__mutex__t.html">sw_mutex_t</a> *mutex)</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;{</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    <span class="keywordflow">if</span>((mutex == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (mutex-&gt;<a class="code" href="structsw__mutex__t.html#a6c0e563741b69e50f8cd2003597f0259">init_param</a> == <a class="code" href="sw__semaphores_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) {</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#ad644b8be68ed8327689bae20c2142c80">OTZ_INVALID</a>);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;    sw_get_spinlock((<span class="keywordtype">void</span>*)&amp;(mutex-&gt;<a class="code" href="structsw__mutex__t.html#a0705f3dd185c7552643d461b8c27da14">lock_param</a>));</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>);</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;}</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<a class="code" href="elf__loader_8h.html#af783dacce2382842e3e8e0af1b423013">EXPORT_SYMBOL</a>(<a class="code" href="sw__semaphores_8h.html#ac3c805367bdb75f13ac44f080f72e66e" title="this function locks the mutex object referenced. If the mutex is already locked, it blocks till it be...">sw_mutex_lock</a>);</div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="code" href="sw__semaphores_8c.html#af4b5c19a5ccbbdbe4eed5e7520c5cb84">  140</a></span>&#160;<a class="code" href="sw__types_8h.html#aaf39421af243da7dea06fce58a8213b8">s32int</a> <a class="code" href="sw__semaphores_8h.html#af4b5c19a5ccbbdbe4eed5e7520c5cb84" title="this function unlocks the mutex object referenced. Attempts to unlock a mutex that is already locked ...">sw_mutex_unlock</a>(<a class="code" href="structsw__mutex__t.html">sw_mutex_t</a> *mutex)</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;{</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="keywordflow">if</span>((mutex == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (mutex-&gt;<a class="code" href="structsw__mutex__t.html#a6c0e563741b69e50f8cd2003597f0259">init_param</a> == <a class="code" href="sw__semaphores_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#ad644b8be68ed8327689bae20c2142c80">OTZ_INVALID</a>);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;    sw_release_spinlock((<span class="keywordtype">void</span>*)&amp;(mutex-&gt;<a class="code" href="structsw__mutex__t.html#a0705f3dd185c7552643d461b8c27da14">lock_param</a>));</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;}</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<a class="code" href="elf__loader_8h.html#af783dacce2382842e3e8e0af1b423013">EXPORT_SYMBOL</a>(<a class="code" href="sw__semaphores_8h.html#af4b5c19a5ccbbdbe4eed5e7520c5cb84" title="this function unlocks the mutex object referenced. Attempts to unlock a mutex that is already locked ...">sw_mutex_unlock</a>);</div>
<div class="line"><a name="l00156"></a><span class="lineno"><a class="code" href="sw__semaphores_8c.html#af9f84b60f4d379ab88cc1091a63cf2ae">  156</a></span>&#160;<a class="code" href="sw__types_8h.html#aaf39421af243da7dea06fce58a8213b8">s32int</a> <a class="code" href="sw__semaphores_8h.html#af9f84b60f4d379ab88cc1091a63cf2ae" title="Try to lock the mutex. This function is same as the lock function, except that it returns if the mute...">sw_mutex_trylock</a>(<a class="code" href="structsw__mutex__t.html">sw_mutex_t</a> *mutex)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;{</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="keywordflow">if</span>((mutex == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (mutex-&gt;<a class="code" href="structsw__mutex__t.html#a6c0e563741b69e50f8cd2003597f0259">init_param</a> == <a class="code" href="sw__semaphores_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) {</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#ad644b8be68ed8327689bae20c2142c80">OTZ_INVALID</a>);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">if</span>(sw_get_trylock((<span class="keywordtype">void</span>*)&amp;(mutex-&gt;<a class="code" href="structsw__mutex__t.html#a0705f3dd185c7552643d461b8c27da14">lock_param</a>)) != <a class="code" href="sw__semaphores_8h.html#abf435ec0b9f3b6e7ae76d9079bfe6084">OTZ_FREE</a>) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#a3fd16a0b061bbb0bcbf50ad714050142">OTZ_BUSY</a>);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;    }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;}</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<a class="code" href="elf__loader_8h.html#af783dacce2382842e3e8e0af1b423013">EXPORT_SYMBOL</a>(<a class="code" href="sw__semaphores_8h.html#af9f84b60f4d379ab88cc1091a63cf2ae" title="Try to lock the mutex. This function is same as the lock function, except that it returns if the mute...">sw_mutex_trylock</a>);</div>
<div class="line"><a name="l00176"></a><span class="lineno"><a class="code" href="sw__semaphores_8c.html#a39487bfce93fff0c3557bb104ef9f7ef">  176</a></span>&#160;<a class="code" href="sw__types_8h.html#aaf39421af243da7dea06fce58a8213b8">s32int</a> <a class="code" href="sw__semaphores_8h.html#a39487bfce93fff0c3557bb104ef9f7ef" title="This function initializes the semaphore, and sets is counters to the value passed to it...">sw_sem_init</a>(<a class="code" href="structsw__sem__t.html">sw_sem_t</a> *sem, <a class="code" href="sw__types_8h.html#aaf39421af243da7dea06fce58a8213b8">s32int</a> shared, <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> value)</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;{</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <span class="keywordflow">if</span>(sem == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#ad644b8be68ed8327689bae20c2142c80">OTZ_INVALID</a>);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    }</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    sem-&gt;<a class="code" href="structsw__sem__t.html#aaea7607e4429b4c085c76561fb2e0b62">init_param</a> = <a class="code" href="sw__semaphores_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    sem-&gt;<a class="code" href="structsw__sem__t.html#a1586e3c6a4030dcf5e75a4a53c4576ff">counter_param</a> = value;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>);</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;}</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;</div>
<div class="line"><a name="l00193"></a><span class="lineno"><a class="code" href="sw__semaphores_8c.html#a8dc191367c06f2cff2957f3a69102514">  193</a></span>&#160;<a class="code" href="sw__types_8h.html#aaf39421af243da7dea06fce58a8213b8">s32int</a> <a class="code" href="sw__semaphores_8h.html#a8dc191367c06f2cff2957f3a69102514" title="This function locks the semaphore referenced by the sem value. An atomic decrement is performed...">sw_sem_wait</a>(<a class="code" href="structsw__sem__t.html">sw_sem_t</a> *sem)</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;{</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;    <span class="keywordflow">if</span>((sem == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (sem-&gt;<a class="code" href="structsw__sem__t.html#aaea7607e4429b4c085c76561fb2e0b62">init_param</a> == <a class="code" href="sw__semaphores_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) {</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#ad644b8be68ed8327689bae20c2142c80">OTZ_INVALID</a>);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    <a class="code" href="sw__semaphores_8h.html#a2dc30f6de9580ebd60b9f072627de8f7">sw_sem_wait_s</a>((<a class="code" href="sw__types_8h.html#aaf39421af243da7dea06fce58a8213b8">s32int</a>*)&amp;(sem-&gt;<a class="code" href="structsw__sem__t.html#a1586e3c6a4030dcf5e75a4a53c4576ff">counter_param</a>));</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;    <span class="comment">/*OTZ_READ_MEMORY_BARRIER</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">    __memory_changed();*/</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;    <a class="code" href="cpu_8c.html#a485c01a85ecf4219772d9df0db2c86a9">data_memory_barrier</a>();</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>);</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;}</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00212"></a><span class="lineno"><a class="code" href="sw__semaphores_8c.html#aa074bb6e5b06c3ff897483709ec2b787">  212</a></span>&#160;<a class="code" href="sw__types_8h.html#aaf39421af243da7dea06fce58a8213b8">s32int</a> <a class="code" href="sw__semaphores_8h.html#aa074bb6e5b06c3ff897483709ec2b787" title="This function unlocks the semaphore referenced by sem. The value is incremented atomically. If there are any threads waiting on this semaphore, only one of them would be released from sem_wait.">sw_sem_post</a>(<a class="code" href="structsw__sem__t.html">sw_sem_t</a> *sem)</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;{</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">if</span>((sem == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (sem-&gt;<a class="code" href="structsw__sem__t.html#aaea7607e4429b4c085c76561fb2e0b62">init_param</a> == <a class="code" href="sw__semaphores_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>)) {</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#ad644b8be68ed8327689bae20c2142c80">OTZ_INVALID</a>);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;    <span class="comment">/*__memory_changed();</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">    OTZ_WRITE_MEMORY_BARRIER */</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;    <a class="code" href="cpu_8c.html#aed669a97cf4695bb71f9d24330065976">data_sync_barrier</a>();</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;    <a class="code" href="sw__semaphores_8h.html#acc6f251f28afebcb1f64419df7c92d40">sw_sem_post_s</a>((<a class="code" href="sw__types_8h.html#aaf39421af243da7dea06fce58a8213b8">s32int</a>*)&amp;(sem-&gt;<a class="code" href="structsw__sem__t.html#a1586e3c6a4030dcf5e75a4a53c4576ff">counter_param</a>));</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>);</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;}</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00231"></a><span class="lineno"><a class="code" href="sw__semaphores_8c.html#a667bf1dc62225b5affc82815da70adc6">  231</a></span>&#160;<a class="code" href="sw__types_8h.html#aaf39421af243da7dea06fce58a8213b8">s32int</a> <a class="code" href="sw__semaphores_8h.html#a667bf1dc62225b5affc82815da70adc6" title="Delete the semaphore pointed to by sem variable The semaphore cannot be used after deletion...">sw_sem_destroy</a>(<a class="code" href="structsw__sem__t.html">sw_sem_t</a> *sem)</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;{</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keywordflow">if</span>(sem == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#ad644b8be68ed8327689bae20c2142c80">OTZ_INVALID</a>);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">if</span>(sem-&gt;<a class="code" href="structsw__sem__t.html#a1586e3c6a4030dcf5e75a4a53c4576ff">counter_param</a> &lt; 0) {</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#a3fd16a0b061bbb0bcbf50ad714050142">OTZ_BUSY</a>);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    sem-&gt;<a class="code" href="structsw__sem__t.html#a1586e3c6a4030dcf5e75a4a53c4576ff">counter_param</a> = 0;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    sem-&gt;<a class="code" href="structsw__sem__t.html#aaea7607e4429b4c085c76561fb2e0b62">init_param</a> = <a class="code" href="sw__semaphores_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;}</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;</div>
<div class="line"><a name="l00252"></a><span class="lineno"><a class="code" href="sw__semaphores_8c.html#a1c76bedb76df6742a511442f9da97f30">  252</a></span>&#160;<a class="code" href="sw__types_8h.html#aaf39421af243da7dea06fce58a8213b8">s32int</a> <a class="code" href="sw__semaphores_8h.html#a1c76bedb76df6742a511442f9da97f30" title="Get the current value of the semaphore. It is copied into the argument supplied by the caller...">sw_sem_getvalue</a>(<a class="code" href="structsw__sem__t.html">sw_sem_t</a> *sem, <a class="code" href="sw__types_8h.html#aaf39421af243da7dea06fce58a8213b8">s32int</a> *value)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;{</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;    <span class="keywordflow">if</span>((sem == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (sem-&gt;<a class="code" href="structsw__sem__t.html#aaea7607e4429b4c085c76561fb2e0b62">init_param</a> == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (value == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#ad644b8be68ed8327689bae20c2142c80">OTZ_INVALID</a>);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    }</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    *value = sem-&gt;<a class="code" href="structsw__sem__t.html#a1586e3c6a4030dcf5e75a4a53c4576ff">counter_param</a>;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordflow">return</span>(<a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jan 3 2013 00:33:52 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
