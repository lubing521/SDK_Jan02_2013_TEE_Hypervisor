<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>otz_api.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d44c64559bbebec7f509842c48db8b23.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">otz_api.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="sw__common__types_8h_source.html">sw_common_types.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__list_8h_source.html">sw_list.h</a>&gt;</code><br/>
</div>
<p><a href="otz__api_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structotz__uuid__t.html">otz_uuid_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Universally Unique IDentifier (UUID) type as defined in [RFC4122].A.  <a href="structotz__uuid__t.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structotz__login__t.html">otz_login_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Login credentials to be provided to the service.  <a href="structotz__login__t.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structTEE__ObjectInfo.html">TEE_ObjectInfo</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structTEE__Attribute.html">TEE_Attribute</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct____TEE__ObjectHandle.html">__TEE_ObjectHandle</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">opaque structure definition for an object handle. TODO - Fill it with something appropriate  <a href="struct____TEE__ObjectHandle.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structotz__property__t.html">otz_property_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Name value pairs.  <a href="structotz__property__t.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structotz__property__name__t.html">otz_property_name_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Service property.  <a href="structotz__property__name__t.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structotz__timelimit__t.html">otz_timelimit_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Absolute time since an arbitary origin.  <a href="structotz__timelimit__t.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structotz__enc__dec__t.html">otz_enc_dec_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encoder and decoder state.  <a href="structotz__enc__dec__t.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structotz__mem__reference.html">otz_mem_reference</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shared memory reference.  <a href="structotz__mem__reference.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structotz__operation__t.html">otz_operation_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The <a class="el" href="structotz__operation__t.html" title="The otz_operation_t structure is used to contain control information related to an operation that is ...">otz_operation_t</a> structure is used to contain control information related to an operation that is to be invoked with the security environment.  <a href="structotz__operation__t.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structotz__session__t.html">otz_session_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The <a class="el" href="structotz__session__t.html" title="The otz_session_t structure is used to contain control information related to a session between a cli...">otz_session_t</a> structure is used to contain control information related to a session between a client and a service.  <a href="structotz__session__t.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structotz__device__t.html">otz_device_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The <a class="el" href="structotz__device__t.html" title="The otz_device_t structure is used to contain control information related to the device.">otz_device_t</a> structure is used to contain control information related to the device.  <a href="structotz__device__t.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">The otz_shared_memory_t structure is used to contain control information related to a block of shared memory that is mapped between the client and the service.  <a href="structotz__shared__mem__t.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:ad896165e1c604bf9d63031ab77bb2f3a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#ad896165e1c604bf9d63031ab77bb2f3a">TYPE_UINT_DEFINED</a>&#160;&#160;&#160;1</td></tr>
<tr class="separator:ad896165e1c604bf9d63031ab77bb2f3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12bcf1760a725c67f750d606944ae8ca"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a12bcf1760a725c67f750d606944ae8ca">MAX_MEMBLOCKS_PER_OPERATION</a>&#160;&#160;&#160;4</td></tr>
<tr class="separator:a12bcf1760a725c67f750d606944ae8ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a435d1572bf3f880d55459d9805097f62"><td class="memItemLeft" align="right" valign="top">typedef unsigned int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></td></tr>
<tr class="separator:a435d1572bf3f880d55459d9805097f62"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a273cf69d639a59973b6019625df33e30"><td class="memItemLeft" align="right" valign="top">typedef unsigned short&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a></td></tr>
<tr class="separator:a273cf69d639a59973b6019625df33e30"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaf0f0cca584c8202c7ee0f4a368bdd50"><td class="memItemLeft" align="right" valign="top">typedef char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#aaf0f0cca584c8202c7ee0f4a368bdd50">uint8_t</a></td></tr>
<tr class="separator:aaf0f0cca584c8202c7ee0f4a368bdd50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4f8dc61bf50df313bad5c8fded2539d"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a></td></tr>
<tr class="separator:ad4f8dc61bf50df313bad5c8fded2539d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa2ebd844d3d3b703be9a676d6261831f"><td class="memItemLeft" align="right" valign="top">typedef <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#aa2ebd844d3d3b703be9a676d6261831f">otz_state_t</a></td></tr>
<tr class="separator:aa2ebd844d3d3b703be9a676d6261831f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98166f886548ebe68e1c0da67a5b6b88"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structotz__uuid__t.html">otz_uuid_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a98166f886548ebe68e1c0da67a5b6b88">otz_uuid_t</a></td></tr>
<tr class="memdesc:a98166f886548ebe68e1c0da67a5b6b88"><td class="mdescLeft">&#160;</td><td class="mdescRight">Universally Unique IDentifier (UUID) type as defined in [RFC4122].A.  <a href="#a98166f886548ebe68e1c0da67a5b6b88"></a><br/></td></tr>
<tr class="separator:a98166f886548ebe68e1c0da67a5b6b88"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab383fdb2a73ee82d097c78379378c49b"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structotz__login__t.html">otz_login_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#ab383fdb2a73ee82d097c78379378c49b">otz_login_t</a></td></tr>
<tr class="memdesc:ab383fdb2a73ee82d097c78379378c49b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Login credentials to be provided to the service.  <a href="#ab383fdb2a73ee82d097c78379378c49b"></a><br/></td></tr>
<tr class="separator:ab383fdb2a73ee82d097c78379378c49b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a2cfeba38a0f61d5937bcc8cf04b9a2"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="struct____TEE__ObjectHandle.html">__TEE_ObjectHandle</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a6a2cfeba38a0f61d5937bcc8cf04b9a2">TEE_ObjectHandle</a></td></tr>
<tr class="separator:a6a2cfeba38a0f61d5937bcc8cf04b9a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2201d6e3c9a1f6bf8655f2aac421a767"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structotz__property__t.html">otz_property_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a2201d6e3c9a1f6bf8655f2aac421a767">otz_property_t</a></td></tr>
<tr class="memdesc:a2201d6e3c9a1f6bf8655f2aac421a767"><td class="mdescLeft">&#160;</td><td class="mdescRight">Name value pairs.  <a href="#a2201d6e3c9a1f6bf8655f2aac421a767"></a><br/></td></tr>
<tr class="separator:a2201d6e3c9a1f6bf8655f2aac421a767"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1dbc57b0ead084a168f4036778de729b"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structotz__property__name__t.html">otz_property_name_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a1dbc57b0ead084a168f4036778de729b">otz_property_name_t</a></td></tr>
<tr class="memdesc:a1dbc57b0ead084a168f4036778de729b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Service property.  <a href="#a1dbc57b0ead084a168f4036778de729b"></a><br/></td></tr>
<tr class="separator:a1dbc57b0ead084a168f4036778de729b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f83f8987764a70225a971745f69997e"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structotz__timelimit__t.html">otz_timelimit_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a8f83f8987764a70225a971745f69997e">otz_timelimit_t</a></td></tr>
<tr class="memdesc:a8f83f8987764a70225a971745f69997e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Absolute time since an arbitary origin.  <a href="#a8f83f8987764a70225a971745f69997e"></a><br/></td></tr>
<tr class="separator:a8f83f8987764a70225a971745f69997e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a67c7ab5557be2f4226ab542913a03301"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structotz__operation__t.html">otz_operation_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a67c7ab5557be2f4226ab542913a03301">otz_operation_t</a></td></tr>
<tr class="separator:a67c7ab5557be2f4226ab542913a03301"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e91f195d32fa2d4ba9cd7d994a4d475"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structotz__session__t.html">otz_session_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a0e91f195d32fa2d4ba9cd7d994a4d475">otz_session_t</a></td></tr>
<tr class="separator:a0e91f195d32fa2d4ba9cd7d994a4d475"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac14bfa3ad3eb4daa8e3d698b526aa2c3"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structotz__device__t.html">otz_device_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#ac14bfa3ad3eb4daa8e3d698b526aa2c3">otz_device_t</a></td></tr>
<tr class="separator:ac14bfa3ad3eb4daa8e3d698b526aa2c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5cab41191766781d25f9c34aec2806ce"><td class="memItemLeft" align="right" valign="top">typedef struct <a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a5cab41191766781d25f9c34aec2806ce">otz_shared_mem_t</a></td></tr>
<tr class="separator:a5cab41191766781d25f9c34aec2806ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a81a7b5c8f80e9d01805dc40edeea10b9"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9">otz_error_codes</a> { <br/>
&#160;&#160;<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a> = 0x0, 
<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aa02266bd582bb24422be01a93d709b7c">OTZ_PENDING</a>, 
<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>, 
<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a41673c9f07fe677e9ec5ff1548ae37f0">OTZ_ERROR_BUSY</a>, 
<br/>
&#160;&#160;<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a7789ecf9ebab693d4a66a6b092152f7a">OTZ_ERROR_CANCEL</a>, 
<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a0678f84ec4430a7268192c2a16b141e0">OTZ_ERROR_COMMUNICATION</a>, 
<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9af6511e3f523080e2690708d86c6f73b6">OTZ_ERROR_DECODE_NO_DATA</a>, 
<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9ada9828a22e4e297c7428d883d1ad09d7">OTZ_ERROR_DECODE_TYPE</a>, 
<br/>
&#160;&#160;<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aea980bb9abe6250d2b89ae8095b9bcdb">OTZ_ERROR_ENCODE_FORMAT</a>, 
<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>, 
<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a011416e65f00b25a21592c87267eb9bd">OTZ_ERROR_GENERIC</a>, 
<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>, 
<br/>
&#160;&#160;<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a17a59e90aad673eacadb8490283f5499">OTZ_ERROR_ILLEGAL_STATE</a>, 
<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9af73e3a356497d98c0f50006d4c81c34c">OTZ_ERROR_MEMORY</a>, 
<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a0669e32ad6657b360501a030dc12d4db">OTZ_ERROR_NOT_IMPLEMENTED</a>, 
<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a691b50310f084199e603624440c5661c">OTZ_ERROR_SECURITY</a>, 
<br/>
&#160;&#160;<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aca66b378fc1c26b5990a5edc5f334a55">OTZ_ERROR_SERVICE</a>, 
<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aaba8258839dda54e4cc75e59856ec2e4">OTZ_ERROR_SHORT_BUFFER</a>, 
<a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a323328909603b4a09891fb854cd15c5c">OTZ_ERROR_UNDEFINED</a>
<br/>
 }</td></tr>
<tr class="memdesc:a81a7b5c8f80e9d01805dc40edeea10b9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Error codes.  <a href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9">More...</a><br/></td></tr>
<tr class="separator:a81a7b5c8f80e9d01805dc40edeea10b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af7e5410bcac27927f8e1df8d0579063b"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063b">otz_state_machine_state_const</a> { <br/>
&#160;&#160;<a class="el" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9">OTZ_STATE_UNDEFINED</a> = 0x0, 
<a class="el" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>, 
<a class="el" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a>, 
<a class="el" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba96dd245ead2dc47347e8d4e26c037614">OTZ_STATE_CLOSING</a>, 
<br/>
&#160;&#160;<a class="el" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bacfa218bc516a757e26a7248eb959fb7e">OTZ_STATE_ENCODE</a>, 
<a class="el" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba218a34ca51a29c286a5ec794347d915b">OTZ_STATE_PERFORMABLE</a>, 
<a class="el" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba2d1d39b46fb1b8a045558802f26d14d8">OTZ_STATE_RUNNING</a>, 
<a class="el" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bac4b86484404dcee83015799253d5356d">OTZ_STATE_RUNNING_ASYNC</a>, 
<br/>
&#160;&#160;<a class="el" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a">OTZ_STATE_DECODE</a>
<br/>
 }</td></tr>
<tr class="memdesc:af7e5410bcac27927f8e1df8d0579063b"><td class="mdescLeft">&#160;</td><td class="mdescRight">State machine constants.  <a href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063b">More...</a><br/></td></tr>
<tr class="separator:af7e5410bcac27927f8e1df8d0579063b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fe48bdd74929ed4185c179a0f087289"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289">otz_login_flags</a> { <br/>
&#160;&#160;<a class="el" href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289a72d4e75761f064b02737dc378962df5a">OTZ_LOGIN_PUBLIC</a> = 0x0, 
<a class="el" href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289ab66aa7bb2b4bd01817e22a93314a85b3">OTZ_LOGIN_CLIENT_DATA</a>, 
<a class="el" href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289ab846d165bf78bb9a06c31f3e374d029f">OTZ_LOGIN_USER</a>, 
<a class="el" href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289afb900e9068dc1808ac61df3c66131ae7">OTZ_LOGIN_GROUP</a>, 
<br/>
&#160;&#160;<a class="el" href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289a61dfb65b8c83672b1b2ac9bd199efb52">OTZ_LOGIN_NAME</a>, 
<a class="el" href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289a51956a69be9da7227a1d9b13e36f6f81">OTZ_LOGIN_DIGEST</a>, 
<a class="el" href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289a55e23f644bd720f3629676afb37bf4ab">OTZ_LOGIN_ALL</a>
<br/>
 }</td></tr>
<tr class="memdesc:a3fe48bdd74929ed4185c179a0f087289"><td class="mdescLeft">&#160;</td><td class="mdescRight">Login flag constants.  <a href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289">More...</a><br/></td></tr>
<tr class="separator:a3fe48bdd74929ed4185c179a0f087289"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0726f9cc52e17d8e6cd7dd085cc62527"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527">otz_shared_mem_flags</a> { <br/>
&#160;&#160;<a class="el" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a7aa74f7037354b0cd675442b600060c0">OTZ_MEM_SERVICE_RO</a> = 0x0, 
<a class="el" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a8035deccf29fcd9fe345e3f3e0e4accb">OTZ_MEM_SERVICE_WO</a>, 
<a class="el" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a33f6f503a1e274dc317a34352157100c">OTZ_MEM_SERVICE_RW</a>, 
<a class="el" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527aa462fe85425a0bde33600ba164e20325">OTZ_MEM_SERVICE_UNDEFINED</a>, 
<br/>
&#160;&#160;<a class="el" href="otz__tee__client__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a7aa74f7037354b0cd675442b600060c0">OTZ_MEM_SERVICE_RO</a> = 0x0, 
<a class="el" href="otz__tee__client__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a8035deccf29fcd9fe345e3f3e0e4accb">OTZ_MEM_SERVICE_WO</a>, 
<a class="el" href="otz__tee__client__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a33f6f503a1e274dc317a34352157100c">OTZ_MEM_SERVICE_RW</a>, 
<a class="el" href="otz__tee__client__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527aa462fe85425a0bde33600ba164e20325">OTZ_MEM_SERVICE_UNDEFINED</a>
<br/>
 }</td></tr>
<tr class="memdesc:a0726f9cc52e17d8e6cd7dd085cc62527"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shared memory flag constants.  <a href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527">More...</a><br/></td></tr>
<tr class="separator:a0726f9cc52e17d8e6cd7dd085cc62527"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6e2349cbd9eb83af61bcd4fe3f9eeb74"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74">otz_type_of_operation</a> { <a class="el" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74ae3426ea3b47e48669f0994c9b7f69a06">OTZ_OPERATION_OPEN</a> = 0x0, 
<a class="el" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74a2d4af296381db71825daa2f33e2ce4ba">OTZ_OPERATION_INVOKE</a>, 
<a class="el" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74aa8869f3ce511b3a269235c8fd1ad5f63">OTZ_OPERATION_CLOSE</a>, 
<a class="el" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74a4370cd5fbe2631ca67965cc40786f86f">OTZ_OPERATION_NONE</a>
 }</td></tr>
<tr class="memdesc:a6e2349cbd9eb83af61bcd4fe3f9eeb74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Operation type constants.  <a href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74">More...</a><br/></td></tr>
<tr class="separator:a6e2349cbd9eb83af61bcd4fe3f9eeb74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2b9c7ed6d9ebe7cdc56921f2f4ce6ff"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ff">otz_param_type</a> { <a class="el" href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ffa10b853b752b4cd31ca98321d86ec3db4">OTZ_PARAM_IN</a> = 0x0, 
<a class="el" href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ffa5c86bb59cf47117648ab204158c8b2f9">OTZ_PARAM_OUT</a>
 }</td></tr>
<tr class="memdesc:ac2b9c7ed6d9ebe7cdc56921f2f4ce6ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">Param type constants.  <a href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ff">More...</a><br/></td></tr>
<tr class="separator:ac2b9c7ed6d9ebe7cdc56921f2f4ce6ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a543151d0e3457a37a15b96ab02e4418d"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a543151d0e3457a37a15b96ab02e4418d">otz_decode_type</a> { <a class="el" href="otz__api_8h.html#a543151d0e3457a37a15b96ab02e4418daee4efd202332a908cb06565feedb5b59">OTZ_TYPE_NONE</a> = 0x0, 
<a class="el" href="otz__api_8h.html#a543151d0e3457a37a15b96ab02e4418dacb08736841422c177ff05b448b3f27ca">OTZ_TYPE_UINT32</a>, 
<a class="el" href="otz__api_8h.html#a543151d0e3457a37a15b96ab02e4418dadab265691fd16eba9ef0938d35fc2d20">OTZ_TYPE_ARRAY</a>
 }</td></tr>
<tr class="memdesc:a543151d0e3457a37a15b96ab02e4418d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decode type constants.  <a href="otz__api_8h.html#a543151d0e3457a37a15b96ab02e4418d">More...</a><br/></td></tr>
<tr class="separator:a543151d0e3457a37a15b96ab02e4418d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a29270e916339ced6667bc280ce48aa31"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a29270e916339ced6667bc280ce48aa31">otz_device_open</a> (void const *pk_device_name, void const *pk_init, <a class="el" href="structotz__device__t.html">otz_device_t</a> *ps_device)</td></tr>
<tr class="memdesc:a29270e916339ced6667bc280ce48aa31"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open the device.  <a href="#a29270e916339ced6667bc280ce48aa31"></a><br/></td></tr>
<tr class="separator:a29270e916339ced6667bc280ce48aa31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55d0b5b18114d5553e2546c50ab3b0b5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a55d0b5b18114d5553e2546c50ab3b0b5">otz_device_get_timelimit</a> (<a class="el" href="structotz__device__t.html">otz_device_t</a> *ps_device, <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> ui_timeout, <a class="el" href="structotz__timelimit__t.html">otz_timelimit_t</a> *ps_timelimit)</td></tr>
<tr class="memdesc:a55d0b5b18114d5553e2546c50ab3b0b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get local time limit.  <a href="#a55d0b5b18114d5553e2546c50ab3b0b5"></a><br/></td></tr>
<tr class="separator:a55d0b5b18114d5553e2546c50ab3b0b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe75dee12e5e7d00489297ce482b9f74"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#afe75dee12e5e7d00489297ce482b9f74">otz_operation_prepare_open</a> (<a class="el" href="structotz__device__t.html">otz_device_t</a> *ps_device, int pks_service, <a class="el" href="structotz__login__t.html">otz_login_t</a> const *pks_login, <a class="el" href="structotz__timelimit__t.html">otz_timelimit_t</a> const *pks_timelimit, <a class="el" href="structotz__session__t.html">otz_session_t</a> *ps_session, <a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation)</td></tr>
<tr class="memdesc:afe75dee12e5e7d00489297ce482b9f74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare open operation.  <a href="#afe75dee12e5e7d00489297ce482b9f74"></a><br/></td></tr>
<tr class="separator:afe75dee12e5e7d00489297ce482b9f74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b0f5735d0aa17639a7ce957ecb5867f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a9b0f5735d0aa17639a7ce957ecb5867f">otz_operation_prepare_invoke</a> (<a class="el" href="structotz__session__t.html">otz_session_t</a> *ps_session, <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> ui_command, <a class="el" href="structotz__timelimit__t.html">otz_timelimit_t</a> const *pks_timelimit, <a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation)</td></tr>
<tr class="memdesc:a9b0f5735d0aa17639a7ce957ecb5867f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare operation for service request.  <a href="#a9b0f5735d0aa17639a7ce957ecb5867f"></a><br/></td></tr>
<tr class="separator:a9b0f5735d0aa17639a7ce957ecb5867f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d31dcaad228c53c2fb4094329111944"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a0d31dcaad228c53c2fb4094329111944">otz_operation_perform</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation, <a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> *pui_service_return)</td></tr>
<tr class="memdesc:a0d31dcaad228c53c2fb4094329111944"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs the previously prepared operation.  <a href="#a0d31dcaad228c53c2fb4094329111944"></a><br/></td></tr>
<tr class="separator:a0d31dcaad228c53c2fb4094329111944"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cca7c131a9236ee08c26ad743d2eec1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a7cca7c131a9236ee08c26ad743d2eec1">otz_operation_release</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation)</td></tr>
<tr class="memdesc:a7cca7c131a9236ee08c26ad743d2eec1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release operation.  <a href="#a7cca7c131a9236ee08c26ad743d2eec1"></a><br/></td></tr>
<tr class="separator:a7cca7c131a9236ee08c26ad743d2eec1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56d72206cc55e912e8ce188fbe632c8a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a56d72206cc55e912e8ce188fbe632c8a">otz_operation_prepare_close</a> (<a class="el" href="structotz__session__t.html">otz_session_t</a> *ps_session, <a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation)</td></tr>
<tr class="memdesc:a56d72206cc55e912e8ce188fbe632c8a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare the operation for close session.  <a href="#a56d72206cc55e912e8ce188fbe632c8a"></a><br/></td></tr>
<tr class="separator:a56d72206cc55e912e8ce188fbe632c8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afaa5ecb61e5d492cf6da006dffd3bb2d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#afaa5ecb61e5d492cf6da006dffd3bb2d">otz_device_close</a> (<a class="el" href="structotz__device__t.html">otz_device_t</a> *ps_device)</td></tr>
<tr class="memdesc:afaa5ecb61e5d492cf6da006dffd3bb2d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close the device connection.  <a href="#afaa5ecb61e5d492cf6da006dffd3bb2d"></a><br/></td></tr>
<tr class="separator:afaa5ecb61e5d492cf6da006dffd3bb2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a803f85d1b6da9a5ec167bb0f5450a0e4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a803f85d1b6da9a5ec167bb0f5450a0e4">otz_shared_memory_allocate</a> (<a class="el" href="structotz__session__t.html">otz_session_t</a> *ps_session, <a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a> *ps_shared_mem)</td></tr>
<tr class="memdesc:a803f85d1b6da9a5ec167bb0f5450a0e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function allocates a block of memory, defined by the structure pointed to by ps_shared_mem, which is shared between the client and the service it is connected to.  <a href="#a803f85d1b6da9a5ec167bb0f5450a0e4"></a><br/></td></tr>
<tr class="separator:a803f85d1b6da9a5ec167bb0f5450a0e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45aca9f87329cb21e0e9517099dcfc0d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a45aca9f87329cb21e0e9517099dcfc0d">otz_shared_memory_release</a> (<a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a> *ps_shared_mem)</td></tr>
<tr class="memdesc:a45aca9f87329cb21e0e9517099dcfc0d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function allocates a block of memory, defined by the structure pointed to by ps_shared_mem, which is shared between the client and the service it is connected to. This function marks a block of shared memory associated with a session as no longer shared.  <a href="#a45aca9f87329cb21e0e9517099dcfc0d"></a><br/></td></tr>
<tr class="separator:a45aca9f87329cb21e0e9517099dcfc0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5067283c78c6e22d4e4da117ec943f81"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a5067283c78c6e22d4e4da117ec943f81">otz_encode_uint32</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation, void const *<a class="el" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a>, int param_type)</td></tr>
<tr class="memdesc:a5067283c78c6e22d4e4da117ec943f81"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encode unsigned 32-bit integer.  <a href="#a5067283c78c6e22d4e4da117ec943f81"></a><br/></td></tr>
<tr class="separator:a5067283c78c6e22d4e4da117ec943f81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92380414c091abe1de0b23d63f426bcf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a92380414c091abe1de0b23d63f426bcf">otz_encode_array</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation, void const *pk_array, <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> length, int param_type)</td></tr>
<tr class="memdesc:a92380414c091abe1de0b23d63f426bcf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encode binary array to the encoded message.  <a href="#a92380414c091abe1de0b23d63f426bcf"></a><br/></td></tr>
<tr class="separator:a92380414c091abe1de0b23d63f426bcf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74f4f32cc597cb04c352f0faaf353259"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a74f4f32cc597cb04c352f0faaf353259">otz_encode_array_space</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation, <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> length, int param_type)</td></tr>
<tr class="memdesc:a74f4f32cc597cb04c352f0faaf353259"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encode empty binary array to the encoded message.  <a href="#a74f4f32cc597cb04c352f0faaf353259"></a><br/></td></tr>
<tr class="separator:a74f4f32cc597cb04c352f0faaf353259"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4663159507afcef1df21e7b29bbb1c6c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a4663159507afcef1df21e7b29bbb1c6c">otz_encode_memory_reference</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation, <a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a> *ps_shared_mem, <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> offset, <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> length, <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> flags, int param_type)</td></tr>
<tr class="memdesc:a4663159507afcef1df21e7b29bbb1c6c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Appends a reference of previously allocated shared block to the encoded buffer.  <a href="#a4663159507afcef1df21e7b29bbb1c6c"></a><br/></td></tr>
<tr class="separator:a4663159507afcef1df21e7b29bbb1c6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac73c45b1f13368b895d888b1af02b122"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#ac73c45b1f13368b895d888b1af02b122">otz_decode_uint32</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation)</td></tr>
<tr class="memdesc:ac73c45b1f13368b895d888b1af02b122"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decode a unsigned 32-bit integer value from message.  <a href="#ac73c45b1f13368b895d888b1af02b122"></a><br/></td></tr>
<tr class="separator:ac73c45b1f13368b895d888b1af02b122"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06653a27f5781a86e489d33952f598cf"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a06653a27f5781a86e489d33952f598cf">otz_decode_array_space</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation, <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> *plength)</td></tr>
<tr class="memdesc:a06653a27f5781a86e489d33952f598cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decode a block of binary data from the message.  <a href="#a06653a27f5781a86e489d33952f598cf"></a><br/></td></tr>
<tr class="separator:a06653a27f5781a86e489d33952f598cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59d3ca17d318082f1fb5ea24b3e8698f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a59d3ca17d318082f1fb5ea24b3e8698f">otz_decode_get_type</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation)</td></tr>
<tr class="memdesc:a59d3ca17d318082f1fb5ea24b3e8698f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the decoder stream data type.  <a href="#a59d3ca17d318082f1fb5ea24b3e8698f"></a><br/></td></tr>
<tr class="separator:a59d3ca17d318082f1fb5ea24b3e8698f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54fb04a14c11e1a4ce77c828eb232379"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8h.html#a54fb04a14c11e1a4ce77c828eb232379">otz_decode_get_error</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation)</td></tr>
<tr class="memdesc:a54fb04a14c11e1a4ce77c828eb232379"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get decode error.  <a href="#a54fb04a14c11e1a4ce77c828eb232379"></a><br/></td></tr>
<tr class="separator:a54fb04a14c11e1a4ce77c828eb232379"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="a12bcf1760a725c67f750d606944ae8ca"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define MAX_MEMBLOCKS_PER_OPERATION&#160;&#160;&#160;4</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00039">39</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>

</div>
</div>
<a class="anchor" id="ad896165e1c604bf9d63031ab77bb2f3a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define TYPE_UINT_DEFINED&#160;&#160;&#160;1</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00030">30</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="ac14bfa3ad3eb4daa8e3d698b526aa2c3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structotz__device__t.html">otz_device_t</a> <a class="el" href="structotz__device__t.html">otz_device_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00359">359</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>

</div>
</div>
<a class="anchor" id="ab383fdb2a73ee82d097c78379378c49b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structotz__login__t.html">otz_login_t</a> <a class="el" href="structotz__login__t.html">otz_login_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Login credentials to be provided to the service. </p>

</div>
</div>
<a class="anchor" id="a67c7ab5557be2f4226ab542913a03301"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structotz__operation__t.html">otz_operation_t</a> <a class="el" href="structotz__operation__t.html">otz_operation_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00351">351</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>

</div>
</div>
<a class="anchor" id="a1dbc57b0ead084a168f4036778de729b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structotz__property__name__t.html">otz_property_name_t</a> <a class="el" href="structotz__property__name__t.html">otz_property_name_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Service property. </p>

</div>
</div>
<a class="anchor" id="a2201d6e3c9a1f6bf8655f2aac421a767"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structotz__property__t.html">otz_property_t</a> <a class="el" href="structotz__property__t.html">otz_property_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Name value pairs. </p>

</div>
</div>
<a class="anchor" id="ad4f8dc61bf50df313bad5c8fded2539d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00198">198</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>

</div>
</div>
<a class="anchor" id="a0e91f195d32fa2d4ba9cd7d994a4d475"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structotz__session__t.html">otz_session_t</a> <a class="el" href="structotz__session__t.html">otz_session_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00355">355</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5cab41191766781d25f9c34aec2806ce"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a> <a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00363">363</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa2ebd844d3d3b703be9a676d6261831f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> <a class="el" href="otz__api_8h.html#aa2ebd844d3d3b703be9a676d6261831f">otz_state_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00199">199</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>

</div>
</div>
<a class="anchor" id="a8f83f8987764a70225a971745f69997e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structotz__timelimit__t.html">otz_timelimit_t</a> <a class="el" href="structotz__timelimit__t.html">otz_timelimit_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Absolute time since an arbitary origin. </p>

</div>
</div>
<a class="anchor" id="a98166f886548ebe68e1c0da67a5b6b88"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="structotz__uuid__t.html">otz_uuid_t</a> <a class="el" href="structotz__uuid__t.html">otz_uuid_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Universally Unique IDentifier (UUID) type as defined in [RFC4122].A. </p>
<p>UUID is the mechanism by which a service is identified. </p>

</div>
</div>
<a class="anchor" id="a6a2cfeba38a0f61d5937bcc8cf04b9a2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct____TEE__ObjectHandle.html">__TEE_ObjectHandle</a> <a class="el" href="otz__api_8h.html#a6a2cfeba38a0f61d5937bcc8cf04b9a2">TEE_ObjectHandle</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00305">305</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>

</div>
</div>
<a class="anchor" id="a273cf69d639a59973b6019625df33e30"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef unsigned short <a class="el" href="otz__api_8h.html#a273cf69d639a59973b6019625df33e30">uint16_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00033">33</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>

</div>
</div>
<a class="anchor" id="a435d1572bf3f880d55459d9805097f62"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef unsigned int <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00032">32</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>

</div>
</div>
<a class="anchor" id="aaf0f0cca584c8202c7ee0f4a368bdd50"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef char <a class="el" href="otz__api_8h.html#aaf0f0cca584c8202c7ee0f4a368bdd50">uint8_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00036">36</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a class="anchor" id="a543151d0e3457a37a15b96ab02e4418d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="otz__api_8h.html#a543151d0e3457a37a15b96ab02e4418d">otz_decode_type</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Decode type constants. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a543151d0e3457a37a15b96ab02e4418daee4efd202332a908cb06565feedb5b59"></a>OTZ_TYPE_NONE</em>&nbsp;</td><td>
<p>There is no more data in the decode stream. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a543151d0e3457a37a15b96ab02e4418dacb08736841422c177ff05b448b3f27ca"></a>OTZ_TYPE_UINT32</em>&nbsp;</td><td>
<p>The next data type in the stream is a uint32_t. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a543151d0e3457a37a15b96ab02e4418dadab265691fd16eba9ef0938d35fc2d20"></a>OTZ_TYPE_ARRAY</em>&nbsp;</td><td>
<p>The next data type in the stream is an array. </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00189">189</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>
<div class="fragment"><div class="line">                     {</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a543151d0e3457a37a15b96ab02e4418daee4efd202332a908cb06565feedb5b59">OTZ_TYPE_NONE</a> = 0x0,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a543151d0e3457a37a15b96ab02e4418dacb08736841422c177ff05b448b3f27ca">OTZ_TYPE_UINT32</a>,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a543151d0e3457a37a15b96ab02e4418dadab265691fd16eba9ef0938d35fc2d20">OTZ_TYPE_ARRAY</a></div>
<div class="line">};</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9">otz_error_codes</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Error codes. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8"></a>OTZ_SUCCESS</em>&nbsp;</td><td>
<p>The operation succeeded. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9aa02266bd582bb24422be01a93d709b7c"></a>OTZ_PENDING</em>&nbsp;</td><td>
<p>The asynchronous operation is still pending. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90"></a>OTZ_ERROR_ACCESS_DENIED</em>&nbsp;</td><td>
<p>Access has been denied, or the item cannot be found. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9a41673c9f07fe677e9ec5ff1548ae37f0"></a>OTZ_ERROR_BUSY</em>&nbsp;</td><td>
<p>The system is busy. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9a7789ecf9ebab693d4a66a6b092152f7a"></a>OTZ_ERROR_CANCEL</em>&nbsp;</td><td>
<p>The execution was cancelled. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9a0678f84ec4430a7268192c2a16b141e0"></a>OTZ_ERROR_COMMUNICATION</em>&nbsp;</td><td>
<p>There is a system communication error. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9af6511e3f523080e2690708d86c6f73b6"></a>OTZ_ERROR_DECODE_NO_DATA</em>&nbsp;</td><td>
<p>The decoder ran out of data. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9ada9828a22e4e297c7428d883d1ad09d7"></a>OTZ_ERROR_DECODE_TYPE</em>&nbsp;</td><td>
<p>The decoder hit a type error. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9aea980bb9abe6250d2b89ae8095b9bcdb"></a>OTZ_ERROR_ENCODE_FORMAT</em>&nbsp;</td><td>
<p>The encoded data is of a bad format. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1"></a>OTZ_ERROR_ENCODE_MEMORY</em>&nbsp;</td><td>
<p>The encoder ran out of memory. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9a011416e65f00b25a21592c87267eb9bd"></a>OTZ_ERROR_GENERIC</em>&nbsp;</td><td>
<p>An unspecified error has occurred. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898"></a>OTZ_ERROR_ILLEGAL_ARGUMENT</em>&nbsp;</td><td>
<p>A bad parameter has been specified. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9a17a59e90aad673eacadb8490283f5499"></a>OTZ_ERROR_ILLEGAL_STATE</em>&nbsp;</td><td>
<p>A state machine has been violated. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9af73e3a356497d98c0f50006d4c81c34c"></a>OTZ_ERROR_MEMORY</em>&nbsp;</td><td>
<p>There is not enough memory to perform the operation. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9a0669e32ad6657b360501a030dc12d4db"></a>OTZ_ERROR_NOT_IMPLEMENTED</em>&nbsp;</td><td>
<p>The functionality is not implemented. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9a691b50310f084199e603624440c5661c"></a>OTZ_ERROR_SECURITY</em>&nbsp;</td><td>
<p>There is a security error. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9aca66b378fc1c26b5990a5edc5f334a55"></a>OTZ_ERROR_SERVICE</em>&nbsp;</td><td>
<p>The service has returned an error in the service return code. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9aaba8258839dda54e4cc75e59856ec2e4"></a>OTZ_ERROR_SHORT_BUFFER</em>&nbsp;</td><td>
<p>The input buffer is not long enough. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a81a7b5c8f80e9d01805dc40edeea10b9a323328909603b4a09891fb854cd15c5c"></a>OTZ_ERROR_UNDEFINED</em>&nbsp;</td><td>
<p>The implementation has reached an UNDEFINED condition. </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00045">45</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>
<div class="fragment"><div class="line">                     {</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a> = 0x0,             </div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aa02266bd582bb24422be01a93d709b7c">OTZ_PENDING</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a41673c9f07fe677e9ec5ff1548ae37f0">OTZ_ERROR_BUSY</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a7789ecf9ebab693d4a66a6b092152f7a">OTZ_ERROR_CANCEL</a> , </div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a0678f84ec4430a7268192c2a16b141e0">OTZ_ERROR_COMMUNICATION</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9af6511e3f523080e2690708d86c6f73b6">OTZ_ERROR_DECODE_NO_DATA</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9ada9828a22e4e297c7428d883d1ad09d7">OTZ_ERROR_DECODE_TYPE</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aea980bb9abe6250d2b89ae8095b9bcdb">OTZ_ERROR_ENCODE_FORMAT</a> , </div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a011416e65f00b25a21592c87267eb9bd">OTZ_ERROR_GENERIC</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a17a59e90aad673eacadb8490283f5499">OTZ_ERROR_ILLEGAL_STATE</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9af73e3a356497d98c0f50006d4c81c34c">OTZ_ERROR_MEMORY</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a0669e32ad6657b360501a030dc12d4db">OTZ_ERROR_NOT_IMPLEMENTED</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a691b50310f084199e603624440c5661c">OTZ_ERROR_SECURITY</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aca66b378fc1c26b5990a5edc5f334a55">OTZ_ERROR_SERVICE</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aaba8258839dda54e4cc75e59856ec2e4">OTZ_ERROR_SHORT_BUFFER</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a323328909603b4a09891fb854cd15c5c">OTZ_ERROR_UNDEFINED</a> </div>
<div class="line">};</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a3fe48bdd74929ed4185c179a0f087289"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289">otz_login_flags</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Login flag constants. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a3fe48bdd74929ed4185c179a0f087289a72d4e75761f064b02737dc378962df5a"></a>OTZ_LOGIN_PUBLIC</em>&nbsp;</td><td>
<p>No login is to be used. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a3fe48bdd74929ed4185c179a0f087289ab66aa7bb2b4bd01817e22a93314a85b3"></a>OTZ_LOGIN_CLIENT_DATA</em>&nbsp;</td><td>
<p>A buffer of client data is to be provided. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a3fe48bdd74929ed4185c179a0f087289ab846d165bf78bb9a06c31f3e374d029f"></a>OTZ_LOGIN_USER</em>&nbsp;</td><td>
<p>The user executing the application is provided. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a3fe48bdd74929ed4185c179a0f087289afb900e9068dc1808ac61df3c66131ae7"></a>OTZ_LOGIN_GROUP</em>&nbsp;</td><td>
<p>The user group executing the application is provided. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a3fe48bdd74929ed4185c179a0f087289a61dfb65b8c83672b1b2ac9bd199efb52"></a>OTZ_LOGIN_NAME</em>&nbsp;</td><td>
<p>The name of the application is provided; may include path. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a3fe48bdd74929ed4185c179a0f087289a51956a69be9da7227a1d9b13e36f6f81"></a>OTZ_LOGIN_DIGEST</em>&nbsp;</td><td>
<p>The digest of the client application is provided. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a3fe48bdd74929ed4185c179a0f087289a55e23f644bd720f3629676afb37bf4ab"></a>OTZ_LOGIN_ALL</em>&nbsp;</td><td>
<p>A utility constant indicating all available login types should be used. </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00126">126</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>
<div class="fragment"><div class="line">                     {</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289a72d4e75761f064b02737dc378962df5a">OTZ_LOGIN_PUBLIC</a> = 0x0,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289ab66aa7bb2b4bd01817e22a93314a85b3">OTZ_LOGIN_CLIENT_DATA</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289ab846d165bf78bb9a06c31f3e374d029f">OTZ_LOGIN_USER</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289afb900e9068dc1808ac61df3c66131ae7">OTZ_LOGIN_GROUP</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289a61dfb65b8c83672b1b2ac9bd199efb52">OTZ_LOGIN_NAME</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289a51956a69be9da7227a1d9b13e36f6f81">OTZ_LOGIN_DIGEST</a> , </div>
<div class="line">    <a class="code" href="otz__api_8h.html#a3fe48bdd74929ed4185c179a0f087289a55e23f644bd720f3629676afb37bf4ab">OTZ_LOGIN_ALL</a></div>
<div class="line">};</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac2b9c7ed6d9ebe7cdc56921f2f4ce6ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ff">otz_param_type</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Param type constants. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="ac2b9c7ed6d9ebe7cdc56921f2f4ce6ffa10b853b752b4cd31ca98321d86ec3db4"></a>OTZ_PARAM_IN</em>&nbsp;</td><td>
<p>In parameter for read operations. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ac2b9c7ed6d9ebe7cdc56921f2f4ce6ffa5c86bb59cf47117648ab204158c8b2f9"></a>OTZ_PARAM_OUT</em>&nbsp;</td><td>
<p>Out parameter for write operations. </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00178">178</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>
<div class="fragment"><div class="line">                    {</div>
<div class="line">    <a class="code" href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ffa10b853b752b4cd31ca98321d86ec3db4">OTZ_PARAM_IN</a> = 0x0,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ffa5c86bb59cf47117648ab204158c8b2f9">OTZ_PARAM_OUT</a></div>
<div class="line">};</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0726f9cc52e17d8e6cd7dd085cc62527"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527">otz_shared_mem_flags</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Shared memory flag constants. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a0726f9cc52e17d8e6cd7dd085cc62527a7aa74f7037354b0cd675442b600060c0"></a>OTZ_MEM_SERVICE_RO</em>&nbsp;</td><td>
<p>Service can only read from the memory block. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a0726f9cc52e17d8e6cd7dd085cc62527a8035deccf29fcd9fe345e3f3e0e4accb"></a>OTZ_MEM_SERVICE_WO</em>&nbsp;</td><td>
<p>Service can only write from the memory block. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a0726f9cc52e17d8e6cd7dd085cc62527a33f6f503a1e274dc317a34352157100c"></a>OTZ_MEM_SERVICE_RW</em>&nbsp;</td><td>
<p>Service can read and write from the memory block. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a0726f9cc52e17d8e6cd7dd085cc62527aa462fe85425a0bde33600ba164e20325"></a>OTZ_MEM_SERVICE_UNDEFINED</em>&nbsp;</td><td>
<p>Invalid flag </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a0726f9cc52e17d8e6cd7dd085cc62527a7aa74f7037354b0cd675442b600060c0"></a>OTZ_MEM_SERVICE_RO</em>&nbsp;</td><td>
<p>Service can only read from the memory block. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a0726f9cc52e17d8e6cd7dd085cc62527a8035deccf29fcd9fe345e3f3e0e4accb"></a>OTZ_MEM_SERVICE_WO</em>&nbsp;</td><td>
<p>Service can only write from the memory block. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a0726f9cc52e17d8e6cd7dd085cc62527a33f6f503a1e274dc317a34352157100c"></a>OTZ_MEM_SERVICE_RW</em>&nbsp;</td><td>
<p>Service can read and write from the memory block. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a0726f9cc52e17d8e6cd7dd085cc62527aa462fe85425a0bde33600ba164e20325"></a>OTZ_MEM_SERVICE_UNDEFINED</em>&nbsp;</td><td>
<p>Invalid flag </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00148">148</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>
<div class="fragment"><div class="line">                          {</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a7aa74f7037354b0cd675442b600060c0">OTZ_MEM_SERVICE_RO</a> = 0x0,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a8035deccf29fcd9fe345e3f3e0e4accb">OTZ_MEM_SERVICE_WO</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a33f6f503a1e274dc317a34352157100c">OTZ_MEM_SERVICE_RW</a>,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527aa462fe85425a0bde33600ba164e20325">OTZ_MEM_SERVICE_UNDEFINED</a></div>
<div class="line">};</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af7e5410bcac27927f8e1df8d0579063b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063b">otz_state_machine_state_const</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>State machine constants. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9"></a>OTZ_STATE_UNDEFINED</em>&nbsp;</td><td>
<p>Structures in the UNDEFINED state may have any value for their state constant; it may not exist as an explicit value.Clients should never make use of this constant, although an implementation may use it internally for debugging purposes. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172"></a>OTZ_STATE_INVALID</em>&nbsp;</td><td>
<p>The state is in a safe invalid state. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3"></a>OTZ_STATE_OPEN</em>&nbsp;</td><td>
<p>The state is open. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af7e5410bcac27927f8e1df8d0579063ba96dd245ead2dc47347e8d4e26c037614"></a>OTZ_STATE_CLOSING</em>&nbsp;</td><td>
<p>The state is closing, but not yet closed. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af7e5410bcac27927f8e1df8d0579063bacfa218bc516a757e26a7248eb959fb7e"></a>OTZ_STATE_ENCODE</em>&nbsp;</td><td>
<p>The state an operation that is not running and can accept data to be encoded. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af7e5410bcac27927f8e1df8d0579063ba218a34ca51a29c286a5ec794347d915b"></a>OTZ_STATE_PERFORMABLE</em>&nbsp;</td><td>
<p>The state of an operation that is not running, but which cannot accept data to be encoded. This state applies only to close operations. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af7e5410bcac27927f8e1df8d0579063ba2d1d39b46fb1b8a045558802f26d14d8"></a>OTZ_STATE_RUNNING</em>&nbsp;</td><td>
<p>The state of an operation that is executing synchronously. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af7e5410bcac27927f8e1df8d0579063bac4b86484404dcee83015799253d5356d"></a>OTZ_STATE_RUNNING_ASYNC</em>&nbsp;</td><td>
<p>The state of an operation that is executing asynchronously. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a"></a>OTZ_STATE_DECODE</em>&nbsp;</td><td>
<p>The state of an operation that can have data read using the decoder functions. </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00090">90</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>
<div class="fragment"><div class="line">                                   {</div>
<div class="line">    <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9">OTZ_STATE_UNDEFINED</a> = 0x0,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba96dd245ead2dc47347e8d4e26c037614">OTZ_STATE_CLOSING</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bacfa218bc516a757e26a7248eb959fb7e">OTZ_STATE_ENCODE</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba218a34ca51a29c286a5ec794347d915b">OTZ_STATE_PERFORMABLE</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba2d1d39b46fb1b8a045558802f26d14d8">OTZ_STATE_RUNNING</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bac4b86484404dcee83015799253d5356d">OTZ_STATE_RUNNING_ASYNC</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a">OTZ_STATE_DECODE</a> </div>
<div class="line">};</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6e2349cbd9eb83af61bcd4fe3f9eeb74"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74">otz_type_of_operation</a></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Operation type constants. </p>
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="a6e2349cbd9eb83af61bcd4fe3f9eeb74ae3426ea3b47e48669f0994c9b7f69a06"></a>OTZ_OPERATION_OPEN</em>&nbsp;</td><td>
<p>Open operation </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a6e2349cbd9eb83af61bcd4fe3f9eeb74a2d4af296381db71825daa2f33e2ce4ba"></a>OTZ_OPERATION_INVOKE</em>&nbsp;</td><td>
<p>Invoke operation </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a6e2349cbd9eb83af61bcd4fe3f9eeb74aa8869f3ce511b3a269235c8fd1ad5f63"></a>OTZ_OPERATION_CLOSE</em>&nbsp;</td><td>
<p>Close operation </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="a6e2349cbd9eb83af61bcd4fe3f9eeb74a4370cd5fbe2631ca67965cc40786f86f"></a>OTZ_OPERATION_NONE</em>&nbsp;</td><td>
<p>No operation will be performed </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8h_source.html#l00163">163</a> of file <a class="el" href="otz__api_8h_source.html">otz_api.h</a>.</p>
<div class="fragment"><div class="line">                           {</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74ae3426ea3b47e48669f0994c9b7f69a06">OTZ_OPERATION_OPEN</a> = 0x0,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74a2d4af296381db71825daa2f33e2ce4ba">OTZ_OPERATION_INVOKE</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74aa8869f3ce511b3a269235c8fd1ad5f63">OTZ_OPERATION_CLOSE</a> ,</div>
<div class="line">    <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74a4370cd5fbe2631ca67965cc40786f86f">OTZ_OPERATION_NONE</a></div>
<div class="line">};</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a06653a27f5781a86e489d33952f598cf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* otz_decode_array_space </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> *&#160;</td>
          <td class="paramname"><em>plength</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Decode a block of binary data from the message. </p>
<p>This function decodes a block of binary data from the current offset in the structured message returned by the service. The length of the block is returned in *pui_length and the base pointer is the function return value.</p>
<p>The implementation must guarantee that the returned buffer allocation is aligned on an eight byte boundary, enabling direct sharing of any C data type in accordance with the ARM Application Binary Interface [ARM IHI 0036A].</p>
<p>It is expected that this function will return a pointer to the binary data in the encoder buffer. The client must make use of this memory before the operation is released. After the operation is released the client must not access the buffer again. If the data is needed locally after the operation has been released it must first be copied into a client allocated memory block.</p>
<p>If on entry the decoder is in an error state this function does nothing and returns NULL, with pui_length set to 0. The state of the decoder remains unchanged.</p>
<p>If the decoder error state is not set on entry, the system attempts to decode the data item at the current offset in the decoder and return the result. If an error occurs this function returns NULL as the base pointer, sets the length to 0, and sets the error state of the decoder. Otherwise the data value is returned by the function, and the decoder offset is incremented past the array item in the decoder.</p>
<p>Note that this function may decode a NULL array and a zero length array as valid types. In the former case the return value is NULL and the length is zero. In the second case the return value is non-NULL and the length is zero – the pointer must not be dereferenced by the client.</p>
<p>The decoder may return errors in the following situations:<br/>
 • There are no more items in the decoder.<br/>
 • The item in the decoder is not of the type requested.</p>
<p>Undefined Behavior<br/>
 The following situations result in UNDEFINED behavior:<br/>
 Calling with psOperation set to NULL.<br/>
 Calling with psOperation pointing to an operation not in the state OTZ_STATE_DECODE. <br/>
 Calling with puiLength set to NULL.<br/>
</p>
<p>Output:<br/>
 This function will set the state of the decoder to OTZ_ERROR_DECODE_NO_DATA if there is no further data to decode.</p>
<p>This function may optionally check the type of the data returned, and may set the state of the decoder to OTZ_ERROR_DECODE_TYPE if there is a type mismatch. The presence of type checking in the library is implementation-defined; to ensure safety, clients must check the value of returned data to ensure that it meets any critical criteria.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td>- The operation from which we are decoding the array. </td></tr>
    <tr><td class="paramname">plength</td><td>- The pointer to the variable that will contain the array length on exit.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- The value of the data item on success, 0 on any error.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
    <tr><td class="paramname">plength</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l01192">1192</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(otz_check_decode(ps_operation)) {</div>
<div class="line">        *plength = 0;</div>
<div class="line">        <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.encode_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line"></div>
<div class="line">    ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                    <a class="code" href="otz__client_8h.html#a85758d78a3f7a7d60fd05b5561ca7e66">OTZ_CLIENT_IOCTL_DEC_ARRAY_SPACE</a>, &amp;<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (ret)</div>
<div class="line">    {</div>
<div class="line">        *plength = 0;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ae3ac49dcf8f3ce9b92e2f3c7004b94d2">dec_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9af6511e3f523080e2690708d86c6f73b6">OTZ_ERROR_DECODE_NO_DATA</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    *plength = <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.len;</div>
<div class="line">return_func:    </div>
<div class="line">    <span class="keywordflow">return</span> (<span class="keywordtype">void</span>*)<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data;</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a54fb04a14c11e1a4ce77c828eb232379"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_decode_get_error </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get decode error. </p>
<p>This function returns the error state of the decoder associated with the given operation.</p>
<p>This function does not affect the error state of the decoder.</p>
<p>Undefined Behavior<br/>
 The following situations result in UNDEFINED behavior:<br/>
 Calling with psOperation set to NULL.<br/>
 Calling with psOperation pointing to an operation not in the state OTZ_STATE_DECODE.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td>- The operation from which we are retrieving the result.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- OTZ_SUCCESS: There have been no decoding errors.<br/>
 OTZ_ERROR_*: The first decoder error to occur.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l01277">1277</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span>  ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ae3ac49dcf8f3ce9b92e2f3c7004b94d2">dec_error_state</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a59d3ca17d318082f1fb5ea24b3e8698f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> otz_decode_get_type </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the decoder stream data type. </p>
<p>This function returns the type of the data at the current offset in the decoder stream.</p>
<p>This function does not affect the error state of the decoder.</p>
<p>Undefined Behavior<br/>
 The following situations result in UNDEFINED behavior:<br/>
 Calling with psOperation set to NULL.<br/>
 Calling with psOperation pointing to an operation not in the state OTZ_STATE_DECODE.<br/>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td>- The operation from which we are retrieving the result.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- OTZ_TYPE_NONE: There is no more data.<br/>
 OTZ_TYPE_UINT32: The next item in the decode stream is a uint32.<br/>
 OTZ_TYPE_ARRAY: The next item in the decode string is an array.<br/>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l01232">1232</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> type = <a class="code" href="otz__api_8h.html#a543151d0e3457a37a15b96ab02e4418daee4efd202332a908cb06565feedb5b59">OTZ_TYPE_NONE</a>, ret;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(!ps_operation)</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> != <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a">OTZ_STATE_DECODE</a>) </div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ae3ac49dcf8f3ce9b92e2f3c7004b94d2">dec_error_state</a> != <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>)</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.encode_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line"></div>
<div class="line">    ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                    <a class="code" href="otz__client_8h.html#adc6a7391c4371e38b98d0426c03f1ce3">OTZ_CLIENT_IOCTL_GET_DECODE_TYPE</a>, &amp;<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (ret)</div>
<div class="line">    {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>((<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data == <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beacafbe80d88442cff08f386a74daf8bb9c8">OTZ_ENC_UINT32</a>)</div>
<div class="line">        type = <a class="code" href="otz__api_8h.html#a543151d0e3457a37a15b96ab02e4418dacb08736841422c177ff05b448b3f27ca">OTZ_TYPE_UINT32</a>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(((<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data == <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca5ecfa72c778a2f9613acbfe530866856">OTZ_ENC_ARRAY</a>) || </div>
<div class="line">            ((<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data == <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca12d03340e4613f9875953e9a2ea969f5">OTZ_MEM_REF</a>))</div>
<div class="line">        type = <a class="code" href="otz__api_8h.html#a543151d0e3457a37a15b96ab02e4418dadab265691fd16eba9ef0938d35fc2d20">OTZ_TYPE_ARRAY</a>;        </div>
<div class="line"></div>
<div class="line"></div>
<div class="line">return_func:    </div>
<div class="line">    <span class="keywordflow">return</span> type;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac73c45b1f13368b895d888b1af02b122"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> otz_decode_uint32 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Decode a unsigned 32-bit integer value from message. </p>
<p>This function decodes a single item of type uint32_t from the current offset in the structured message returned by the service.</p>
<p>If on entry the decoder is in an error state this function does nothing and returns 0. The state of the decoder remains unchanged.</p>
<p>If the decoder error state is not set on entry, the system attempts to decode the data item at the current offset in the decoder and return the result.</p>
<p>If an error occurs this function returns 0 and sets the error state of the decoder. Otherwise the data value is returned by the function and the decoder offset is incremented past the item that has been decoded.</p>
<p>The decoder may set its error state in the following situations:<br/>
 There are no more items in the decoder.<br/>
 The item in the decoder is not of the type requested.<br/>
</p>
<p>Undefined Behavior<br/>
 The following situations result in UNDEFINED behavior:<br/>
 Calling with "operation" set to NULL.<br/>
 Calling with "operation" pointing to an operation not in the state OTZ_STATE_DECODE.</p>
<p>Output<br/>
 This function will set the state of the decoder to OTZ_ERROR_DECODE_NO_DATA if there is no further data to decode.</p>
<p>This function may optionally check the type of the data returned and may set the state of the decoder to OTZ_ERROR_DECODE_TYPE if there is a type mismatch. The presence of type checking in the library is implementation-defined; to ensure safety, clients must check the value of returned data to ensure that it meets any critical criteria.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td>- The operation from which we decoding the integer.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- The value of the data item on success, 0 on any error.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l01155">1155</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(otz_check_decode(ps_operation)) {</div>
<div class="line">       *((<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>*)<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data) = 0;</div>
<div class="line">       <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.encode_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.len  = <span class="keyword">sizeof</span>(<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>);</div>
<div class="line"></div>
<div class="line">    ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                    <a class="code" href="otz__client_8h.html#a3a906c6822ed16423cf394d12c4eee26">OTZ_CLIENT_IOCTL_DEC_UINT32</a>, &amp;<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (ret) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ae3ac49dcf8f3ce9b92e2f3c7004b94d2">dec_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9af6511e3f523080e2690708d86c6f73b6">OTZ_ERROR_DECODE_NO_DATA</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">       *((<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>*)<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data) = 0;</div>
<div class="line">       <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line">return_func:</div>
<div class="line">    <span class="keywordflow">return</span> *((<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>*)<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data);</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afaa5ecb61e5d492cf6da006dffd3bb2d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_device_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__device__t.html">otz_device_t</a> *&#160;</td>
          <td class="paramname"><em>ps_device</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Close the device connection. </p>
<p>This function closes a connection with a device, freeing any associated resources. If the passed device is in the state OTZ_STATE_INVALID this function must set to the state to OTZ_STATE_UNDEFINED and return OTZ_SUCCESS.</p>
<p>If the passed device is in the state OTZ_STATE_OPEN with a session count of zero this function must delete the device. This operation cannot fail; the function must always set the state to OTZ_STATE_UNDEFINED and return OTZ_SUCCESS.</p>
<p>If the passed device is in the state OTZ_STATE_OPEN with a non-zero session count, this function must return OTZ_ERROR_ILLEGAL_STATE and leave the device unmodified.</p>
<p>Undefined Behavior<br/>
 The following situations result in UNDEFINED behavior:<br/>
 Calling with device set to NULL.<br/>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_device,:</td><td>A pointer to the device to delete.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>OTZ_SUCCESS: The device is successfully closed.<br/>
 OTZ_ERROR_ILLEGAL_STATE: The device is in the state OTZ_STATE_OPEN and has a non-zero session count.<br/>
 OTZ_ERROR_*: An implementation-defined error code for any other error.<br/>
*</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_device</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00763">763</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(!ps_device)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;d_close \n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">if</span> (ps_device-&gt;<a class="code" href="structotz__device__t.html#a183baef0c51d87da02961ea0abc591fe">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>)</div>
<div class="line">    {</div>
<div class="line">        ps_device-&gt;<a class="code" href="structotz__device__t.html#a183baef0c51d87da02961ea0abc591fe">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9">OTZ_STATE_UNDEFINED</a>;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ps_device-&gt;<a class="code" href="structotz__device__t.html#a183baef0c51d87da02961ea0abc591fe">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(ps_device-&gt;<a class="code" href="structotz__device__t.html#ad2a9008616d4b2f37a5eef14c8ebaa34">session_count</a> == 0)</div>
<div class="line">        {</div>
<div class="line">            printf(<span class="stringliteral">&quot;device closed \n&quot;</span>);</div>
<div class="line">            <a class="code" href="virtual__keyboard__app_8c.html#ae8a3b46baffb627f3917b08c4b84c49d">close</a>(ps_device-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>);</div>
<div class="line">            ps_device-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a> = 0;</div>
<div class="line">            ps_device-&gt;<a class="code" href="structotz__device__t.html#a183baef0c51d87da02961ea0abc591fe">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9">OTZ_STATE_UNDEFINED</a>;</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ps_device-&gt;<a class="code" href="structotz__device__t.html#ad2a9008616d4b2f37a5eef14c8ebaa34">session_count</a> != 0){</div>
<div class="line">            printf(<span class="stringliteral">&quot;warning: pending open sessions %d\n&quot;</span>, </div>
<div class="line">                        ps_device-&gt;<a class="code" href="structotz__device__t.html#ad2a9008616d4b2f37a5eef14c8ebaa34">session_count</a>);</div>
<div class="line">            ps_device-&gt;<a class="code" href="structotz__device__t.html#a49b91b73a55549b4e3ffebb22d011287">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a17a59e90aad673eacadb8490283f5499">OTZ_ERROR_ILLEGAL_STATE</a>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a323328909603b4a09891fb854cd15c5c">OTZ_ERROR_UNDEFINED</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a55d0b5b18114d5553e2546c50ab3b0b5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_device_get_timelimit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__device__t.html">otz_device_t</a> *&#160;</td>
          <td class="paramname"><em>ps_device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>ui_timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__timelimit__t.html">otz_timelimit_t</a> *&#160;</td>
          <td class="paramname"><em>ps_timelimit</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get local time limit. </p>
<p>Calling this function generates a device-local absolute time limit in the structure pointed to by ps_time_limit from a timeout value ui_timeout. The absolute time limit is equal to the current time plus the specified timeout.</p>
<p>Undefined Behavior: The following situations result in UNDEFINED behavior: <br/>
 Calling with device set to NULL.<br/>
 Calling with device pointing to a device in the state OTZ_STATE_INVALID.<br/>
 Calling with time_limit set to NULL. <br/>
 Use of the time limit outside of the device in which it was created.<br/>
 </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_device,:</td><td>A pointer to the device </td></tr>
    <tr><td class="paramname">ui_timeout,:</td><td>The required relative timeout, in milliseconds. </td></tr>
    <tr><td class="paramname">ps_timelimit,:</td><td>A pointer to the time limit structure to populate.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>OTZ_SUCCESS: the time limit was created successfully.<br/>
 OTZ_ERROR_*: an implementation-defined error code for any other error.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_device</td><td></td></tr>
    <tr><td class="paramname">ui_timeout</td><td></td></tr>
    <tr><td class="paramname">ps_timelimit</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00101">101</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a0669e32ad6657b360501a030dc12d4db">OTZ_ERROR_NOT_IMPLEMENTED</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a29270e916339ced6667bc280ce48aa31"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_device_open </td>
          <td>(</td>
          <td class="paramtype">void const *&#160;</td>
          <td class="paramname"><em>pk_device_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void const *&#160;</td>
          <td class="paramname"><em>pk_init</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__device__t.html">otz_device_t</a> *&#160;</td>
          <td class="paramname"><em>ps_device</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Open the device. </p>
<p>This function opens a connection with the device in the underlying operating environment that represents the secure environment. When the client no longer requires the device it must call otz_device_close to close the connection and free any associated resources. This function accepts a pointer to a <a class="el" href="structotz__device__t.html" title="The otz_device_t structure is used to contain control information related to the device.">otz_device_t</a> structure assumed to be in the OTZ_STATE_UNDEFINED state. On success this function must set the device structure *ps_device to the state OTZ_STATE_OPEN with a session count of zero. On failure, the device is set to the state OTZ_STATE_INVALID. It is possible to create multiple concurrent device connections from a single client. The number of devices that can be supported globally within the entire system, or locally within a single client, is implementation-defined.</p>
<p>Undefined Behavior: The following situations result in UNDEFINED behavior: <br/>
 Calling with device set to NULL. <br/>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pk_device_name,:</td><td>An implementation-defined binary buffer, used to identify the underlying device to connect to. If this is NULL, the implementation will use an internally defined default device name.</td></tr>
    <tr><td class="paramname">pk_init,:</td><td>An implementation-defined binary block used to configure the implementation. If this is NULL, the implementation will use predefined default values for the library configuration</td></tr>
    <tr><td class="paramname">ps_device,:</td><td>A pointer to the device structure.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_SUCCESS: The device was successfully opened. <br/>
 OTZ_ERROR_*: An implementation-defined error code for any other error.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pk_device_name</td><td></td></tr>
    <tr><td class="paramname">pk_init</td><td></td></tr>
    <tr><td class="paramname">ps_device</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00051">51</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret=0;</div>
<div class="line">    <span class="keywordflow">if</span>(ps_device == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;tz_device_open : Device is null\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(pk_device_name == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;/dev/otz_client is assigned as default device\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        pk_device_name = <span class="stringliteral">&quot;/dev/otz_client&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(pk_init == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;Device is opened as Read-only by default\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        pk_init = O_RDONLY;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ret = open(pk_device_name, (<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)pk_init); </div>
<div class="line">    <span class="keywordflow">if</span>( ret == -1){</div>
<div class="line">        ps_device-&gt;<a class="code" href="structotz__device__t.html#a183baef0c51d87da02961ea0abc591fe">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;</div>
<div class="line">        ps_device-&gt;<a class="code" href="structotz__device__t.html#a49b91b73a55549b4e3ffebb22d011287">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a011416e65f00b25a21592c87267eb9bd">OTZ_ERROR_GENERIC</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span>{</div>
<div class="line">        ps_device-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a> = ret ;</div>
<div class="line">        ps_device-&gt;<a class="code" href="structotz__device__t.html#a183baef0c51d87da02961ea0abc591fe">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a>;</div>
<div class="line">        ps_device-&gt;<a class="code" href="structotz__device__t.html#ad2a9008616d4b2f37a5eef14c8ebaa34">session_count</a> = 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a92380414c091abe1de0b23d63f426bcf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void otz_encode_array </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void const *&#160;</td>
          <td class="paramname"><em>pk_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>param_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encode binary array to the encoded message. </p>
<p>Calling this function appends a binary array pointed to by array and of length length bytes to the end ofthe encoded message. The implementation must guarantee that when decoding the array in the service the base pointer is eight byte aligned to enable any basic C data structure to be exchanged using this method.</p>
<p>It is valid behavior to encode a zero length array, where array is not NULL but uiLength is 0, and a NULL array, where array is NULL and length is zero, using this function.</p>
<p>This function can only be called when the operation is in the state OTZ_STATE_ENCODE. This occurs after the operation has been prepared, but before it has been performed.</p>
<p>If an error occurs, for example if there is no more space in the encoder buffer, this function sets the error state of the encoder.</p>
<p>This function does nothing if the error state of the encoder is already set upon entry.</p>
<p>Undefined Behavior<br/>
 The following situations result in UNDEFINED behavior:<br/>
 Calling with operation set to NULL.<br/>
 Calling with operation pointing to an operation in a state other than OTZ_STATE_ENCODE.<br/>
 Calling with array set to NULL when length is a length other than 0.</p>
<p>Output<br/>
 This function may set the state of the encoder to OTZ_ERROR_ENCODE_MEMORY if there is insufficient space to encode the array.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td>- A pointer to the operation for which we are encoding. </td></tr>
    <tr><td class="paramname">pk_array</td><td>- A pointer to the binary buffer to encode. </td></tr>
    <tr><td class="paramname">length</td><td>- The length of the binary buffer in bytes. </td></tr>
    <tr><td class="paramname">param_type</td><td>- In or out data</td></tr>
    <tr><td class="paramname">ps_operation</td><td></td></tr>
    <tr><td class="paramname">pk_array</td><td></td></tr>
    <tr><td class="paramname">length</td><td></td></tr>
    <tr><td class="paramname">param_type</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00869">869</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> enc;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(check_encode(ps_operation))</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="structotz__client__encode__cmd.html#af88abf923e07a4c493758d604921b6bd">param_type</a> == <a class="code" href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ffa5c86bb59cf47117648ab204158c8b2f9">OTZ_PARAM_OUT</a>) {</div>
<div class="line">    perror(<span class="stringliteral">&quot;use encode array space for out buffer\n&quot;</span>);</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    enc.encode_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">    enc.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">    enc.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">    enc.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line"></div>
<div class="line">    enc.data = (<span class="keywordtype">void</span>*)pk_array;</div>
<div class="line">    enc.len  = length;</div>
<div class="line">    enc.param_type = <a class="code" href="structotz__client__encode__cmd.html#af88abf923e07a4c493758d604921b6bd">param_type</a>;</div>
<div class="line"></div>
<div class="line">    ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                    <a class="code" href="otz__client_8h.html#a5191da7defc442a4fd60f2db6127313a">OTZ_CLIENT_IOCTL_ENC_ARRAY</a>, &amp;enc);</div>
<div class="line">    <span class="keywordflow">if</span> (ret) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a> = enc.encode_id;</div>
<div class="line">    }</div>
<div class="line">     </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a74f4f32cc597cb04c352f0faaf353259"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* otz_encode_array_space </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>param_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encode empty binary array to the encoded message. </p>
<p>Calling this function appends an empty binary array of length "length" bytes to the end of the encoded message and returns the pointer to this array to the client. This allows an implementation with fewer copies, as the encoder buffer can be filled directly by the client without needing a copy from an intermediate buffer into the real encoder buffer.</p>
<p>The implementation must guarantee that the returned buffer allocation is aligned on an eight byte boundary, enabling direct sharing of any C data type in accordance with the ARM Application Binary Interface [ARM IHI 0036A].</p>
<p>It is valid behavior to allocate space for a zero length array in the encoder stream. This will return a pointer that is not NULL, but this pointer must never be dereferenced by the client code or UNDEFINED behavior may result.</p>
<p>This function can only be called when the operation is in the state OTZ_STATE_ENCODE. This occurs after the operation has been prepared, but before it has been performed. Once the operation transitions out of the state OTZ_STATE_ENCODE, which occurs if the operation is performed or is released, then the client must no longer access this buffer or UNDEFINED behavior may result.</p>
<p>If an error occurs, for example if there is no more space in the encoder buffer, this function sets the error state of the encoder and returns NULL.</p>
<p>This function does nothing if the error state of the encoder is already set upon entry, and will return NULL.</p>
<p>Undefined Behavior<br/>
 The following situations result in UNDEFINED behavior:<br/>
 Calling with operation set to NULL.<br/>
 Calling with operation pointing to an operation in a state other than OTZ_STATE_ENCODE.</p>
<p>Output<br/>
 This function may set the state of the encoder to OTZ_ERROR_ENCODE_MEMORY if there is insufficient space to encode the array space.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td>- A pointer to the operation for which we are encoding. </td></tr>
    <tr><td class="paramname">length</td><td>- The length of the desired binary buffer in bytes. </td></tr>
    <tr><td class="paramname">param_type</td><td>- In or Out data</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>- A pointer to the buffer, or NULL upon error.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
    <tr><td class="paramname">length</td><td></td></tr>
    <tr><td class="paramname">param_type</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00917">917</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> enc;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__session__shared__mem__info.html" title="Shared memory information for the session.">otz_session_shared_mem_info</a> mem_info;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">int</span> ret = 0, mmap_flags;</div>
<div class="line"></div>
<div class="line">    enc.data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(check_encode(ps_operation))</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a> &gt;= <a class="code" href="otz__api_8h.html#a12bcf1760a725c67f750d606944ae8ca">MAX_MEMBLOCKS_PER_OPERATION</a>) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> =  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    enc.encode_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">    enc.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">    enc.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">    enc.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line"></div>
<div class="line">    mmap_flags = PROT_READ | PROT_WRITE;</div>
<div class="line"></div>
<div class="line">    enc.data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    enc.data = mmap(0, length, mmap_flags , MAP_SHARED,</div>
<div class="line">                    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, 0);    </div>
<div class="line">    <span class="keywordflow">if</span>(enc.data != MAP_FAILED) {</div>
<div class="line">        mem_info.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a>;</div>
<div class="line">        mem_info.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a>;</div>
<div class="line">        mem_info.user_mem_addr = (<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)enc.data;</div>
<div class="line">        ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                <a class="code" href="otz__client_8h.html#aec1c031dce90c397aa85665e1e9ca9a3">OTZ_CLIENT_IOCTL_SHR_MEM_ALLOCATE_REQ</a>, &amp;mem_info);</div>
<div class="line">        <span class="keywordflow">if</span>(ret == -1) {</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">            <span class="keywordflow">goto</span> free_map_data;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        perror(<span class="stringliteral">&quot;memory_allocate - mmap failed\n&quot;</span>); </div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        enc.data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> =  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;        </div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    enc.len  = length;</div>
<div class="line">    enc.param_type = param_type;</div>
<div class="line">    enc.offset = 0;</div>
<div class="line">    enc.flags = <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a33f6f503a1e274dc317a34352157100c">OTZ_MEM_SERVICE_RW</a>;</div>
<div class="line"></div>
<div class="line">    ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                   <a class="code" href="otz__client_8h.html#a6daae0061fa52b147dfefc290f63a319">OTZ_CLIENT_IOCTL_ENC_ARRAY_SPACE</a>, &amp;enc);</div>
<div class="line">    <span class="keywordflow">if</span> (ret) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> free_map_data;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a> = enc.encode_id;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a81a4ced50943d64ef286314650814aa3">temp_mem</a>[ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a>].<a class="code" href="structotz__mem__reference.html#a39df1ac5f9057a74513b315c8359e9b4">shared_mem</a> </div>
<div class="line">                                                        = enc.data;</div>
<div class="line"></div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a81a4ced50943d64ef286314650814aa3">temp_mem</a>[ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a>].<a class="code" href="structotz__mem__reference.html#ac84a349830e146ab101bb365437f0e41">offset</a> </div>
<div class="line">                                                                    = 0;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a81a4ced50943d64ef286314650814aa3">temp_mem</a>[ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a>].<a class="code" href="structotz__mem__reference.html#ada48b7ba047eb0b21e2ea9fe81418482">length</a> </div>
<div class="line">                                                                    = length;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a81a4ced50943d64ef286314650814aa3">temp_mem</a>[ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a>].<a class="code" href="structotz__mem__reference.html#abded90096f65a46b8e151aebc39571bf">param_type</a> </div>
<div class="line">                                                                   = param_type;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a>++;        </div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> enc.data;</div>
<div class="line">  </div>
<div class="line">free_map_data:</div>
<div class="line">    mem_info.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a>;</div>
<div class="line">    mem_info.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a>;</div>
<div class="line">    mem_info.user_mem_addr = (<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)enc.data;</div>
<div class="line">    munmap(enc.data, length);</div>
<div class="line">    ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>,</div>
<div class="line">            <a class="code" href="otz__client_8h.html#acc330cddd9c28f9ee43644552166878d">OTZ_CLIENT_IOCTL_SHR_MEM_FREE_REQ</a>, &amp;mem_info);</div>
<div class="line">    enc.data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> =  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line"></div>
<div class="line">return_func:</div>
<div class="line">    <span class="keywordflow">return</span> enc.data;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4663159507afcef1df21e7b29bbb1c6c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void otz_encode_memory_reference </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a> *&#160;</td>
          <td class="paramname"><em>ps_shared_mem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>param_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Appends a reference of previously allocated shared block to the encoded buffer. </p>
<p>Calling this function appends a reference to a range of a previously created shared memory block.</p>
<p>Memory references are used to provide a synchronization token protocol which informs the service when it can read from or write to a portion of the shared memory block. A memory reference is associated with a specific operation and is valid only during the execution of that operation.</p>
<p>When the otz_encode_memory_reference function completes successfully the shared memory block is said to be “referenced”. This reference is destroyed when the operation perform function completes (with or without an error). If the operation is never performed for any reason, the reference is destroyed when the operation is released. A shared memory block cannot be released while is it still referenced in an operation. Once a memory reference has been created the client must not read from, or write to, the referenced range until the reference is destroyed.</p>
<p>Some implementations of the secure environment may not be able to implement genuine shared memory and/or may make use of device hardware outside of the core. In these cases the system may require data copies or cache maintenance operations to ensure visibility of the data in a coherent manner. For this reason the memory reference is marked with a number of flags which can be used to ensure the correct copies and cache maintenance operations occur. Primarily these indicate the memory operations that the service is allowed to perform. Exactly one of the following flags must be specified:</p>
<p>OTZ_MEM_SERVICE_RO: The service can only read from the memory block.<br/>
 OTZ_MEM_SERVICE_WO: The service can only write to the memory block.<br/>
 OTZ_MEM_SERVICE_RW: The service can both read from and write to the memory block.</p>
<p>These flags must be a sub-set of the service permissions specified when the block was created using otz_shared_memory_allocate, otherwise the encoder error OTZ_ERROR_ENCODE_FORMAT will be raised.</p>
<p>If an error occurs, for example if there no more space in the encoder buffer or the range lies outside of the memory block, this function sets the error state of the encoder. Additionally, there is a restriction whereby the client cannot have multiple concurrent references to any address in the memory block. Attempting to write a memory reference that overlaps an existing one will result in the encoder entering an error state. In any of these cases the shared memory block is not referenced by calling this function.</p>
<p>This function does nothing if the error state of the encoder is already set upon entry.</p>
<p>Undefined Behavior<br/>
 The following situations result in UNDEFINED behavior:<br/>
 Calling with psOperation set to NULL.<br/>
 Calling with psOperation pointing to an operation in a state other than OTZ_STATE_ENCODE.<br/>
 Calling with ps_shared_mem set to NULL. Calling with ps_shared_mem pointing to a memory block in a state other than OTZ_STATE_OPEN.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td>- A pointer to the operation for which we are encoding. </td></tr>
    <tr><td class="paramname">ps_shared_mem</td><td>- A pointer to the shared memory block structure. </td></tr>
    <tr><td class="paramname">offset</td><td>- The offset, in bytes, from the start of the shared memory block to the start of the memory range. </td></tr>
    <tr><td class="paramname">length</td><td>- The length, in bytes, of the memory range. </td></tr>
    <tr><td class="paramname">flags</td><td>- The access flags for this memory reference. </td></tr>
    <tr><td class="paramname">param_type</td><td>- In or Out data</td></tr>
    <tr><td class="paramname">ps_operation</td><td></td></tr>
    <tr><td class="paramname">ps_shared_mem</td><td></td></tr>
    <tr><td class="paramname">offset</td><td></td></tr>
    <tr><td class="paramname">length</td><td></td></tr>
    <tr><td class="paramname">flags</td><td></td></tr>
    <tr><td class="paramname">param_type</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l01014">1014</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{    </div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> enc;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span>(check_encode(ps_operation))</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_shared_mem == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aea980bb9abe6250d2b89ae8095b9bcdb">OTZ_ERROR_ENCODE_FORMAT</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>((<a class="code" href="structotz__client__encode__cmd.html#a5090110ee136f28c5f2939b2b326d722">flags</a> == <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a7aa74f7037354b0cd675442b600060c0">OTZ_MEM_SERVICE_RO</a>) &amp;&amp; </div>
<div class="line">        (ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> != <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a7aa74f7037354b0cd675442b600060c0">OTZ_MEM_SERVICE_RO</a> &amp;&amp; </div>
<div class="line">         ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> != <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a33f6f503a1e274dc317a34352157100c">OTZ_MEM_SERVICE_RW</a>)) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aea980bb9abe6250d2b89ae8095b9bcdb">OTZ_ERROR_ENCODE_FORMAT</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>((<a class="code" href="structotz__client__encode__cmd.html#a5090110ee136f28c5f2939b2b326d722">flags</a> == <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a8035deccf29fcd9fe345e3f3e0e4accb">OTZ_MEM_SERVICE_WO</a>) &amp;&amp; </div>
<div class="line">        (ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> != <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a8035deccf29fcd9fe345e3f3e0e4accb">OTZ_MEM_SERVICE_WO</a> &amp;&amp; </div>
<div class="line">         ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> != <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a33f6f503a1e274dc317a34352157100c">OTZ_MEM_SERVICE_RW</a>)) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aea980bb9abe6250d2b89ae8095b9bcdb">OTZ_ERROR_ENCODE_FORMAT</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="structotz__client__encode__cmd.html#af88abf923e07a4c493758d604921b6bd">param_type</a> == <a class="code" href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ffa10b853b752b4cd31ca98321d86ec3db4">OTZ_PARAM_IN</a> &amp;&amp; <a class="code" href="structotz__client__encode__cmd.html#a5090110ee136f28c5f2939b2b326d722">flags</a> == <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a8035deccf29fcd9fe345e3f3e0e4accb">OTZ_MEM_SERVICE_WO</a>) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aea980bb9abe6250d2b89ae8095b9bcdb">OTZ_ERROR_ENCODE_FORMAT</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="structotz__client__encode__cmd.html#af88abf923e07a4c493758d604921b6bd">param_type</a> == <a class="code" href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ffa5c86bb59cf47117648ab204158c8b2f9">OTZ_PARAM_OUT</a> &amp;&amp; <a class="code" href="structotz__client__encode__cmd.html#a5090110ee136f28c5f2939b2b326d722">flags</a> == <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a7aa74f7037354b0cd675442b600060c0">OTZ_MEM_SERVICE_RO</a>) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aea980bb9abe6250d2b89ae8095b9bcdb">OTZ_ERROR_ENCODE_FORMAT</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(((<a class="code" href="structotz__client__encode__cmd.html#afb02027737a6491d2e520e2ed77672a6">offset</a> + length) &gt;  ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a28220f0262b41e7f1929f7df08857fa7">ui_length</a>)) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> =  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a> &gt;= <a class="code" href="otz__api_8h.html#a12bcf1760a725c67f750d606944ae8ca">MAX_MEMBLOCKS_PER_OPERATION</a>) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> =  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">#if 0    </span></div>
<div class="line"><span class="preprocessor"></span>    <span class="comment">/* check for the overlapped memory operation in the response buffer block */</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="structotz__client__encode__cmd.html#af88abf923e07a4c493758d604921b6bd">param_type</a> == <a class="code" href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ffa5c86bb59cf47117648ab204158c8b2f9">OTZ_PARAM_OUT</a>) {</div>
<div class="line">        <span class="keywordflow">for</span>(index = 0; index &lt; ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a> ; index++) {</div>
<div class="line">            <span class="keywordflow">if</span>( (ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[index].<a class="code" href="structotz__mem__reference.html#a39df1ac5f9057a74513b315c8359e9b4">shared_mem</a> == ps_shared_mem) &amp;&amp; </div>
<div class="line">                 (ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[index].<a class="code" href="structotz__mem__reference.html#abded90096f65a46b8e151aebc39571bf">param_type</a> == <a class="code" href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ffa5c86bb59cf47117648ab204158c8b2f9">OTZ_PARAM_OUT</a>)) {</div>
<div class="line">                <span class="keywordflow">if</span>(<a class="code" href="structotz__client__encode__cmd.html#afb02027737a6491d2e520e2ed77672a6">offset</a> &gt;= ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[index].<a class="code" href="structotz__mem__reference.html#ac84a349830e146ab101bb365437f0e41">offset</a> &amp;&amp; </div>
<div class="line">                    <a class="code" href="structotz__client__encode__cmd.html#afb02027737a6491d2e520e2ed77672a6">offset</a> &lt; (ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[index].<a class="code" href="structotz__mem__reference.html#ac84a349830e146ab101bb365437f0e41">offset</a> + </div>
<div class="line">                            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[index].<a class="code" href="structotz__mem__reference.html#ada48b7ba047eb0b21e2ea9fe81418482">length</a>)) {</div>
<div class="line">                    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> =  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span>((<a class="code" href="structotz__client__encode__cmd.html#afb02027737a6491d2e520e2ed77672a6">offset</a> + length) &gt;= ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[index].<a class="code" href="structotz__mem__reference.html#ac84a349830e146ab101bb365437f0e41">offset</a> &amp;&amp; </div>
<div class="line">                    (<a class="code" href="structotz__client__encode__cmd.html#afb02027737a6491d2e520e2ed77672a6">offset</a> + length) &lt; (ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[index].<a class="code" href="structotz__mem__reference.html#ac84a349830e146ab101bb365437f0e41">offset</a> + </div>
<div class="line">                              ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[index].<a class="code" href="structotz__mem__reference.html#ada48b7ba047eb0b21e2ea9fe81418482">length</a>)) {</div>
<div class="line">                    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> =  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">                }            </div>
<div class="line">            }</div>
<div class="line">        }            </div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    </div>
<div class="line">    enc.encode_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">    enc.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">    enc.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">    enc.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line"></div>
<div class="line">    enc.data = ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a>;</div>
<div class="line">    enc.len  = length;</div>
<div class="line">    enc.offset = <a class="code" href="structotz__client__encode__cmd.html#afb02027737a6491d2e520e2ed77672a6">offset</a>;</div>
<div class="line">    enc.flags = <a class="code" href="structotz__client__encode__cmd.html#a5090110ee136f28c5f2939b2b326d722">flags</a>;</div>
<div class="line">    enc.param_type = <a class="code" href="structotz__client__encode__cmd.html#af88abf923e07a4c493758d604921b6bd">param_type</a>;</div>
<div class="line"></div>
<div class="line">    ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                <a class="code" href="otz__client_8h.html#a1e9c448543d21734707fff1c2ca516c7">OTZ_CLIENT_IOCTL_ENC_MEM_REF</a>, &amp;enc);</div>
<div class="line">    <span class="keywordflow">if</span> (ret){</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a> = enc.encode_id;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a>].<a class="code" href="structotz__mem__reference.html#a39df1ac5f9057a74513b315c8359e9b4">shared_mem</a> </div>
<div class="line">                                                        = ps_shared_mem;</div>
<div class="line"></div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a>].<a class="code" href="structotz__mem__reference.html#ac84a349830e146ab101bb365437f0e41">offset</a> </div>
<div class="line">                                                                    = <a class="code" href="structotz__client__encode__cmd.html#afb02027737a6491d2e520e2ed77672a6">offset</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a>].<a class="code" href="structotz__mem__reference.html#ada48b7ba047eb0b21e2ea9fe81418482">length</a> </div>
<div class="line">                                                                    = length;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a>].<a class="code" href="structotz__mem__reference.html#abded90096f65a46b8e151aebc39571bf">param_type</a> </div>
<div class="line">                                                                   = <a class="code" href="structotz__client__encode__cmd.html#af88abf923e07a4c493758d604921b6bd">param_type</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a>++;</div>
<div class="line">    }</div>
<div class="line">return_func:     </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5067283c78c6e22d4e4da117ec943f81"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void otz_encode_uint32 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void const *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>param_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encode unsigned 32-bit integer. </p>
<p>Calling this function appends the value of the passed uint32_t, pk_data, to the end of the encoded message.</p>
<p>This function can only be called when the operation is in the state OTZ_STATE_ENCODE. This occurs after the operation has been prepared, but before it has been performed.</p>
<p>If an error occurs, for example if there is no more space in the encoder buffer, this function sets the error state of the encoder.</p>
<p>This function does nothing if the error state of the encoder is already set upon entry.</p>
<p>Undefined Behavior<br/>
 The following situations result in UNDEFINED behavior:<br/>
 Calling with operation set to NULL.<br/>
 Calling with operation pointing to an operation in a state other than OTZ_STATE_ENCODE.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td>- A pointer to the operation for which we are encoding. </td></tr>
    <tr><td class="paramname">data</td><td>- The value to encode in the buffer. </td></tr>
    <tr><td class="paramname">param_type</td><td>- In or out</td></tr>
    <tr><td class="paramname">ps_operation,:</td><td></td></tr>
    <tr><td class="paramname">data,:</td><td></td></tr>
    <tr><td class="paramname">param_type,:</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00830">830</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> enc;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(check_encode(ps_operation))</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    enc.<a class="code" href="structotz__client__encode__cmd.html#a60354aef5351fdf4658e40fba86acffd">encode_id</a> = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">    enc.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">    enc.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">    enc.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line"></div>
<div class="line">    enc.data = (<span class="keywordtype">void</span>*)<a class="code" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a>;</div>
<div class="line">    enc.len  = <span class="keyword">sizeof</span>(<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>);</div>
<div class="line">    enc.param_type = <a class="code" href="structotz__client__encode__cmd.html#af88abf923e07a4c493758d604921b6bd">param_type</a>;</div>
<div class="line"></div>
<div class="line">    ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                    <a class="code" href="otz__client_8h.html#ac6a8a73b9377df5e63f60dfbf9163fbb">OTZ_CLIENT_IOCTL_ENC_UINT32</a>, &amp;enc);</div>
<div class="line">    <span class="keywordflow">if</span> (ret) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a> = enc.encode_id;</div>
<div class="line">    }</div>
<div class="line">         </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0d31dcaad228c53c2fb4094329111944"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_operation_perform </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> *&#160;</td>
          <td class="paramname"><em>pui_service_return</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs the previously prepared operation. </p>
<p>This function performs a previously prepared operation – issuing it to the secure environment.<br/>
 There are three kinds of operations that can be issued: opening a client session, invoking a service command, and closing a client session. Each type of operation is prepared with its respective function, which returns the operation structure to be used:<br/>
 otz_operation_prepare_open prepares an open session operation.<br/>
 otz_operation_prepare_invoke prepares an invoke service command operation.<br/>
 otz_operation_prepare_close prepares a close session operation.<br/>
</p>
<p>When calling this function, the operation must be in the state OTZ_STATE_ENCODE or OTZ_STATE_PERFORMABLE.<br/>
</p>
<p>For operations that support a structured message it is not required that a message has actually been encoded by the client. Once this function has been called, the state transitions to OTZ_STATE_RUNNING and it is no longer possible to use to the encoder functions on the operation.<br/>
</p>
<p>If an error is detected by the system before the operation reaches the service, then an error code is returned by otz_operation_perform and the value OTZ_ERROR_GENERIC is assigned to *pui_service_return. In this case the operation will be in the state OTZ_STATE_INVALID when the function returns and the decoder functions cannot be used on the operation.<br/>
</p>
<p>The most common causes for an error occurring before the command reaches the service are:<br/>
 The encoder ran out of space – error returned is OTZ_ERROR_ENCODE_MEMORY.<br/>
 The service does not exist – error returned is OTZ_ERROR_ACCESS_DENIED.<br/>
 The system rejects a new session due to bad login credentials – error return is OTZ_ERROR_ACCESS_DENIED.<br/>
 The operation has timed out, or been cancelled; error return is OTZ_ERROR_CANCEL.<br/>
 The secure environment is busy or low on resource and cannot handle the request.<br/>
</p>
<p>For open and invoke operations, if the operation reaches the service, but the service returns an error, then otz_operation_perform returns OTZ_ERROR_SERVICE. The error code from the service is assigned to *pui_service_return. <br/>
</p>
<p>Unlike the case where a system error occurs, the service can return a message: the operation transitions to the state OTZ_STATE_DECODE and the decoder functions can be used.<br/>
</p>
<p>For open and invoke operations, if the operation succeeds then otz_operation_perform returns OTZ_SUCCESS and the value OTZ_SUCCESS is also assigned to *pui_service_return. The operation transitions to the state OTZ_STATE_DECODE and the client can use the decoder functions to retrieve the message, if present, from the service.<br/>
</p>
<p>For close operations the service cannot return a structured message, and the operation will always transition to OTZ_STATE_INVALID. The decoder functions cannot be used on a close operation. A close operation cannot be performed while the session has other operations open, or has allocated shared memory blocks – this results in UNDEFINED behavior.<br/>
</p>
<p>Regardless of the success or failure of the function the client code must always call otz_operation_release to release any resources used by the operation.<br/>
 Undefined Behavior:<br/>
 The following situations result in UNDEFINED behavior:<br/>
 Calling with operation set to NULL.<br/>
 Calling with operation pointing to an operation not in the state OTZ_STATE_ENCODE.<br/>
 Calling with operation pointing to a close operation, where the session being closed still has other operations open, or has allocated shared memory blocks.<br/>
 Calling with service_return set to NULL.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation,:</td><td>A pointer to the operation. </td></tr>
    <tr><td class="paramname">pui_service_return,:</td><td>A pointer to the variable that will contain the service return code.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>OTZ_SUCCESS: The operation was executed successfully.<br/>
 OTZ_ERROR_ENCODE_MEMORY: The encoder is in an error condition – it ran out of memory space.<br/>
 OTZ_ERROR_ACCESS_DENIED: The service was not found or the client was not authorized to access it.<br/>
 OTZ_ERROR_SERVICE: The service itself threw an error, which can be found in <em>pui_service_return.<br/>
 OTZ_ERROR_CANCEL: The operation timed out, or was explicitly cancelled.<br/>
 OTZ_ERROR_</em>: An implementation-defined error code for any other error.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
    <tr><td class="paramname">pui_service_return</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00242">242</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structser__ses__id.html" title="Session details structure.">ser_ses_id</a> ses_close;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structser__ses__id.html" title="Session details structure.">ser_ses_id</a> ses_open;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> enc;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_operation == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || pui_service_return == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;operation_perform : Illegal argument\n&quot;</span>);    </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(!(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bacfa218bc516a757e26a7248eb959fb7e">OTZ_STATE_ENCODE</a> || </div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba218a34ca51a29c286a5ec794347d915b">OTZ_STATE_PERFORMABLE</a>)) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;operation_perform : Illegal state\n&quot;</span>);    </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a17a59e90aad673eacadb8490283f5499">OTZ_ERROR_ILLEGAL_STATE</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;perform \n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba2d1d39b46fb1b8a045558802f26d14d8">OTZ_STATE_RUNNING</a>;</div>
<div class="line"></div>
<div class="line">     <span class="comment">/* For close operation the service cannot return a message*/</span></div>
<div class="line">     <span class="comment">/* The client cannot cancel or time-out the operation */</span></div>
<div class="line">     <span class="comment">/* When this is complete irrespective of success or failure</span></div>
<div class="line"><span class="comment">      * the session is considered close */</span>  </div>
<div class="line">    <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> == <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74aa8869f3ce511b3a269235c8fd1ad5f63">OTZ_OPERATION_CLOSE</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a71114b71bb3794410ecd938bc62a441d">operation_count</a> == 1 &amp;&amp; </div>
<div class="line">                        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#afb75e8af2520aadc3c888a02ffdfa4f4">shared_mem_cnt</a> == 0){</div>
<div class="line">                <span class="comment">/* session can be closed */</span></div>
<div class="line">    </div>
<div class="line">            ses_close.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">            ses_close.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line">    </div>
<div class="line">            ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>,</div>
<div class="line">                        <a class="code" href="otz__client_8h.html#a4d3f346f8ed5d6932d3f8a47ecd06585">OTZ_CLIENT_IOCTL_SES_CLOSE_REQ</a>, &amp;ses_close);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span>(ret &lt; 0){</div>
<div class="line">     </div>
<div class="line">                <span class="comment">/* Error is detected before reaching the service */</span></div>
<div class="line">                *pui_service_return = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a011416e65f00b25a21592c87267eb9bd">OTZ_ERROR_GENERIC</a>;</div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;</div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">                <span class="comment">/*return  Error actually occurred */</span></div>
<div class="line">                <span class="comment">/*Decoder functions cannot be used on the operation */</span></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="preprocessor"></span>            <span class="comment">/*  The service does not exist */</span> </div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>;</div>
<div class="line">            <span class="comment">/* The system rejects a new session due to bad login credentials */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>.</div>
<div class="line">            <span class="comment">/* The secure environment is busy or low on resource and </span></div>
<div class="line"><span class="comment">             * cannot handle the request */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                     <span class="keywordflow">return</span> TZ_ERROR_BUSY;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                 <span class="keywordflow">if</span>(ret == -EFAULT)</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a323328909603b4a09891fb854cd15c5c">OTZ_ERROR_UNDEFINED</a>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ret &gt; 0){</div>
<div class="line">                <span class="comment">/* Operation reaches the service but it returns error */</span></div>
<div class="line">                <span class="comment">/* Error code from Service assigned */</span></div>
<div class="line">                *pui_service_return = ret;</div>
<div class="line"></div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aca66b378fc1c26b5990a5edc5f334a55">OTZ_ERROR_SERVICE</a>; </div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            *pui_service_return = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line"></div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#ad2a9008616d4b2f37a5eef14c8ebaa34">session_count</a>--;  </div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9">OTZ_STATE_UNDEFINED</a>;  </div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> = -1;  </div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> = <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aa3f46aad753a2d88ce91ecf2b3393d8b0">OTZ_SVC_INVALID</a>;  </div>
<div class="line"></div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span>{</div>
<div class="line">            <span class="comment">/* Undefined Behaviour */</span></div>
<div class="line">            printf(<span class="stringliteral">&quot;Operation_cnt or shared_mem_cnt != 0 undef behaviour\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;Operation_cnt = %d   shared_mem_cnt = %d\n&quot;</span>,</div>
<div class="line">                        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a71114b71bb3794410ecd938bc62a441d">operation_count</a>,</div>
<div class="line">                        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#afb75e8af2520aadc3c888a02ffdfa4f4">shared_mem_cnt</a>);</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a011416e65f00b25a21592c87267eb9bd">OTZ_ERROR_GENERIC</a>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> == <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74ae3426ea3b47e48669f0994c9b7f69a06">OTZ_OPERATION_OPEN</a>)</div>
<div class="line">    {</div>
<div class="line">        ses_open.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a>;</div>
<div class="line"></div>
<div class="line">        ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>,</div>
<div class="line">                    <a class="code" href="otz__client_8h.html#a44cde702959998cc55975d32b57f5556">OTZ_CLIENT_IOCTL_SES_OPEN_REQ</a>, &amp;ses_open);</div>
<div class="line">            <span class="keywordflow">if</span>(ret &lt; 0){</div>
<div class="line">                 <span class="comment">/* Error is detected before reaching the service */</span></div>
<div class="line">                *pui_service_return = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a011416e65f00b25a21592c87267eb9bd">OTZ_ERROR_GENERIC</a>;</div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;</div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">                <span class="comment">/*return  Error actually occurred */</span></div>
<div class="line">                <span class="comment">/*Decoder functions cannot be used on the operation */</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">/*  The encoder ran out of space */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == -<a class="code" href="sw__filelib_8h.html#a6a05c923dad0c1208043e9c20a58c8e5">ENOMEM</a>)</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9af73e3a356497d98c0f50006d4c81c34c">OTZ_ERROR_MEMORY</a>;</div>
<div class="line">                 <span class="keywordflow">if</span>(ret == -EFAULT)</div>
<div class="line">                     <span class="keywordflow">return</span>  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>;</div>
<div class="line">                 <span class="keywordflow">if</span>(ret == -EINVAL)</div>
<div class="line">                     <span class="keywordflow">return</span>  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="preprocessor"></span>                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">            <span class="comment">/*  The service does not exist */</span> </div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>;</div>
<div class="line">            <span class="comment">/* The system rejects a new session due to bad login credentials */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>.</div>
<div class="line">            <span class="comment">/* The operation has timed out, or been cancelled */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a7789ecf9ebab693d4a66a6b092152f7a">OTZ_ERROR_CANCEL</a>;</div>
<div class="line">            <span class="comment">/* The secure environment is busy or low on resource and </span></div>
<div class="line"><span class="comment">             * cannot handle the request */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                     <span class="keywordflow">return</span>  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a41673c9f07fe677e9ec5ff1548ae37f0">OTZ_ERROR_BUSY</a>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a323328909603b4a09891fb854cd15c5c">OTZ_ERROR_UNDEFINED</a>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ret &gt; 0){</div>
<div class="line">                <span class="comment">/* Operation reaches the service but it returns error */</span></div>
<div class="line">                <span class="comment">/* Error code from Service assigned */</span></div>
<div class="line">                *pui_service_return = ret;</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* The service may have a message for the client</span></div>
<div class="line"><span class="comment">                 * which can be decoded if needed */</span></div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a">OTZ_STATE_DECODE</a>;</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aca66b378fc1c26b5990a5edc5f334a55">OTZ_ERROR_SERVICE</a>; </div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;ses open success\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#ad2a9008616d4b2f37a5eef14c8ebaa34">session_count</a>++ ;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> = ses_open.session_id;</div>
<div class="line"></div>
<div class="line">        *pui_service_return = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a">OTZ_STATE_DECODE</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a>; </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> == <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74a2d4af296381db71825daa2f33e2ce4ba">OTZ_OPERATION_INVOKE</a>) {    </div>
<div class="line">        enc.encode_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">        enc.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">        enc.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">        enc.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line">    </div>
<div class="line">        ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>,</div>
<div class="line">                        <a class="code" href="otz__client_8h.html#a74d70f914f878eeceecf69ee64912a9b">OTZ_CLIENT_IOCTL_SEND_CMD_REQ</a>, &amp;enc);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span>(ret &lt; 0){</div>
<div class="line">                 <span class="comment">/* Error is detected before reaching the service */</span></div>
<div class="line">                *pui_service_return = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a011416e65f00b25a21592c87267eb9bd">OTZ_ERROR_GENERIC</a>;</div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;</div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">                <span class="comment">/*return  Error actually occurred */</span></div>
<div class="line">                <span class="comment">/*Decoder functions cannot be used on the operation */</span></div>
<div class="line"></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == -EFAULT)</div>
<div class="line">                     <span class="keywordflow">return</span>  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>;</div>
<div class="line">                 <span class="keywordflow">if</span>(ret == -EINVAL)</div>
<div class="line">                     <span class="keywordflow">return</span>  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="preprocessor"></span>            <span class="comment">/*  The service does not exist */</span> </div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>;</div>
<div class="line">            <span class="comment">/* The system rejects a new session due to bad login credentials */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>.</div>
<div class="line">            <span class="comment">/* The operation has timed out, or been cancelled */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a7789ecf9ebab693d4a66a6b092152f7a">OTZ_ERROR_CANCEL</a>;</div>
<div class="line">            <span class="comment">/* The secure environment is busy or low on resource and </span></div>
<div class="line"><span class="comment">             * cannot handle the request */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                     <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a41673c9f07fe677e9ec5ff1548ae37f0">OTZ_ERROR_BUSY</a>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a323328909603b4a09891fb854cd15c5c">OTZ_ERROR_UNDEFINED</a>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ret &gt; 0){</div>
<div class="line">                <span class="comment">/* Operation reaches the service but it returns error */</span></div>
<div class="line">                <span class="comment">/* Error code from Service assigned */</span></div>
<div class="line">                *pui_service_return = ret;</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* The service may have a message for the client</span></div>
<div class="line"><span class="comment">                 * which can be decoded if needed */</span></div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a">OTZ_STATE_DECODE</a>;</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aca66b378fc1c26b5990a5edc5f334a55">OTZ_ERROR_SERVICE</a>; </div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">        *pui_service_return = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a">OTZ_STATE_DECODE</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a>; </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a323328909603b4a09891fb854cd15c5c">OTZ_ERROR_UNDEFINED</a>;</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a56d72206cc55e912e8ce188fbe632c8a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_operation_prepare_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__session__t.html">otz_session_t</a> *&#160;</td>
          <td class="paramname"><em>ps_session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare the operation for close session. </p>
<p>This function is responsible for locally preparing an operation that can be used to close a session between the client and a service.</p>
<p>This function accepts an operation assumed to be in the state OTZ_STATE_UNDEFINED.</p>
<p>When this function returns OTZ_SUCCESS the state of the session is changed to OTZ_STATE_CLOSING. In this state any operation still running or shared memory block still allocated can stillbe used, but it is not possible to create new shared memory blocks or prepare new operations within the session. If this operation is never issued, otz_operation_release must transition the session state back to OTZ_STATE_OPEN.</p>
<p>Note that performing a close operation while other operations exist with a session, or while shared memory blocks are still allocated within it, results in UNDEFINED behavior.</p>
<p>When this function returns OTZ_SUCCESS the operation is set to the state OTZ_STATE_PERFORMABLE; this state allows the client to perform the close operation, but not to encode a message to be exchanged with the service. The client must call the function otz_operation_perform, or the asynchronous equivalent, to issue the operation to the security environment.</p>
<p>When this function fails it can return any error code. In these conditions the state of the session must be unchanged, including the operation count. The state the operation must be set to OTZ_STATE_INVALID.</p>
<p>Note that the perform operation for a session closure cannot be canceled or timed-out by the client. When otz_operation_perform completes, whether with success or failure, the session is considered closed.</p>
<p>On failure of the perform function the client must still call otz_operation_release to release resources associated with the operation.</p>
<p>Undefined Behavior<br/>
 The following situations result in UNDEFINED behavior:<br/>
 Calling with session set to NULL.<br/>
 Calling with session pointing to a session in a state other than OTZ_STATE_OPEN.<br/>
 Calling with operation set to NULL.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_session,:</td><td>A pointer to session. </td></tr>
    <tr><td class="paramname">ps_operation,:</td><td>A pointer to the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>OTZ_SUCCESS: The operation has been prepared successfully.<br/>
 OTZ_ERROR_*: An implementation-defined error code for any other error.<br/>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_session</td><td></td></tr>
    <tr><td class="paramname">ps_operation</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00199">199</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(ps_session == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || ps_operation == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;operation prepare close : Illegal argument\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_session-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> != <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;operation prepare close : Illegal state\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a17a59e90aad673eacadb8490283f5499">OTZ_ERROR_ILLEGAL_STATE</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> != <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9">OTZ_STATE_UNDEFINED</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;operation prepare close : Illegal state\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a17a59e90aad673eacadb8490283f5499">OTZ_ERROR_ILLEGAL_STATE</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ps_session-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba96dd245ead2dc47347e8d4e26c037614">OTZ_STATE_CLOSING</a>;</div>
<div class="line">    ps_session-&gt;<a class="code" href="structotz__session__t.html#a71114b71bb3794410ecd938bc62a441d">operation_count</a>++;</div>
<div class="line"></div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a> = ps_session;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> = <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74aa8869f3ce511b3a269235c8fd1ad5f63">OTZ_OPERATION_CLOSE</a>;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba218a34ca51a29c286a5ec794347d915b">OTZ_STATE_PERFORMABLE</a>;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a> = 0;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a> = 0;</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="preprocessor"></span><span class="comment">/*on failure*/</span></div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;   </div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9b0f5735d0aa17639a7ce957ecb5867f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_operation_prepare_invoke </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__session__t.html">otz_session_t</a> *&#160;</td>
          <td class="paramname"><em>ps_session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>ui_command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__timelimit__t.html">otz_timelimit_t</a> const *&#160;</td>
          <td class="paramname"><em>pks_timelimit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare operation for service request. </p>
<p>This function is responsible for locally preparing an operation that can be used to issue a command to a service with which the client has already created a session.</p>
<p>This function accepts an operation assumed to be in the state OTZ_STATE_UNDEFINED.</p>
<p>When this function returns OTZ_SUCCESS the operation is set to the state OTZ_STATE_ENCODE; this state allows the client to encode a message to be exchanged with the service using the encoder functions of the OTZ_API. Once the message has been encoded the client must call the function otz_operation_perform, or the asynchronous equivalent, to issue the command to the service.</p>
<p>When this function fails it can return any error code. In these conditions the state of the session must be unchanged, including the operation count. The state the operation must be set to the state OTZ_STATE_INVALID.</p>
<p>The pks_time_limit parameter defines the absolute time by which the operation must be complete, after which the implementation should attempt to cancel it. This parameter may be NULL which implies no timeout it used.</p>
<p>Note that if the perform function fails the client must still call otz_operation_release to release resources associated with the operation.<br/>
</p>
<p>Undefined Behavior<br/>
 The following situations result in UNDEFINED behavior:<br/>
 Calling with session set to NULL.<br/>
 Calling with session pointing to a session in a state other than OTZ_STATE_OPEN.<br/>
 Calling with operation set to NULL.<br/>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_session,:</td><td>A pointer to the open session. </td></tr>
    <tr><td class="paramname">ui_command,:</td><td>The identifier of the command to execute, defined by the client-service protocol. </td></tr>
    <tr><td class="paramname">pks_timelimit,:</td><td>A pointer to the time limit, or NULL. </td></tr>
    <tr><td class="paramname">ps_operation,:</td><td>A pointer to the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>OTZ_SUCCESS: The operation has been prepared successfully.<br/>
 OTZ_ERROR_*: An implementation-defined error code for any other error.<br/>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_session</td><td></td></tr>
    <tr><td class="paramname">ui_command</td><td></td></tr>
    <tr><td class="paramname">pks_timelimit</td><td></td></tr>
    <tr><td class="paramname">ps_operation</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00162">162</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_session == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || ps_operation == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;prepare invoke : Illegal argument\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_session-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> != <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;prepare invoke : Illegal state\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a17a59e90aad673eacadb8490283f5499">OTZ_ERROR_ILLEGAL_STATE</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a> = ps_session;</div>
<div class="line">     ps_session-&gt;<a class="code" href="structotz__session__t.html#a71114b71bb3794410ecd938bc62a441d">operation_count</a>++;</div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> = <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74a2d4af296381db71825daa2f33e2ce4ba">OTZ_OPERATION_INVOKE</a>;</div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bacfa218bc516a757e26a7248eb959fb7e">OTZ_STATE_ENCODE</a>;</div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a> = -1;</div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a> = ui_command;</div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ae3ac49dcf8f3ce9b92e2f3c7004b94d2">dec_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a> = 0;</div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a> = 0;</div>
<div class="line">     <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afe75dee12e5e7d00489297ce482b9f74"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_operation_prepare_open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__device__t.html">otz_device_t</a> *&#160;</td>
          <td class="paramname"><em>ps_device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pks_service</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__login__t.html">otz_login_t</a> const *&#160;</td>
          <td class="paramname"><em>pks_login</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__timelimit__t.html">otz_timelimit_t</a> const *&#160;</td>
          <td class="paramname"><em>pks_timelimit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__session__t.html">otz_session_t</a> *&#160;</td>
          <td class="paramname"><em>ps_session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare open operation. </p>
<p>This function is responsible for locally preparing an operation that can be used to connect with the service defined by the UUID pointed to by pks_service, using the timeout pointed to by pks_time_limit and the login credentials specified in pks_login.<br/>
</p>
<p>This function accepts a session and an operation structure assumed to be in the state OTZ_STATE_UNDEFINED.<br/>
</p>
<p>When this function returns OTZ_SUCCESS it must increment the session count of the device. The count may subsequently need to be decremented by the otz_operation_release function – releasing this operation if the corresponding perform operation failed or was never executed.<br/>
</p>
<p>When this function returns OTZ_SUCCESS the operation is set to the state OTZ_STATE_ENCODE; this state allows the client to encode a message to be exchanged with the service using the encoder functions of the OTZ_API. Once the message has been encoded the client must call the function otz_operation_perform, or the asynchronous equivalent, to issue the open session command to the security environment.<br/>
</p>
<p>When this function returns OTZ_SUCCESS the session must be in the state OTZ_STATE_INVALID. The state transitions to OTZ_STATE_OPEN after the perform function related to the open session operation has returned</p>
<ul>
<li>OTZ_SUCCESS; only at this point does the session become usable. If the perform function returns any error code, the session is not opened and remains in the state OTZ_STATE_INVALID.<br/>
</li>
</ul>
<p>When this function fails it can return any error code. In these conditions, the state of the device must be unchanged, including the session count. The state of the session is OTZ_STATE_UNDEFINED and the operation must be set to OTZ_STATE_INVALID.<br/>
</p>
<p>Note that if the perform function fails, the client must still call otz_operation_release to release resources associated with the operation. <br/>
</p>
<p>Undefined Behavior:<br/>
 The following situations result in UNDEFINED behavior:<br/>
 Calling with device set to NULL.<br/>
 Calling with device pointing to a device in the state OTZ_STATE_INVALID.<br/>
 Calling with service set to NULL.<br/>
 Calling with session set to NULL.<br/>
 Calling with operation set to NULL.<br/>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_device,:</td><td>A pointer to the device. </td></tr>
    <tr><td class="paramname">pks_service,:</td><td>A pointer to the service UUID. </td></tr>
    <tr><td class="paramname">pks_login,:</td><td>A pointer to the login control structure, or NULL. </td></tr>
    <tr><td class="paramname">pks_timelimit,:</td><td>A pointer to the time limit, or NULL. </td></tr>
    <tr><td class="paramname">ps_session,:</td><td>A pointer to the session. </td></tr>
    <tr><td class="paramname">ps_operation,:</td><td>A pointer to the operation.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>OTZ_SUCCESS: The operation has been prepared successfully.<br/>
 OTZ_ERROR_*: An implementation-defined error code for any other error.<br/>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_device</td><td></td></tr>
    <tr><td class="paramname">pks_service</td><td></td></tr>
    <tr><td class="paramname">pks_login</td><td></td></tr>
    <tr><td class="paramname">pks_timelimit</td><td></td></tr>
    <tr><td class="paramname">ps_session</td><td></td></tr>
    <tr><td class="paramname">ps_operation</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00120">120</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (ps_device == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || pks_service == <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aa3f46aad753a2d88ce91ecf2b3393d8b0">OTZ_SVC_INVALID</a> || </div>
<div class="line">        ps_session == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || ps_operation == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line">    </div>
<div class="line">        printf(<span class="stringliteral">&quot;operation prepare open : Illegal argument\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ps_session-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;</div>
<div class="line">    ps_session-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a> = ps_device;</div>
<div class="line">    ps_session-&gt;<a class="code" href="structotz__session__t.html#a71114b71bb3794410ecd938bc62a441d">operation_count</a> = 0;</div>
<div class="line">    ps_session-&gt;<a class="code" href="structotz__session__t.html#a71114b71bb3794410ecd938bc62a441d">operation_count</a>++;</div>
<div class="line">    ps_session-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> = pks_service;</div>
<div class="line">    ps_session-&gt;<a class="code" href="structotz__session__t.html#afb75e8af2520aadc3c888a02ffdfa4f4">shared_mem_cnt</a> = 0;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a> = 0;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="sw__list_8h.html#a0ffe9d28c36d7b018a9cfae33bae45c0">INIT_LIST_HEAD</a>(&amp;ps_session-&gt;<a class="code" href="structotz__session__t.html#a622cecc77466298698501533ac5007ab">shared_mem_list</a>);</div>
<div class="line"></div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> = <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74ae3426ea3b47e48669f0994c9b7f69a06">OTZ_OPERATION_OPEN</a>;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bacfa218bc516a757e26a7248eb959fb7e">OTZ_STATE_ENCODE</a>;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a> = ps_session;</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7cca7c131a9236ee08c26ad743d2eec1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void otz_operation_release </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Release operation. </p>
<p>This function releases an operation, freeing any associated resources. The behavior of this function varies slightly depending on the state of the operation:<br/>
 OTZ_STATE_ENCODE or OTZ_STATE_PERFORMABLE: The operation has not been issued to the system, and is destroyed without being issued. In this case it may be required to unwind some of the state change made to related structures, for example if the operation is a session closure the session state must transition back to OTZ_STATE_OPEN.<br/>
 OTZ_STATE_DECODE: The operation has been issued to the system and a response has been returned. After destroying an operation in this state, any messages in its decoder are lost, including unread entries and arrays that have been decoded by reference. If the client needs to keep any data from the message it must copy it out of the decoder owned memory before calling this function.<br/>
 OTZ_STATE_INVALID: This function does nothing.</p>
<p>After this function returns the operation must be considered to be in the state OTZ_STATE_UNDEFINED.<br/>
</p>
<p>Undefined Behavior:<br/>
 The following situations result in UNDEFINED behavior:<br/>
 Calling with operation set to NULL.<br/>
 Calling with operation pointing to an operation in a state other than OTZ_STATE_ENCODE, OTZ_STATE_PERFORMABLE, OTZ_STATE_DECODE or OTZ_STATE_INVALID.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation,:</td><td>A pointer to the operation to release.</td></tr>
    <tr><td class="paramname">ps_operation</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00493">493</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> enc;</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (ps_operation == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;operation release : Null operation\n&quot;</span>); </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> ==  <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bacfa218bc516a757e26a7248eb959fb7e">OTZ_STATE_ENCODE</a> ||</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba218a34ca51a29c286a5ec794347d915b">OTZ_STATE_PERFORMABLE</a> ||</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> ==  <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a">OTZ_STATE_DECODE</a> ||</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> ==  <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>)) {</div>
<div class="line"></div>
<div class="line">        printf(<span class="stringliteral">&quot;operation release : Illegal state\n&quot;</span>); </div>
<div class="line">        printf(<span class="stringliteral">&quot;Warning : Undefined Behaviour\n&quot;</span>); </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DBG</span></div>
<div class="line"><span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;o_release \n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a71114b71bb3794410ecd938bc62a441d">operation_count</a>--;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="otz__api_8c.html#a5e03210f006d016a07b0a27cbae0f5f7">otz_free_temp_shared_mem</a>(ps_operation);</div>
<div class="line">    <span class="comment">/* Open/Invoke operation has been prepared but not being</span></div>
<div class="line"><span class="comment">     * given to service for Implementation */</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bacfa218bc516a757e26a7248eb959fb7e">OTZ_STATE_ENCODE</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> == <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74ae3426ea3b47e48669f0994c9b7f69a06">OTZ_OPERATION_OPEN</a>) {</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#ad2a9008616d4b2f37a5eef14c8ebaa34">session_count</a>--;</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9">OTZ_STATE_UNDEFINED</a>;</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> = -1;</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> = <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aa3f46aad753a2d88ce91ecf2b3393d8b0">OTZ_SVC_INVALID</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> == <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74a2d4af296381db71825daa2f33e2ce4ba">OTZ_OPERATION_INVOKE</a>) {</div>
<div class="line">            <span class="comment">/* Perform Necessary state reversal etc.,.*/</span></div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba218a34ca51a29c286a5ec794347d915b">OTZ_STATE_PERFORMABLE</a>){</div>
<div class="line">    <span class="comment">/* Close operation has been prepared but not being given to</span></div>
<div class="line"><span class="comment">     * service for Implementation */</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ( ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> == <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74aa8869f3ce511b3a269235c8fd1ad5f63">OTZ_OPERATION_CLOSE</a>) {</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a">OTZ_STATE_DECODE</a>)</div>
<div class="line">    {</div>
<div class="line"></div>
<div class="line">        enc.encode_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">        enc.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">        enc.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">        enc.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line"></div>
<div class="line">        ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                        <a class="code" href="otz__client_8h.html#a96a3275839a04f4d4380cfab6b977ea2">OTZ_CLIENT_IOCTL_OPERATION_RELEASE</a>, &amp;enc);</div>
<div class="line">        <span class="keywordflow">if</span> (ret){</div>
<div class="line">            perror(<span class="stringliteral">&quot;Operation release failed\n&quot;</span>);</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">/* Do Nothing;Just release the operation */</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9">OTZ_STATE_UNDEFINED</a>;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> = <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74a4370cd5fbe2631ca67965cc40786f86f">OTZ_OPERATION_NONE</a>;</div>
<div class="line">    </div>
<div class="line">    return ; </div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a803f85d1b6da9a5ec167bb0f5450a0e4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_shared_memory_allocate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__session__t.html">otz_session_t</a> *&#160;</td>
          <td class="paramname"><em>ps_session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a> *&#160;</td>
          <td class="paramname"><em>ps_shared_mem</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function allocates a block of memory, defined by the structure pointed to by ps_shared_mem, which is shared between the client and the service it is connected to. </p>
<p>This function allocates a block of memory, defined by the structure pointed to by ps_shared_mem, which is shared between the client and the service it is connected to.</p>
<p>Once a block is allocated, the client and the service can exchange references to the allocated block in messages encoded using structured messages. Depending on the implementation of the secure environment, this may allow the service to directly access this block of memory without the need for a copy; this allows for high-bandwidth non-structured communications.</p>
<p>On entry to this function the session must be in the state OTZ_STATE_OPEN.</p>
<p>On entry to this function the fields ui_flags and ui_length of the shared memory structure must have been filled in with the required values. Other fields of the shared memory structure have UNDEFINED state on entry to this function and are filled in by the time the function returns.</p>
<p>If this function returns OTZ_SUCCESS, the value ps_shared_mem-&gt;p_block will contain the address of the shared memory allocation and the shared memory structure will be in the state OTZ_STATE_OPEN. The implementation must guarantee that the returned buffer allocation is aligned on an 8-byte address boundary.</p>
<p>If this function returns any other value, the state of the structure is OTZ_STATE_INVALID and ps_shared_mem-&gt;p_block will be NULL.</p>
<p>After successful allocation of a block the client may subsequently pass the shared memory structure to the function otz_encode_memory_reference to create a reference to a portion of the block.</p>
<p>Blocks are flagged with the intended direction of data flow, as described by the ps_shared_mem-&gt;ui_flags parameter. If an attempt is later made to encode a memory reference with incompatible sharing attributes an encoder error is thrown when the operation is performed.</p>
<p>The structure must be passed to the function otz_shared_memory_release when the block is no longer needed</p>
<p>Undefined Behavior :<br/>
 The following situations result in UNDEFINED behavior:<br/>
 Calling with session set to NULL.<br/>
 Calling with session in a state other than OTZ_STATE_OPEN.<br/>
 Calling with shared_mem set to NULL.<br/>
 Calling with shared_mem-&gt;flags set to an invalid set of flags.<br/>
 Calling with shared_mem-&gt;length set to 0.<br/>
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_session,:</td><td>A pointer to the session. </td></tr>
    <tr><td class="paramname">ps_shared_mem,:</td><td>A pointer to the shared memory block structure.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>OTZ_SUCCESS: the memory was allocated successfully.<br/>
 OTZ_ERROR_MEMORY: there is not enough memory to meet the allocation request.<br/>
 OTZ_ERROR_*: an implementation-defined error code for any other error.<br/>
</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_session</td><td></td></tr>
    <tr><td class="paramname">ps_shared_mem</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00588">588</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0, mmap_flags = PROT_READ | PROT_WRITE;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__session__shared__mem__info.html" title="Shared memory information for the session.">otz_session_shared_mem_info</a> mem_info;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_session == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || ps_shared_mem == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;shr_mem_allocate : Error Illegal argument\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_session-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> != <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a> ||</div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a28220f0262b41e7f1929f7df08857fa7">ui_length</a> == 0 ||</div>
<div class="line">        (ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> != <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a7aa74f7037354b0cd675442b600060c0">OTZ_MEM_SERVICE_RO</a> &amp;&amp; </div>
<div class="line">         ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> != <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a8035deccf29fcd9fe345e3f3e0e4accb">OTZ_MEM_SERVICE_WO</a> &amp;&amp; </div>
<div class="line">         ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> != <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a33f6f503a1e274dc317a34352157100c">OTZ_MEM_SERVICE_RW</a>)) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;shr_mem_allocate : Error Illegal state\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a17a59e90aad673eacadb8490283f5499">OTZ_ERROR_ILLEGAL_STATE</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> ==  <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a7aa74f7037354b0cd675442b600060c0">OTZ_MEM_SERVICE_RO</a>)</div>
<div class="line">        mmap_flags =  PROT_READ;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> ==  <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a8035deccf29fcd9fe345e3f3e0e4accb">OTZ_MEM_SERVICE_WO</a>)</div>
<div class="line">        mmap_flags =  PROT_WRITE;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> ==  <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a33f6f503a1e274dc317a34352157100c">OTZ_MEM_SERVICE_RW</a>)</div>
<div class="line">        mmap_flags = PROT_READ | PROT_WRITE;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* call mem allocation function from the driver */</span></div>
<div class="line">    <span class="comment">/* should allocate eight byte aligned memory */</span></div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;mmap call  \n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;shared mem len  %d\n&quot;</span>,ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a28220f0262b41e7f1929f7df08857fa7">ui_length</a>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;shared mem fd  %d\n&quot;</span>,ps_session-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a> = mmap(0, ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a28220f0262b41e7f1929f7df08857fa7">ui_length</a>,</div>
<div class="line">                                      mmap_flags , MAP_SHARED,</div>
<div class="line">                                      ps_session-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, 0);</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;return from mmap\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;mmap u_addr  %p\n&quot;</span>, (<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>*)ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">if</span>(ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a> != MAP_FAILED) {</div>
<div class="line">        mem_info.service_id = ps_session-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a>;</div>
<div class="line">        mem_info.session_id = ps_session-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a>;</div>
<div class="line">        mem_info.user_mem_addr = (<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a>;</div>
<div class="line">        ret = ioctl(ps_session-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                <a class="code" href="otz__client_8h.html#aec1c031dce90c397aa85665e1e9ca9a3">OTZ_CLIENT_IOCTL_SHR_MEM_ALLOCATE_REQ</a>, &amp;mem_info);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        perror(<span class="stringliteral">&quot;otz_shared_memory_allocate - mmap failed\n&quot;</span>); </div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a6d85e53f3ac06e57b554242fe54c42e2">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        ret = -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ret != -1){ </div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a69fcd3101aa4de6539ecc56b25fc37c4">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a> ; </div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ad0d9d683bd7ffc078ae92319ac204547">session</a> = ps_session;</div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a76fc2ab1afa5c6f640177196fbe7427e">operation_count</a> = 0;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="sw__list_8h.html#a0ffe9d28c36d7b018a9cfae33bae45c0">INIT_LIST_HEAD</a>(&amp;ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae57d14f3ca41a8b522ef8a8c98f60615">head_ref</a>);</div>
<div class="line">        list_add_tail(&amp;ps_session-&gt;<a class="code" href="structotz__session__t.html#a622cecc77466298698501533ac5007ab">shared_mem_list</a>, &amp;ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae57d14f3ca41a8b522ef8a8c98f60615">head_ref</a>);</div>
<div class="line">        ps_session-&gt;<a class="code" href="structotz__session__t.html#afb75e8af2520aadc3c888a02ffdfa4f4">shared_mem_cnt</a>++;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">    } </div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;shared_mem_allocation_failed\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a6d85e53f3ac06e57b554242fe54c42e2">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a69fcd3101aa4de6539ecc56b25fc37c4">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;</div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a28220f0262b41e7f1929f7df08857fa7">ui_length</a> = 0 ; </div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> = <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527aa462fe85425a0bde33600ba164e20325">OTZ_MEM_SERVICE_UNDEFINED</a>; </div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ; </div>
<div class="line"></div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ad0d9d683bd7ffc078ae92319ac204547">session</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9af73e3a356497d98c0f50006d4c81c34c">OTZ_ERROR_MEMORY</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a323328909603b4a09891fb854cd15c5c">OTZ_ERROR_UNDEFINED</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a45aca9f87329cb21e0e9517099dcfc0d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void otz_shared_memory_release </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a> *&#160;</td>
          <td class="paramname"><em>ps_shared_mem</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function allocates a block of memory, defined by the structure pointed to by ps_shared_mem, which is shared between the client and the service it is connected to. This function marks a block of shared memory associated with a session as no longer shared. </p>
<p>If the input shared memory structure is in the state OTZ_STATE_INVALID this function does nothing, otherwise it frees the memory block. The caller must not access the memory buffer after calling this function.</p>
<p>The shared memory structure returned by this function will be in the state OTZ_STATE_UNDEFINED.</p>
<p>When this function is called, the shared memory block must not be referenced by any operation, otherwise UNDEFINED behavior will occur.</p>
<p>Note that shared memory blocks must always be freed by calling this function; all memory blocks must be freed before a session can closed.</p>
<p>Undefined Behavior<br/>
 The following situations result in UNDEFINED behavior:<br/>
 Calling with shared_mem set to NULL.<br/>
 Calling with shared_mem pointing to a shared memory block that is still referenced by an operation.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_shared_mem</td><td>- A pointer to the shared memory block to free.</td></tr>
    <tr><td class="paramname">ps_shared_mem</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00693">693</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret=0;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__session__shared__mem__info.html" title="Shared memory information for the session.">otz_session_shared_mem_info</a> mem_info;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *l;</div>
<div class="line">    <a class="code" href="structotz__shared__mem__t.html" title="The otz_shared_memory_t structure is used to contain control information related to a block of shared...">otz_shared_mem_t</a>* ps_temp;</div>
<div class="line">    <span class="keywordtype">int</span> found = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_shared_mem == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a76fc2ab1afa5c6f640177196fbe7427e">operation_count</a> != 0) {</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;shared mem release : Illegal arg\n&quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Warning: Undefined Behaviour\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a69fcd3101aa4de6539ecc56b25fc37c4">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    mem_info.service_id = ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ad0d9d683bd7ffc078ae92319ac204547">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a>;</div>
<div class="line">    mem_info.session_id = ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ad0d9d683bd7ffc078ae92319ac204547">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a>;</div>
<div class="line">    mem_info.user_mem_addr = (<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a>;    </div>
<div class="line"></div>
<div class="line">    munmap(ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a>, ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a28220f0262b41e7f1929f7df08857fa7">ui_length</a>);</div>
<div class="line">    ret = ioctl(ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ad0d9d683bd7ffc078ae92319ac204547">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>,</div>
<div class="line">                   <a class="code" href="otz__client_8h.html#acc330cddd9c28f9ee43644552166878d">OTZ_CLIENT_IOCTL_SHR_MEM_FREE_REQ</a>, &amp;mem_info);</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;coming out of unmap\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">if</span>(ret)</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;Ioctl for mem free failed\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;Shared memory release failed\n&quot;</span>);</div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a6d85e53f3ac06e57b554242fe54c42e2">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        <span class="keywordflow">return</span>; </div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a69fcd3101aa4de6539ecc56b25fc37c4">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9">OTZ_STATE_UNDEFINED</a>;</div>
<div class="line">    ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a28220f0262b41e7f1929f7df08857fa7">ui_length</a> = 0;</div>
<div class="line">    ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> = <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527aa462fe85425a0bde33600ba164e20325">OTZ_MEM_SERVICE_UNDEFINED</a>;</div>
<div class="line">    ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#af01846f31ebaa3fe15ac339775b6c19d">session_id</a> = -1;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="sw__list_8h.html#abeae4779f478cbb5e1d437e6853c77c5">list_for_each</a>(l, &amp;ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ad0d9d683bd7ffc078ae92319ac204547">session</a>-&gt;<a class="code" href="structotz__session__t.html#a622cecc77466298698501533ac5007ab">shared_mem_list</a>) {</div>
<div class="line">        ps_temp = <a class="code" href="sw__list_8h.html#a26c976b7f654e70df318c1843e5094de">list_entry</a>(l, <a class="code" href="structotz__shared__mem__t.html" title="The otz_shared_memory_t structure is used to contain control information related to a block of shared...">otz_shared_mem_t</a>, head_ref);</div>
<div class="line">        <span class="keywordflow">if</span> (ps_temp == ps_shared_mem) {</div>
<div class="line">            found = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(found) {</div>
<div class="line">        list_del(&amp;ps_temp-&gt;<a class="code" href="structotz__shared__mem__t.html#ae57d14f3ca41a8b522ef8a8c98f60615">head_ref</a>);</div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ad0d9d683bd7ffc078ae92319ac204547">session</a>-&gt;<a class="code" href="structotz__session__t.html#afb75e8af2520aadc3c888a02ffdfa4f4">shared_mem_cnt</a>--;</div>
<div class="line">    }</div>
<div class="line">    ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ad0d9d683bd7ffc078ae92319ac204547">session</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    return ;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jan 3 2013 00:33:52 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
