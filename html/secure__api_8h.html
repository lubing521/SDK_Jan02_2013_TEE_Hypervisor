<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>secure_api.h File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_6aeebb853ebd8c514e6186653c592c82.html">otzone</a></li><li class="navelem"><a class="el" href="dir_fb44076c8b62c63869cf8a830933e50d.html">src</a></li><li class="navelem"><a class="el" href="dir_ae72a19de923b7f4b595b906221fc8f6.html">core</a></li><li class="navelem"><a class="el" href="dir_c25868e378d53580eae20cb1da518f52.html">include</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">secure_api.h File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="sw__types_8h_source.html">sw_types.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="otz__common_8h_source.html">otz_common.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="task_8h_source.html">task.h</a>&gt;</code><br/>
</div>
<p><a href="secure__api_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structotz__secure__encode__cmd.html">otz_secure_encode_cmd</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encode command structure.  <a href="structotz__secure__encode__cmd.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structotz__secure__encode__ctx.html">otz_secure_encode_ctx</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encode context.  <a href="structotz__secure__encode__ctx.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aaa4b8adf40809cef80a99bf7ffc6bfa0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#aaa4b8adf40809cef80a99bf7ffc6bfa0">open_session_from_ns</a> (void *param)</td></tr>
<tr class="memdesc:aaa4b8adf40809cef80a99bf7ffc6bfa0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dispatcher command function to handle the Open session request from non-secure world.  <a href="#aaa4b8adf40809cef80a99bf7ffc6bfa0"></a><br/></td></tr>
<tr class="separator:aaa4b8adf40809cef80a99bf7ffc6bfa0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2e72a02ade28f959d9a7c86982a3b6c6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#a2e72a02ade28f959d9a7c86982a3b6c6">close_session_from_ns</a> (void *param)</td></tr>
<tr class="memdesc:a2e72a02ade28f959d9a7c86982a3b6c6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Dispatcher command function to handle the Close session request from non-secure world.  <a href="#a2e72a02ade28f959d9a7c86982a3b6c6"></a><br/></td></tr>
<tr class="separator:a2e72a02ade28f959d9a7c86982a3b6c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac4e7d606b3dba5159d3c3a7a9f1d7511"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#ac4e7d606b3dba5159d3c3a7a9f1d7511">sa_create_entry_point</a> (int svc_id, <a class="el" href="structsa__config__t.html">sa_config_t</a> *psa_config)</td></tr>
<tr class="memdesc:ac4e7d606b3dba5159d3c3a7a9f1d7511"><td class="mdescLeft">&#160;</td><td class="mdescRight">Invokes the init function of the service task.  <a href="#ac4e7d606b3dba5159d3c3a7a9f1d7511"></a><br/></td></tr>
<tr class="separator:ac4e7d606b3dba5159d3c3a7a9f1d7511"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af04390d3da0fa08dc61dfa5ebca4fa9d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#af04390d3da0fa08dc61dfa5ebca4fa9d">sa_destroy_entry_point</a> (int svc_id, void *<a class="el" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a>, int flag)</td></tr>
<tr class="memdesc:af04390d3da0fa08dc61dfa5ebca4fa9d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Invokes the exit function of the service task.  <a href="#af04390d3da0fa08dc61dfa5ebca4fa9d"></a><br/></td></tr>
<tr class="separator:af04390d3da0fa08dc61dfa5ebca4fa9d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af39d5aab76117e76cecf6d911cdaefb6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#af39d5aab76117e76cecf6d911cdaefb6">sa_open_session</a> (<a class="el" href="structsa__config__t.html">sa_config_t</a> *psa_config, void *session_context)</td></tr>
<tr class="memdesc:af39d5aab76117e76cecf6d911cdaefb6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open Session.  <a href="#af39d5aab76117e76cecf6d911cdaefb6"></a><br/></td></tr>
<tr class="separator:af39d5aab76117e76cecf6d911cdaefb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab005498bb644293762a2f577d0eb7eb3"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#ab005498bb644293762a2f577d0eb7eb3">sa_close_session</a> (void *session_context)</td></tr>
<tr class="memdesc:ab005498bb644293762a2f577d0eb7eb3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close Session.  <a href="#ab005498bb644293762a2f577d0eb7eb3"></a><br/></td></tr>
<tr class="separator:ab005498bb644293762a2f577d0eb7eb3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7da7eccdc2978a23daa6327050f67771"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#a7da7eccdc2978a23daa6327050f67771">get_api_context</a> (int *svc_id, int *task_id, int *cmd_id, int *cmd_type)</td></tr>
<tr class="memdesc:a7da7eccdc2978a23daa6327050f67771"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function to return the service id, session id and command id from the smc command parameter.  <a href="#a7da7eccdc2978a23daa6327050f67771"></a><br/></td></tr>
<tr class="separator:a7da7eccdc2978a23daa6327050f67771"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06ef145ca0003d92a7a5b503318c3a5c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#a06ef145ca0003d92a7a5b503318c3a5c">decode_data</a> (void *<a class="el" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a>, struct <a class="el" href="structotzc__encode__meta.html">otzc_encode_meta</a> *meta_data, int *type, int *offset, int *pos, int *mapped, void **out_data, int *out_len)</td></tr>
<tr class="memdesc:a06ef145ca0003d92a7a5b503318c3a5c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function to decode the data which got passed from non-secure world.  <a href="#a06ef145ca0003d92a7a5b503318c3a5c"></a><br/></td></tr>
<tr class="separator:a06ef145ca0003d92a7a5b503318c3a5c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9bd892045df93e29b38e8744cb151c6b"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#a9bd892045df93e29b38e8744cb151c6b">update_response_len</a> (struct <a class="el" href="structotzc__encode__meta.html">otzc_encode_meta</a> *meta_data, int pos, int len)</td></tr>
<tr class="memdesc:a9bd892045df93e29b38e8744cb151c6b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function to update the response length.  <a href="#a9bd892045df93e29b38e8744cb151c6b"></a><br/></td></tr>
<tr class="separator:a9bd892045df93e29b38e8744cb151c6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a14068d1f0e3ae583b55fdae60b67dc4a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#a14068d1f0e3ae583b55fdae60b67dc4a">open_session_from_secure</a> (int svc_id, int *session_id)</td></tr>
<tr class="memdesc:a14068d1f0e3ae583b55fdae60b67dc4a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open session request from secure application task.  <a href="#a14068d1f0e3ae583b55fdae60b67dc4a"></a><br/></td></tr>
<tr class="separator:a14068d1f0e3ae583b55fdae60b67dc4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a642950c4c6a9120136fed4774be3eeea"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#a642950c4c6a9120136fed4774be3eeea">close_session_from_secure</a> (int svc_id, int session_id)</td></tr>
<tr class="memdesc:a642950c4c6a9120136fed4774be3eeea"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close session request which is got initiated from secure task.  <a href="#a642950c4c6a9120136fed4774be3eeea"></a><br/></td></tr>
<tr class="separator:a642950c4c6a9120136fed4774be3eeea"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad1087c61b30162b1eb3d53ea9aac5b31"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#ad1087c61b30162b1eb3d53ea9aac5b31">ipc_connect</a> (int svc_id, int *session_id)</td></tr>
<tr class="memdesc:ad1087c61b30162b1eb3d53ea9aac5b31"><td class="mdescLeft">&#160;</td><td class="mdescRight">Establish session between two tasks.  <a href="#ad1087c61b30162b1eb3d53ea9aac5b31"></a><br/></td></tr>
<tr class="separator:ad1087c61b30162b1eb3d53ea9aac5b31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5cbece2e460aa22770a15b50da729e7f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#a5cbece2e460aa22770a15b50da729e7f">ipc_disconnect</a> (int svc_id, int session_id)</td></tr>
<tr class="memdesc:a5cbece2e460aa22770a15b50da729e7f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Disconnect the previously established session between two tasks.  <a href="#a5cbece2e460aa22770a15b50da729e7f"></a><br/></td></tr>
<tr class="separator:a5cbece2e460aa22770a15b50da729e7f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9c2660a9763c58ac43854d69d87ed435"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#a9c2660a9763c58ac43854d69d87ed435">ipc_send</a> (int src_svc_id, int src_context, int svc_id, int session_id, int cmd_id, struct <a class="el" href="structotz__secure__encode__ctx.html">otz_secure_encode_ctx</a> *enc_ctx, struct <a class="el" href="structotzc__encode__meta.html">otzc_encode_meta</a> *meta_data)</td></tr>
<tr class="memdesc:a9c2660a9763c58ac43854d69d87ed435"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send the data between two tasks.  <a href="#a9c2660a9763c58ac43854d69d87ed435"></a><br/></td></tr>
<tr class="separator:a9c2660a9763c58ac43854d69d87ed435"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf1c653d9a96132b4c7b150420aedc2f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#adf1c653d9a96132b4c7b150420aedc2f">otz_encode_data</a> (struct <a class="el" href="structotz__secure__encode__cmd.html">otz_secure_encode_cmd</a> *enc, struct <a class="el" href="structotzc__encode__meta.html">otzc_encode_meta</a> **pmeta_data, struct <a class="el" href="structotz__secure__encode__ctx.html">otz_secure_encode_ctx</a> **penc_context, int encode_type)</td></tr>
<tr class="memdesc:adf1c653d9a96132b4c7b150420aedc2f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function to encode the data which originate from secure application.  <a href="#adf1c653d9a96132b4c7b150420aedc2f"></a><br/></td></tr>
<tr class="separator:adf1c653d9a96132b4c7b150420aedc2f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af8f0513b045f36061fdeb940681a6824"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#af8f0513b045f36061fdeb940681a6824">decode_ipi_out_data</a> (void *<a class="el" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a>, struct <a class="el" href="structotzc__encode__meta.html">otzc_encode_meta</a> *meta_data, int *type, int *offset, int *pos, void **out_data, int *out_len)</td></tr>
<tr class="memdesc:af8f0513b045f36061fdeb940681a6824"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function to decode the response data for IPI.  <a href="#af8f0513b045f36061fdeb940681a6824"></a><br/></td></tr>
<tr class="separator:af8f0513b045f36061fdeb940681a6824"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aeac54a699cee6c80d67865a35ce71752"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#aeac54a699cee6c80d67865a35ce71752">otz_release_data</a> (struct <a class="el" href="structotz__secure__encode__ctx.html">otz_secure_encode_ctx</a> *enc_context, struct <a class="el" href="structotzc__encode__meta.html">otzc_encode_meta</a> *meta_data)</td></tr>
<tr class="memdesc:aeac54a699cee6c80d67865a35ce71752"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release the encoded data.  <a href="#aeac54a699cee6c80d67865a35ce71752"></a><br/></td></tr>
<tr class="separator:aeac54a699cee6c80d67865a35ce71752"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c4a917abcf6dcc2ac7153df6ba0f8bc"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#a7c4a917abcf6dcc2ac7153df6ba0f8bc">ipc_api</a> (int src_svc_id, int src_session_id, int target_svc_id, int target_cmd_id, void *req_buf, int req_buf_len, void *res_buf, int res_buf_len, int *ret_res_buf_len)</td></tr>
<tr class="memdesc:a7c4a917abcf6dcc2ac7153df6ba0f8bc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function to send the data between two tasks for single request and single response buffer.  <a href="#a7c4a917abcf6dcc2ac7153df6ba0f8bc"></a><br/></td></tr>
<tr class="separator:a7c4a917abcf6dcc2ac7153df6ba0f8bc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89a0b95e0f4f917575c88b224252875e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#a89a0b95e0f4f917575c88b224252875e">ipc_test_crypto</a> (int src_svc_id, int src_session_id)</td></tr>
<tr class="memdesc:a89a0b95e0f4f917575c88b224252875e"><td class="mdescLeft">&#160;</td><td class="mdescRight">: Test IPC command for crypto operation  <a href="#a89a0b95e0f4f917575c88b224252875e"></a><br/></td></tr>
<tr class="separator:a89a0b95e0f4f917575c88b224252875e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8fed76f3db2128740b11375c0e6e3441"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#a8fed76f3db2128740b11375c0e6e3441">ipc_test_echo</a> (int src_svc_id, int src_session_id)</td></tr>
<tr class="memdesc:a8fed76f3db2128740b11375c0e6e3441"><td class="mdescLeft">&#160;</td><td class="mdescRight">Test IPC command for echo operation.  <a href="#a8fed76f3db2128740b11375c0e6e3441"></a><br/></td></tr>
<tr class="separator:a8fed76f3db2128740b11375c0e6e3441"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a885e01bc2776574f654df4b1b2f18302"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#a885e01bc2776574f654df4b1b2f18302">handle_task_return</a> (int task_id, <a class="el" href="structsw__tls.html">sw_tls</a> *tls)</td></tr>
<tr class="memdesc:a885e01bc2776574f654df4b1b2f18302"><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper function to handle the task return.  <a href="#a885e01bc2776574f654df4b1b2f18302"></a><br/></td></tr>
<tr class="separator:a885e01bc2776574f654df4b1b2f18302"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad87d6051e9afef51225b61095495b00d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#ad87d6051e9afef51225b61095495b00d">otz_ipi</a> (struct <a class="el" href="structotz__smc__cmd.html">otz_smc_cmd</a> *smc_cmd)</td></tr>
<tr class="memdesc:ad87d6051e9afef51225b61095495b00d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Invoke IPI.  <a href="#ad87d6051e9afef51225b61095495b00d"></a><br/></td></tr>
<tr class="separator:ad87d6051e9afef51225b61095495b00d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a468df6d87a321a197f874e3a07d3b31d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="secure__api_8h.html#a468df6d87a321a197f874e3a07d3b31d">otz_ipi_return</a> (struct <a class="el" href="structotz__smc__cmd.html">otz_smc_cmd</a> *smc_cmd, int ret_val)</td></tr>
<tr class="memdesc:a468df6d87a321a197f874e3a07d3b31d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return for IPI.  <a href="#a468df6d87a321a197f874e3a07d3b31d"></a><br/></td></tr>
<tr class="separator:a468df6d87a321a197f874e3a07d3b31d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a2e72a02ade28f959d9a7c86982a3b6c6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int close_session_from_ns </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>param</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dispatcher command function to handle the Close session request from non-secure world. </p>
<p>This function invokes the close session API and its get called from dispatcher task. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">param,:</td><td>pointer to struct <a class="el" href="structotz__smc__cmd.html" title="SMC command structure.">otz_smc_cmd</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Session established successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
 </dd></dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00141">141</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> ret_val;</div>
<div class="line">        <span class="keywordtype">int</span> *svc_id = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        <a class="code" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a> cmd_phy;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structotz__smc__cmd.html" title="SMC command structure.">otz_smc_cmd</a> *cmd = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        <span class="keywordtype">void</span> *session_context = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        <a class="code" href="structsw__tls.html" title="Task local storage.">sw_tls</a> *tls;</div>
<div class="line"></div>
<div class="line">        cmd_phy = (<a class="code" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>) param;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code" href="page__table_8h.html#a5fc63d641c4d938c6bcf4768203afffe" title="Wrapper function for __map_to_ns.">map_to_ns</a>(cmd_phy, (<a class="code" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>*) &amp;cmd)) {</div>
<div class="line">                ret_val = <a class="code" href="sw__types_8h.html#a0e40f13f8595fceec45f6f8a0c35cf7c">OTZ_ENOMEM</a>;</div>
<div class="line">                <span class="keywordflow">goto</span> ret_func;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(cmd-&gt;<a class="code" href="structotz__smc__cmd.html#a425aa2252caa3208fd4d96fedeeb68be">req_buf_len</a> == 0) {</div>
<div class="line">                ret_val = <a class="code" href="sw__types_8h.html#ade5dde89d25481cc2f1ebe77a8d0d85b">OTZ_EFAIL</a>;</div>
<div class="line">                <span class="keywordflow">goto</span> ret_func;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code" href="page__table_8h.html#a5fc63d641c4d938c6bcf4768203afffe" title="Wrapper function for __map_to_ns.">map_to_ns</a>(cmd-&gt;<a class="code" href="structotz__smc__cmd.html#a2b2fe0686ca90f3d4a1b7ff5a36972da">req_buf_phys</a>, (<a class="code" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>*)&amp;svc_id) != 0) {</div>
<div class="line">                ret_val = <a class="code" href="sw__types_8h.html#a0e40f13f8595fceec45f6f8a0c35cf7c">OTZ_ENOMEM</a>;</div>
<div class="line">                <span class="keywordflow">goto</span> ret_func;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code" href="page__table_8h.html#a5fc63d641c4d938c6bcf4768203afffe" title="Wrapper function for __map_to_ns.">map_to_ns</a>(cmd-&gt;<a class="code" href="structotz__smc__cmd.html#a46df7a184130350e3ea4492f60517a2d">resp_buf_phys</a>, (<a class="code" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>*)&amp;session_context) != 0) {</div>
<div class="line">                ret_val = <a class="code" href="sw__types_8h.html#a0e40f13f8595fceec45f6f8a0c35cf7c">OTZ_ENOMEM</a>;</div>
<div class="line">                <span class="keywordflow">goto</span> ret_func;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        tls = <a class="code" href="task_8h.html#a907dd681ca27bfa3e3f7fe503f2b931b" title="Get task local storage.">get_task_tls</a>(*((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>*)session_context));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="secure__api_8h.html#af04390d3da0fa08dc61dfa5ebca4fa9d" title="Invokes the exit function of the service task.">sa_destroy_entry_point</a>(*svc_id, tls-&gt;<a class="code" href="structsw__tls.html#a526fc8f2513d096197f56576c5cd0869">private_data</a>,tls-&gt;<a class="code" href="structsw__tls.html#aac344a62cf2cfe96650af27176c2a66c">elf_flag</a>);</div>
<div class="line">        <a class="code" href="secure__api_8h.html#ab005498bb644293762a2f577d0eb7eb3" title="Close Session.">sa_close_session</a>(session_context);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        cmd-&gt;<a class="code" href="structotz__smc__cmd.html#af7d2eb383125d6902dd2c47f827ef689">cmd_status</a> = <a class="code" href="otz__common_8h.html#abd4c55771a07a0fe1a3d212cbc96f030abe1b9c787ad33e4a1faf1a8c06ac3f1d">OTZ_STATUS_COMPLETE</a>;</div>
<div class="line"></div>
<div class="line">ret_func:</div>
<div class="line">        <span class="keywordflow">if</span>(svc_id)</div>
<div class="line">                <a class="code" href="page__table_8h.html#aca3f6249157b4ed2c5c62e862bde4eee" title="Wrapper function for __unmap_from_ns.">unmap_from_ns</a>((<a class="code" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>)svc_id);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(session_context)</div>
<div class="line">                <a class="code" href="page__table_8h.html#aca3f6249157b4ed2c5c62e862bde4eee" title="Wrapper function for __unmap_from_ns.">unmap_from_ns</a>((<a class="code" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>)session_context);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(cmd)</div>
<div class="line">                <a class="code" href="page__table_8h.html#aca3f6249157b4ed2c5c62e862bde4eee" title="Wrapper function for __unmap_from_ns.">unmap_from_ns</a>((<a class="code" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>)cmd);    </div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> ret_val;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a642950c4c6a9120136fed4774be3eeea"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int close_session_from_secure </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>svc_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>session_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Close session request which is got initiated from secure task. </p>
<p>This function invokes the close session API and its get called from secure application task. This is to close the request from secure application, either for IPI or secure to non-secure world communication.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">svc_id,:</td><td>Service ID </td></tr>
    <tr><td class="paramname">session_id,:</td><td>Session ID</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Session established successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
 </dd></dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00248">248</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <a class="code" href="structsw__tls.html" title="Task local storage.">sw_tls</a> *tls;</div>
<div class="line">        tls = <a class="code" href="task_8h.html#a907dd681ca27bfa3e3f7fe503f2b931b" title="Get task local storage.">get_task_tls</a>(session_id);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="secure__api_8h.html#af04390d3da0fa08dc61dfa5ebca4fa9d" title="Invokes the exit function of the service task.">sa_destroy_entry_point</a>(svc_id, tls-&gt;<a class="code" href="structsw__tls.html#a526fc8f2513d096197f56576c5cd0869">private_data</a>,tls-&gt;<a class="code" href="structsw__tls.html#aac344a62cf2cfe96650af27176c2a66c">elf_flag</a>);</div>
<div class="line">        <a class="code" href="secure__api_8h.html#ab005498bb644293762a2f577d0eb7eb3" title="Close Session.">sa_close_session</a>((<span class="keywordtype">void</span>*)&amp;session_id);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a06ef145ca0003d92a7a5b503318c3a5c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int decode_data </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structotzc__encode__meta.html">otzc_encode_meta</a> *&#160;</td>
          <td class="paramname"><em>meta_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>mapped</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>out_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>out_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper function to decode the data which got passed from non-secure world. </p>
<p>This helper function decodes the data which got encoded from non-secure application.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data,:</td><td>Encoded data </td></tr>
    <tr><td class="paramname">meta_data,:</td><td>Meta data helps to identify the encoded data </td></tr>
    <tr><td class="paramname">type,:</td><td>Data type of the decoded data as output parameter </td></tr>
    <tr><td class="paramname">offset,:</td><td>Current offset as input parameter and Next offset as output parameter </td></tr>
    <tr><td class="paramname">pos,:</td><td>Current position as input parameter and Next position as output parameter </td></tr>
    <tr><td class="paramname">mapped,:</td><td>Decoded data is shared memory or not as output parameter </td></tr>
    <tr><td class="paramname">out_data,:</td><td>Decoded data as output parameter </td></tr>
    <tr><td class="paramname">out_len,:</td><td>Decoded data length as output parameter</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Decoded data successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
</dd></dl>
<p>This helper function decodes the data which got encoded from non-secure or secure application.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data,:</td><td>Encoded data </td></tr>
    <tr><td class="paramname">meta_data,:</td><td>Meta data helps to identify the encoded data </td></tr>
    <tr><td class="paramname">type,:</td><td>Data type of the decoded data as output parameter </td></tr>
    <tr><td class="paramname">offset,:</td><td>Current offset as input parameter and Next offset as output parameter </td></tr>
    <tr><td class="paramname">pos,:</td><td>Current position as input parameter and Next position as output parameter </td></tr>
    <tr><td class="paramname">mapped,:</td><td>Decoded data is shared memory or not as output parameter </td></tr>
    <tr><td class="paramname">out_data,:</td><td>Decoded data as output parameter </td></tr>
    <tr><td class="paramname">out_len,:</td><td>Decoded data length as output parameter</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Decoded data successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
 </dd></dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00473">473</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">        <span class="keywordtype">int</span> temp_offset = *offset, temp_pos = *pos;</div>
<div class="line">        *mapped = 0;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">switch</span>(meta_data[temp_pos].type) {</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beacafbe80d88442cff08f386a74daf8bb9c8">OTZ_ENC_UINT32</a>: {</div>
<div class="line">                                             *offset = temp_offset + <span class="keyword">sizeof</span>(<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>);</div>
<div class="line">                                             *pos = temp_pos + 1;</div>
<div class="line">                                             *type = <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beacafbe80d88442cff08f386a74daf8bb9c8">OTZ_ENC_UINT32</a>;</div>
<div class="line">                                             *out_data =  <a class="code" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a> + temp_offset;</div>
<div class="line">                                             *out_len =  meta_data[temp_pos].<a class="code" href="structotzc__encode__meta.html#a9ed5f89cd7e766cfbcc92af753e13a8b">len</a>;</div>
<div class="line">                                             <span class="keywordflow">break</span>;</div>
<div class="line">                                     }</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca5ecfa72c778a2f9613acbfe530866856">OTZ_ENC_ARRAY</a>: {</div>
<div class="line">                                            *offset = temp_offset + meta_data[temp_pos].<a class="code" href="structotzc__encode__meta.html#a9ed5f89cd7e766cfbcc92af753e13a8b">len</a>;</div>
<div class="line">                                            *pos = temp_pos + 1;</div>
<div class="line">                                            *type = <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca5ecfa72c778a2f9613acbfe530866856">OTZ_ENC_ARRAY</a>;</div>
<div class="line">                                            *out_data =  <a class="code" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a> + temp_offset;</div>
<div class="line">                                            *out_len =  meta_data[temp_pos].<a class="code" href="structotzc__encode__meta.html#a9ed5f89cd7e766cfbcc92af753e13a8b">len</a>;</div>
<div class="line">                                            <span class="keywordflow">break</span>;</div>
<div class="line">                                    }</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca12d03340e4613f9875953e9a2ea969f5">OTZ_MEM_REF</a>: {</div>
<div class="line">                                          <span class="keywordflow">if</span>(<a class="code" href="page__table_8h.html#a5fc63d641c4d938c6bcf4768203afffe" title="Wrapper function for __map_to_ns.">map_to_ns</a>((<a class="code" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>)(*((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>*)<a class="code" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a> + temp_offset)), (<a class="code" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>*)out_data) != 0)</div>
<div class="line">                                                  <span class="keywordflow">return</span> -1;</div>
<div class="line">                                          *offset = temp_offset + <span class="keyword">sizeof</span>(<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>);</div>
<div class="line">                                          *type = <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca12d03340e4613f9875953e9a2ea969f5">OTZ_MEM_REF</a>;</div>
<div class="line">                                          *pos = temp_pos + 1;</div>
<div class="line">                                          *mapped = 1;</div>
<div class="line">                                          *out_len =  meta_data[temp_pos].<a class="code" href="structotzc__encode__meta.html#a9ed5f89cd7e766cfbcc92af753e13a8b">len</a>;</div>
<div class="line">                                          <span class="keywordflow">break</span>;</div>
<div class="line">                                  }</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca96c21c8682cab91130f619cb860602ed">OTZ_SECURE_MEM_REF</a>: {</div>
<div class="line">                                                 *out_data = (<span class="keywordtype">void</span>*)(*((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>*)<a class="code" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a> + temp_offset));</div>
<div class="line">                                                 *offset = temp_offset + <span class="keyword">sizeof</span>(<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>);</div>
<div class="line">                                                 *type = <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca12d03340e4613f9875953e9a2ea969f5">OTZ_MEM_REF</a>;</div>
<div class="line">                                                 *pos = temp_pos + 1;</div>
<div class="line">                                                 *mapped = 0;</div>
<div class="line">                                                 *out_len =  meta_data[temp_pos].<a class="code" href="structotzc__encode__meta.html#a9ed5f89cd7e766cfbcc92af753e13a8b">len</a>;</div>
<div class="line">                                                 <span class="keywordflow">break</span>;</div>
<div class="line">                                         }</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                                         ret = -1;</div>
<div class="line">                                         <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af8f0513b045f36061fdeb940681a6824"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int decode_ipi_out_data </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structotzc__encode__meta.html">otzc_encode_meta</a> *&#160;</td>
          <td class="paramname"><em>meta_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void **&#160;</td>
          <td class="paramname"><em>out_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>out_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper function to decode the response data for IPI. </p>
<p>This helper function decodes the data which got returned from target secure application.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data,:</td><td>Encoded data </td></tr>
    <tr><td class="paramname">meta_data,:</td><td>Meta data helps to identify the encoded data </td></tr>
    <tr><td class="paramname">type,:</td><td>Data type of the decoded data as output parameter </td></tr>
    <tr><td class="paramname">offset,:</td><td>Current offset as input parameter and Next offset as output parameter </td></tr>
    <tr><td class="paramname">pos,:</td><td>Current position as input parameter and Next position as output parameter </td></tr>
    <tr><td class="paramname">out_data,:</td><td>Decoded data as output parameter </td></tr>
    <tr><td class="paramname">out_len,:</td><td>Decoded data length as output parameter</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Decoded data successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
 </dd></dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00546">546</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">        <span class="keywordtype">int</span> temp_offset = *offset, temp_pos = *pos;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">switch</span>(meta_data[temp_pos].type) {</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beacafbe80d88442cff08f386a74daf8bb9c8">OTZ_ENC_UINT32</a>: {</div>
<div class="line">                                             *offset = temp_offset + <span class="keyword">sizeof</span>(<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>);</div>
<div class="line">                                             *pos = temp_pos + 1;</div>
<div class="line">                                             *type = <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beacafbe80d88442cff08f386a74daf8bb9c8">OTZ_ENC_UINT32</a>;</div>
<div class="line">                                             *out_data =  <a class="code" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a> + temp_offset;</div>
<div class="line">                                             *out_len =  meta_data[temp_pos].<a class="code" href="structotzc__encode__meta.html#a9ed5f89cd7e766cfbcc92af753e13a8b">len</a>;</div>
<div class="line">                                             <span class="keywordflow">break</span>;</div>
<div class="line">                                     }</div>
<div class="line">                <span class="keywordflow">case</span> <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca96c21c8682cab91130f619cb860602ed">OTZ_SECURE_MEM_REF</a>: {</div>
<div class="line">                                                 *out_data = (<span class="keywordtype">void</span>*)(*((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>*)<a class="code" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a> + temp_offset));</div>
<div class="line">                                                 *offset = temp_offset + <span class="keyword">sizeof</span>(<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>);</div>
<div class="line">                                                 *type = <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca12d03340e4613f9875953e9a2ea969f5">OTZ_MEM_REF</a>;</div>
<div class="line">                                                 *pos = temp_pos + 1;</div>
<div class="line">                                                 *out_len =  meta_data[temp_pos].<a class="code" href="structotzc__encode__meta.html#a2962366827a8abcb92fb657cbd232fb1">ret_len</a>;</div>
<div class="line">                                                 <span class="keywordflow">break</span>;</div>
<div class="line">                                         }</div>
<div class="line">                <span class="keywordflow">default</span>:</div>
<div class="line">                                         ret = -1;</div>
<div class="line">                                         <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7da7eccdc2978a23daa6327050f67771"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void get_api_context </td>
          <td>(</td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>svc_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>task_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>cmd_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>cmd_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper function to return the service id, session id and command id from the smc command parameter. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">svc_id,:</td><td>service identifier as output parameter </td></tr>
    <tr><td class="paramname">task_id,:</td><td>session context as output parameter </td></tr>
    <tr><td class="paramname">cmd_id,:</td><td>command identifier as output parameter </td></tr>
    <tr><td class="paramname">cmd_type,:</td><td>command type as output parameter </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00411">411</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <a class="code" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a> cmd_phy;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structotz__smc__cmd.html" title="SMC command structure.">otz_smc_cmd</a> *cmd = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"></div>
<div class="line">        *svc_id = <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aa3f46aad753a2d88ce91ecf2b3393d8b0">OTZ_SVC_INVALID</a>;</div>
<div class="line">        *task_id = 0;</div>
<div class="line">        *cmd_id = <a class="code" href="otz__id_8h.html#a58ef1488a338b26f3b4786bfac1cdedfa34ecc649f4b8343e81d81b4de45b885b">OTZ_GLOBAL_CMD_ID_INVALID</a>;</div>
<div class="line">        *cmd_type = <a class="code" href="cpu__data_8h.html#af7dace657e83fbc88c3d8196bd0f5c41" title="Parameters stack which is used to SMC call parameters.">params_stack</a>[2];</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(*cmd_type == <a class="code" href="otz__common_8h.html#a77964e56914e3eec4558c784e6ecb182a16898843ae9a7c021855a14d79c6016f">OTZ_CMD_TYPE_NS_TO_SECURE</a>) {</div>
<div class="line">                cmd_phy = (<a class="code" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>) params_stack[1];</div>
<div class="line">                <span class="keywordflow">if</span>(!cmd) {</div>
<div class="line">                        <span class="keywordflow">if</span>(<a class="code" href="page__table_8h.html#a5fc63d641c4d938c6bcf4768203afffe" title="Wrapper function for __map_to_ns.">map_to_ns</a>(cmd_phy, (<a class="code" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>*) &amp;cmd))</div>
<div class="line">                                <span class="keywordflow">return</span>;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">                cmd = (<span class="keyword">struct </span><a class="code" href="structotz__smc__cmd.html" title="SMC command structure.">otz_smc_cmd</a> *)params_stack[1];</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef SECURE_API_DBG</span></div>
<div class="line"><span class="preprocessor"></span>        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: get_api_context: cmd va 0x%x cmd pa 0x%x\n&quot;</span>, </div>
<div class="line">                        cmd, <a class="code" href="cpu__mmu_8c.html#a9fa84b9a460d1939baad42d45e74e0ab" title="Returns the physical address of virtual address based on non-secure world page table.">va_to_pa_ns</a>(cmd));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: get_api_context: cmd va 0x%x cmd pa 0x%x\n&quot;</span>, </div>
<div class="line">                        cmd, <a class="code" href="cpu__mmu_8c.html#a8ba6341ba7949867e814a83e1699982c" title="Returns the physical address of virtual address based on secure world page table.">va_to_pa</a>(cmd));</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        *svc_id = ((cmd-&gt;<a class="code" href="structotz__smc__cmd.html#aec3d520f96c3964b678afc8959e39de3">id</a> &gt;&gt; 10) &amp; (0x3ff));</div>
<div class="line">        *cmd_id = (cmd-&gt;<a class="code" href="structotz__smc__cmd.html#aec3d520f96c3964b678afc8959e39de3">id</a> &amp; 0x3ff);</div>
<div class="line">        *task_id = cmd-&gt;<a class="code" href="structotz__smc__cmd.html#a8895c4e7e5cc988930da43529d4c4cbe">context</a>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(*cmd_type == <a class="code" href="otz__common_8h.html#a77964e56914e3eec4558c784e6ecb182a16898843ae9a7c021855a14d79c6016f">OTZ_CMD_TYPE_NS_TO_SECURE</a>) {</div>
<div class="line">                <a class="code" href="page__table_8h.html#aca3f6249157b4ed2c5c62e862bde4eee" title="Wrapper function for __unmap_from_ns.">unmap_from_ns</a>((<a class="code" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>)cmd);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a885e01bc2776574f654df4b1b2f18302"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void handle_task_return </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>task_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsw__tls.html">sw_tls</a> *&#160;</td>
          <td class="paramname"><em>tls</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper function to handle the task return. </p>
<p>This function helps to handle the return functionality of task. This function puts the task in to wait or suspend state based on the return value and also helps to set the return value of secure call or IPC call.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">task_id,:</td><td>Task ID </td></tr>
    <tr><td class="paramname">tls,:</td><td>Task local storage </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l01179">1179</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <a class="code" href="global_8c.html#a79f94efec61544a5c91b1b89eeb8bfd3" title="Suspends the task.">suspend_task</a>(task_id, <a class="code" href="task_8h.html#a6924eb4ed00ed119294b1f2d81a8d7ddaf8ca49e6d76377501e1d7bb631334aee">TASK_STATE_SUSPEND</a>);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(tls-&gt;<a class="code" href="structsw__tls.html#ac7e1df9c1c1dc72c35eea5082bb0fd32">params</a>[2] == <a class="code" href="otz__common_8h.html#a77964e56914e3eec4558c784e6ecb182a16898843ae9a7c021855a14d79c6016f">OTZ_CMD_TYPE_NS_TO_SECURE</a>){</div>
<div class="line">                <a class="code" href="dispatcher__task_8c.html#a6cf26b507d5212bcc38a1dda0fb44a0a" title="Task return value notification.">set_secure_api_ret</a>(tls-&gt;<a class="code" href="structsw__tls.html#a7eb62f98975f80eadc293c778c259348">ret_val</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(tls-&gt;<a class="code" href="structsw__tls.html#ac7e1df9c1c1dc72c35eea5082bb0fd32">params</a>[2] == <a class="code" href="otz__common_8h.html#a77964e56914e3eec4558c784e6ecb182a1f6b81d7cb278746b802e4954257aa91">OTZ_CMD_TYPE_SECURE_TO_SECURE</a>)</div>
<div class="line">                <a class="code" href="cpu__ipi_8c.html#a468df6d87a321a197f874e3a07d3b31d" title="Return for IPI.">otz_ipi_return</a>((<span class="keyword">struct</span> <a class="code" href="structotz__smc__cmd.html" title="SMC command structure.">otz_smc_cmd</a> *)tls-&gt;<a class="code" href="structsw__tls.html#ac7e1df9c1c1dc72c35eea5082bb0fd32">params</a>[1], tls-&gt;<a class="code" href="structsw__tls.html#a7eb62f98975f80eadc293c778c259348">ret_val</a>);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="cpu__api_8c.html#ac48128e72b303ea22d8ec641a9516b15" title="Invoke scheduler.">schedule</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7c4a917abcf6dcc2ac7153df6ba0f8bc"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ipc_api </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>src_svc_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>src_session_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>target_svc_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>target_cmd_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>req_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>req_buf_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>res_buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>res_buf_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>ret_res_buf_len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper function to send the data between two tasks for single request and single response buffer. </p>
<p>This function helps to send the data between two task of single request and single response. This takes care of session establishment, encoding, sending and decoding of data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">src_svc_id,:</td><td>Source service ID </td></tr>
    <tr><td class="paramname">src_session_id,:</td><td>Source session ID </td></tr>
    <tr><td class="paramname">target_svc_id,:</td><td>Target service ID </td></tr>
    <tr><td class="paramname">target_cmd_id,:</td><td>Target command ID </td></tr>
    <tr><td class="paramname">req_buf,:</td><td>Request buffer </td></tr>
    <tr><td class="paramname">req_buf_len,:</td><td>Request buffer length </td></tr>
    <tr><td class="paramname">res_buf,:</td><td>Response buffer </td></tr>
    <tr><td class="paramname">res_buf_len,:</td><td>Response buffer length </td></tr>
    <tr><td class="paramname">ret_res_buf_len,:</td><td>Return response buffer length</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - API success<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
 </dd></dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00891">891</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> ret_val, session_id;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structotz__secure__encode__cmd.html" title="Encode command structure.">otz_secure_encode_cmd</a> enc;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structotzc__encode__meta.html" title="Metadata used for encoding/decoding.">otzc_encode_meta</a> *meta_data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structotz__secure__encode__ctx.html" title="Encode context.">otz_secure_encode_ctx</a> *enc_ctx = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        <span class="keywordtype">void</span> *decode_out;</div>
<div class="line">        <span class="keywordtype">int</span> offset = 0, pos = <a class="code" href="otz__common_8h.html#af68d1342e11ec79eb995c40ad0e1303d">OTZ_MAX_REQ_PARAMS</a>, type;</div>
<div class="line"></div>
<div class="line">        ret_val = <a class="code" href="secure__api_8h.html#ad1087c61b30162b1eb3d53ea9aac5b31" title="Establish session between two tasks.">ipc_connect</a>(target_svc_id, &amp;session_id);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(ret_val != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc api: connect failed\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">goto</span> ret_func;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        enc.len = req_buf_len;</div>
<div class="line">        enc.data = req_buf;</div>
<div class="line">        enc.param_type = <a class="code" href="otz__common_8h.html#a792f9d4615b444fce1b56b3c7b6e8052af60016bf7987a1ce074d83f028f07614">OTZC_PARAM_IN</a>;</div>
<div class="line"></div>
<div class="line">        ret_val = <a class="code" href="secure__api_8h.html#adf1c653d9a96132b4c7b150420aedc2f" title="Helper function to encode the data which originate from secure application.">otz_encode_data</a>(&amp;enc, &amp;meta_data, &amp;enc_ctx, <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca96c21c8682cab91130f619cb860602ed">OTZ_SECURE_MEM_REF</a>);</div>
<div class="line">        <span class="keywordflow">if</span>(ret_val != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc api: encode data failed\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        enc.len = res_buf_len;</div>
<div class="line">        enc.data = res_buf;</div>
<div class="line">        enc.param_type = <a class="code" href="otz__common_8h.html#a792f9d4615b444fce1b56b3c7b6e8052a53a3f6b1183de5cf3cf9c9d564b164bc">OTZC_PARAM_OUT</a>;</div>
<div class="line"></div>
<div class="line">        ret_val = <a class="code" href="secure__api_8h.html#adf1c653d9a96132b4c7b150420aedc2f" title="Helper function to encode the data which originate from secure application.">otz_encode_data</a>(&amp;enc, &amp;meta_data, &amp;enc_ctx, <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca96c21c8682cab91130f619cb860602ed">OTZ_SECURE_MEM_REF</a>);</div>
<div class="line">        <span class="keywordflow">if</span>(ret_val != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc api: encode data failed\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        ret_val = <a class="code" href="secure__api_8h.html#a9c2660a9763c58ac43854d69d87ed435" title="Send the data between two tasks.">ipc_send</a>(src_svc_id, src_session_id, target_svc_id, session_id, </div>
<div class="line">                        target_cmd_id, enc_ctx, meta_data);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(ret_val != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc api: send failed\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code" href="task_8h.html#a907dd681ca27bfa3e3f7fe503f2b931b" title="Get task local storage.">get_task_tls</a>(src_session_id)-&gt;ipi_ret_val == <a class="code" href="otz__id_8h.html#a0ff602930cf5bf825ab83d78ba06ae32">SMC_SUCCESS</a>) {</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(<a class="code" href="secure__api_8h.html#af8f0513b045f36061fdeb940681a6824" title="Helper function to decode the response data for IPI.">decode_ipi_out_data</a>(enc_ctx-&gt;<a class="code" href="structotz__secure__encode__ctx.html#abcd7fbec6df74d8b939c0a97947717b7">res_addr</a>, meta_data, </div>
<div class="line">                                        &amp;type, &amp;offset, &amp;pos,(<span class="keywordtype">void</span>**)&amp;decode_out, ret_res_buf_len)) {</div>
<div class="line"></div>
<div class="line">                        <a class="code" href="secure__api_8h.html#aeac54a699cee6c80d67865a35ce71752" title="Release the encoded data.">otz_release_data</a>(enc_ctx, meta_data);</div>
<div class="line">                        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc api: decode data failed\n&quot;</span>);</div>
<div class="line">                        <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(decode_out != res_buf) {</div>
<div class="line">                        <a class="code" href="secure__api_8h.html#aeac54a699cee6c80d67865a35ce71752" title="Release the encoded data.">otz_release_data</a>(enc_ctx, meta_data);</div>
<div class="line">                        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc api: wrong response buffer\n&quot;</span>);</div>
<div class="line">                        <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">                <a class="code" href="secure__api_8h.html#aeac54a699cee6c80d67865a35ce71752" title="Release the encoded data.">otz_release_data</a>(enc_ctx, meta_data);</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc api: target service returns error 0x%x\n&quot;</span>, </div>
<div class="line">                                <a class="code" href="task_8h.html#a907dd681ca27bfa3e3f7fe503f2b931b" title="Get task local storage.">get_task_tls</a>(src_session_id)-&gt;ipi_ret_val);</div>
<div class="line">                <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">        }    </div>
<div class="line">        <a class="code" href="secure__api_8h.html#aeac54a699cee6c80d67865a35ce71752" title="Release the encoded data.">otz_release_data</a>(enc_ctx, meta_data);</div>
<div class="line"></div>
<div class="line">handler_err1:</div>
<div class="line">        <a class="code" href="secure__api_8h.html#a5cbece2e460aa22770a15b50da729e7f" title="Disconnect the previously established session between two tasks.">ipc_disconnect</a>(<a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aaffa07fe76b99c8529f2a5a3661257800">OTZ_SVC_CRYPT</a>, session_id);</div>
<div class="line"></div>
<div class="line">ret_func:</div>
<div class="line">        <span class="keywordflow">return</span> ret_val;</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad1087c61b30162b1eb3d53ea9aac5b31"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ipc_connect </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>svc_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>session_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Establish session between two tasks. </p>
<p>This function used in IPC functionality to establish session between two tasks.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">svc_id,:</td><td>Target service ID </td></tr>
    <tr><td class="paramname">session_id,:</td><td>Session ID as output parameter</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Session established successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
 </dd></dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00792">792</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="secure__api_8h.html#a14068d1f0e3ae583b55fdae60b67dc4a" title="Open session request from secure application task.">open_session_from_secure</a>(svc_id, session_id);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5cbece2e460aa22770a15b50da729e7f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ipc_disconnect </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>svc_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>session_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Disconnect the previously established session between two tasks. </p>
<p>This function used in IPC functionality to close the session which got established between two tasks.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">svc_id,:</td><td>Target service ID </td></tr>
    <tr><td class="paramname">session_id,:</td><td>Session ID need to be closed</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Session closed successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
 </dd></dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00810">810</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="secure__api_8h.html#a642950c4c6a9120136fed4774be3eeea" title="Close session request which is got initiated from secure task.">close_session_from_secure</a>(svc_id, session_id);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9c2660a9763c58ac43854d69d87ed435"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ipc_send </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>src_svc_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>src_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>svc_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>session_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>cmd_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structotz__secure__encode__ctx.html">otz_secure_encode_ctx</a> *&#160;</td>
          <td class="paramname"><em>enc_ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structotzc__encode__meta.html">otzc_encode_meta</a> *&#160;</td>
          <td class="paramname"><em>meta_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send the data between two tasks. </p>
<p>This function used to send the data between two tasks. We need to call this function after the session establishment.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">src_svc_id,:</td><td>Source service ID </td></tr>
    <tr><td class="paramname">src_context,:</td><td>Source session ID </td></tr>
    <tr><td class="paramname">svc_id,:</td><td>Target service ID </td></tr>
    <tr><td class="paramname">session_id,:</td><td>Target session ID </td></tr>
    <tr><td class="paramname">cmd_id,:</td><td>Target command ID </td></tr>
    <tr><td class="paramname">enc_ctx,:</td><td>Encode context </td></tr>
    <tr><td class="paramname">meta_data,:</td><td>Meta data</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Data sent successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
 </dd></dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00835">835</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structotz__smc__cmd.html" title="SMC command structure.">otz_smc_cmd</a> smc_cmd;</div>
<div class="line"></div>
<div class="line">        smc_cmd.<a class="code" href="structotz__smc__cmd.html#a08074a22f5eb44648e9d2cd7531e8577">src_id</a> = (src_svc_id &lt;&lt; 10);</div>
<div class="line">        smc_cmd.src_context = <a class="code" href="structotz__smc__cmd.html#a12a6bd3f7ff1c4a86df9773636fbec46">src_context</a>;</div>
<div class="line">        smc_cmd.id = (svc_id &lt;&lt; 10) | cmd_id;</div>
<div class="line">        smc_cmd.context = session_id;</div>
<div class="line">        smc_cmd.req_buf_len = enc_ctx-&gt;<a class="code" href="structotz__secure__encode__ctx.html#aa7b1f5a4b1c8a14610cc9cc8efd7b81b">enc_req_offset</a>;</div>
<div class="line">        smc_cmd.resp_buf_len = enc_ctx-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a07e5a3ad08eb9a072f5a622a532c6278">enc_res_offset</a>;</div>
<div class="line">        smc_cmd.ret_resp_buf_len = 0;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(enc_ctx-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a7513d2246199ffe6feb1c29661df9d83">req_addr</a>)</div>
<div class="line">                smc_cmd.req_buf_phys = (<a class="code" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>)enc_ctx-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a7513d2246199ffe6feb1c29661df9d83">req_addr</a>;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                smc_cmd.req_buf_phys = 0;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(enc_ctx-&gt;<a class="code" href="structotz__secure__encode__ctx.html#abcd7fbec6df74d8b939c0a97947717b7">res_addr</a>)</div>
<div class="line">                smc_cmd.resp_buf_phys = (<a class="code" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>)enc_ctx-&gt;<a class="code" href="structotz__secure__encode__ctx.html#abcd7fbec6df74d8b939c0a97947717b7">res_addr</a>;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                smc_cmd.resp_buf_phys = 0;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(meta_data)</div>
<div class="line">                smc_cmd.meta_data_phys = (<a class="code" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>)meta_data;</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                smc_cmd.meta_data_phys = 0;       </div>
<div class="line"></div>
<div class="line">        <a class="code" href="cpu__ipi_8c.html#ad87d6051e9afef51225b61095495b00d" title="Invoke IPI.">otz_ipi</a>(&amp;smc_cmd);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a89a0b95e0f4f917575c88b224252875e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ipc_test_crypto </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>src_svc_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>src_session_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>: Test IPC command for crypto operation </p>
<p>This function helps to test the IPC functionality by invoking crypto operation.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">src_svc_id,:</td><td>Source service ID </td></tr>
    <tr><td class="paramname">src_session_id,:</td><td>Source session ID </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00978">978</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> ret_val, session_id, loop_cntr;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structotz__secure__encode__cmd.html" title="Encode command structure.">otz_secure_encode_cmd</a> enc;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structotzc__encode__meta.html" title="Metadata used for encoding/decoding.">otzc_encode_meta</a> *meta_data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structotz__secure__encode__ctx.html" title="Encode context.">otz_secure_encode_ctx</a> *enc_ctx = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        <span class="keywordtype">char</span> *input_string = <span class="stringliteral">&quot;This is a test for IPC encryption/decryption&quot;</span>;</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">char</span> output_buf[256], *decode_out;</div>
<div class="line">        <span class="keywordtype">int</span> output_buf_len = 256;</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">char</span> decrypt_output_buf[256];</div>
<div class="line">        <span class="keywordtype">int</span> decrypt_output_buf_len = 256;</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> offset = 0, pos = <a class="code" href="otz__common_8h.html#af68d1342e11ec79eb995c40ad0e1303d">OTZ_MAX_REQ_PARAMS</a>, type;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> input_buf_len = <a class="code" href="sw__string__functions_8h.html#a67166a224e2739d54a617403135fa7f9" title="strlen - Find the length of a string">sw_strlen</a>(input_string)+1;</div>
<div class="line"></div>
<div class="line">        ret_val = <a class="code" href="secure__api_8h.html#ad1087c61b30162b1eb3d53ea9aac5b31" title="Establish session between two tasks.">ipc_connect</a>(<a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aaffa07fe76b99c8529f2a5a3661257800">OTZ_SVC_CRYPT</a>, &amp;session_id);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(ret_val != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc test cmd: connect failed\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">goto</span> ret_func;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        enc.len = <span class="keyword">sizeof</span>(<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>);</div>
<div class="line">        enc.data = (<span class="keywordtype">void</span>*)input_buf_len;</div>
<div class="line">        enc.param_type = <a class="code" href="otz__common_8h.html#a792f9d4615b444fce1b56b3c7b6e8052af60016bf7987a1ce074d83f028f07614">OTZC_PARAM_IN</a>;</div>
<div class="line"></div>
<div class="line">        ret_val = <a class="code" href="secure__api_8h.html#adf1c653d9a96132b4c7b150420aedc2f" title="Helper function to encode the data which originate from secure application.">otz_encode_data</a>(&amp;enc, &amp;meta_data, &amp;enc_ctx, <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beacafbe80d88442cff08f386a74daf8bb9c8">OTZ_ENC_UINT32</a>);</div>
<div class="line">        <span class="keywordflow">if</span>(ret_val != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc test cmd: encode data failed\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        enc.len = input_buf_len;</div>
<div class="line">        enc.data = input_string;</div>
<div class="line">        enc.param_type = <a class="code" href="otz__common_8h.html#a792f9d4615b444fce1b56b3c7b6e8052af60016bf7987a1ce074d83f028f07614">OTZC_PARAM_IN</a>;</div>
<div class="line"></div>
<div class="line">        ret_val = <a class="code" href="secure__api_8h.html#adf1c653d9a96132b4c7b150420aedc2f" title="Helper function to encode the data which originate from secure application.">otz_encode_data</a>(&amp;enc, &amp;meta_data, &amp;enc_ctx, <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca96c21c8682cab91130f619cb860602ed">OTZ_SECURE_MEM_REF</a>);</div>
<div class="line">        <span class="keywordflow">if</span>(ret_val != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc test cmd: encode data failed\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        enc.len = output_buf_len;</div>
<div class="line">        enc.data = output_buf;</div>
<div class="line">        enc.param_type = <a class="code" href="otz__common_8h.html#a792f9d4615b444fce1b56b3c7b6e8052a53a3f6b1183de5cf3cf9c9d564b164bc">OTZC_PARAM_OUT</a>;</div>
<div class="line"></div>
<div class="line">        ret_val = <a class="code" href="secure__api_8h.html#adf1c653d9a96132b4c7b150420aedc2f" title="Helper function to encode the data which originate from secure application.">otz_encode_data</a>(&amp;enc, &amp;meta_data, &amp;enc_ctx, <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca96c21c8682cab91130f619cb860602ed">OTZ_SECURE_MEM_REF</a>);</div>
<div class="line">        <span class="keywordflow">if</span>(ret_val != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc test cmd: encode data failed\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        ret_val = <a class="code" href="secure__api_8h.html#a9c2660a9763c58ac43854d69d87ed435" title="Send the data between two tasks.">ipc_send</a>(src_svc_id, src_session_id, <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aaffa07fe76b99c8529f2a5a3661257800">OTZ_SVC_CRYPT</a>, </div>
<div class="line">                        session_id, <a class="code" href="otz__id_8h.html#aa198051a37dd7b750bf536accf5a4010aabc2aab03b1ee4347b56c75d4ebfbf30">OTZ_CRYPT_CMD_ID_ENCRYPT</a>, </div>
<div class="line">                        enc_ctx, meta_data);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(ret_val != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc test cmd: send failed\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code" href="task_8h.html#a907dd681ca27bfa3e3f7fe503f2b931b" title="Get task local storage.">get_task_tls</a>(src_session_id)-&gt;ipi_ret_val == <a class="code" href="otz__id_8h.html#a0ff602930cf5bf825ab83d78ba06ae32">SMC_SUCCESS</a>) {</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(<a class="code" href="secure__api_8h.html#af8f0513b045f36061fdeb940681a6824" title="Helper function to decode the response data for IPI.">decode_ipi_out_data</a>(enc_ctx-&gt;<a class="code" href="structotz__secure__encode__ctx.html#abcd7fbec6df74d8b939c0a97947717b7">res_addr</a>, meta_data, </div>
<div class="line">                                        &amp;type, &amp;offset, &amp;pos,(<span class="keywordtype">void</span>**)&amp;decode_out, &amp;output_buf_len)) {</div>
<div class="line"></div>
<div class="line">                        <a class="code" href="secure__api_8h.html#aeac54a699cee6c80d67865a35ce71752" title="Release the encoded data.">otz_release_data</a>(enc_ctx, meta_data);</div>
<div class="line">                        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc test cmd: decode data failed\n&quot;</span>);</div>
<div class="line">                        <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(decode_out != output_buf) {</div>
<div class="line">                        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc test cmd: wrong out buffer\n&quot;</span>);</div>
<div class="line">                }</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: IPC Encrypted string is &quot;</span>);</div>
<div class="line">                <span class="keywordflow">for</span>(loop_cntr=0;loop_cntr&lt;output_buf_len;loop_cntr++) {</div>
<div class="line">                        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: 0x%x &quot;</span>,output_buf[loop_cntr]);</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">                <a class="code" href="secure__api_8h.html#aeac54a699cee6c80d67865a35ce71752" title="Release the encoded data.">otz_release_data</a>(enc_ctx, meta_data);</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc test cmd: service returns error 0x%x failed\n&quot;</span>, </div>
<div class="line">                                <a class="code" href="task_8h.html#a907dd681ca27bfa3e3f7fe503f2b931b" title="Get task local storage.">get_task_tls</a>(src_session_id)-&gt;ipi_ret_val);</div>
<div class="line">                <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">        }    </div>
<div class="line">        <a class="code" href="secure__api_8h.html#aeac54a699cee6c80d67865a35ce71752" title="Release the encoded data.">otz_release_data</a>(enc_ctx, meta_data);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        meta_data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        enc_ctx = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"></div>
<div class="line">        enc.len = <span class="keyword">sizeof</span>(<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>);</div>
<div class="line">        enc.data = (<span class="keywordtype">void</span>*)output_buf_len;</div>
<div class="line">        enc.param_type = <a class="code" href="otz__common_8h.html#a792f9d4615b444fce1b56b3c7b6e8052af60016bf7987a1ce074d83f028f07614">OTZC_PARAM_IN</a>;</div>
<div class="line"></div>
<div class="line">        ret_val = <a class="code" href="secure__api_8h.html#adf1c653d9a96132b4c7b150420aedc2f" title="Helper function to encode the data which originate from secure application.">otz_encode_data</a>(&amp;enc, &amp;meta_data, &amp;enc_ctx, <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beacafbe80d88442cff08f386a74daf8bb9c8">OTZ_ENC_UINT32</a>);</div>
<div class="line">        <span class="keywordflow">if</span>(ret_val != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc test cmd: encode data failed\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        enc.len = output_buf_len;</div>
<div class="line">        enc.data = output_buf;</div>
<div class="line">        enc.param_type = <a class="code" href="otz__common_8h.html#a792f9d4615b444fce1b56b3c7b6e8052af60016bf7987a1ce074d83f028f07614">OTZC_PARAM_IN</a>;</div>
<div class="line"></div>
<div class="line">        ret_val = <a class="code" href="secure__api_8h.html#adf1c653d9a96132b4c7b150420aedc2f" title="Helper function to encode the data which originate from secure application.">otz_encode_data</a>(&amp;enc, &amp;meta_data, &amp;enc_ctx, <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca96c21c8682cab91130f619cb860602ed">OTZ_SECURE_MEM_REF</a>);</div>
<div class="line">        <span class="keywordflow">if</span>(ret_val != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc test cmd: encode data failed\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        enc.len = decrypt_output_buf_len;</div>
<div class="line">        enc.data = decrypt_output_buf;</div>
<div class="line">        enc.param_type = <a class="code" href="otz__common_8h.html#a792f9d4615b444fce1b56b3c7b6e8052a53a3f6b1183de5cf3cf9c9d564b164bc">OTZC_PARAM_OUT</a>;</div>
<div class="line"></div>
<div class="line">        ret_val = <a class="code" href="secure__api_8h.html#adf1c653d9a96132b4c7b150420aedc2f" title="Helper function to encode the data which originate from secure application.">otz_encode_data</a>(&amp;enc, &amp;meta_data, &amp;enc_ctx, <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca96c21c8682cab91130f619cb860602ed">OTZ_SECURE_MEM_REF</a>);</div>
<div class="line">        <span class="keywordflow">if</span>(ret_val != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc test cmd: encode data failed\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        ret_val = <a class="code" href="secure__api_8h.html#a9c2660a9763c58ac43854d69d87ed435" title="Send the data between two tasks.">ipc_send</a>(src_svc_id, src_session_id, <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aaffa07fe76b99c8529f2a5a3661257800">OTZ_SVC_CRYPT</a>, session_id, </div>
<div class="line">                        <a class="code" href="otz__id_8h.html#aa198051a37dd7b750bf536accf5a4010a2379b254e188628371e61fa52a0bd4d2">OTZ_CRYPT_CMD_ID_DECRYPT</a>, </div>
<div class="line">                        enc_ctx, meta_data);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(ret_val != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc test cmd: send failed\n&quot;</span>);</div>
<div class="line">                <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code" href="task_8h.html#a907dd681ca27bfa3e3f7fe503f2b931b" title="Get task local storage.">get_task_tls</a>(src_session_id)-&gt;ipi_ret_val == <a class="code" href="otz__id_8h.html#a0ff602930cf5bf825ab83d78ba06ae32">SMC_SUCCESS</a>) {</div>
<div class="line">                <span class="keywordflow">if</span>(<a class="code" href="secure__api_8h.html#af8f0513b045f36061fdeb940681a6824" title="Helper function to decode the response data for IPI.">decode_ipi_out_data</a>(enc_ctx-&gt;<a class="code" href="structotz__secure__encode__ctx.html#abcd7fbec6df74d8b939c0a97947717b7">res_addr</a>, meta_data, </div>
<div class="line">                                        &amp;type, &amp;offset, &amp;pos, (<span class="keywordtype">void</span>**)&amp;decode_out, </div>
<div class="line">                                        &amp;decrypt_output_buf_len)) {</div>
<div class="line"></div>
<div class="line">                        <a class="code" href="secure__api_8h.html#aeac54a699cee6c80d67865a35ce71752" title="Release the encoded data.">otz_release_data</a>(enc_ctx, meta_data);</div>
<div class="line">                        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc test cmd: decode data failed\n&quot;</span>);</div>
<div class="line">                        <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(decode_out != decrypt_output_buf) {</div>
<div class="line">                        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc test cmd: wrong out buffer\n&quot;</span>);</div>
<div class="line">                }</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: IPC: decrypted output %s\n&quot;</span>, decrypt_output_buf);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">                <a class="code" href="secure__api_8h.html#aeac54a699cee6c80d67865a35ce71752" title="Release the encoded data.">otz_release_data</a>(enc_ctx, meta_data);</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc test cmd: service returns error 0x%x failed\n&quot;</span>, </div>
<div class="line">                                <a class="code" href="task_8h.html#a907dd681ca27bfa3e3f7fe503f2b931b" title="Get task local storage.">get_task_tls</a>(src_session_id)-&gt;ipi_ret_val);</div>
<div class="line">                <span class="keywordflow">goto</span> handler_err1;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <a class="code" href="secure__api_8h.html#aeac54a699cee6c80d67865a35ce71752" title="Release the encoded data.">otz_release_data</a>(enc_ctx, meta_data);</div>
<div class="line"></div>
<div class="line">handler_err1:</div>
<div class="line">        <a class="code" href="secure__api_8h.html#a5cbece2e460aa22770a15b50da729e7f" title="Disconnect the previously established session between two tasks.">ipc_disconnect</a>(<a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aaffa07fe76b99c8529f2a5a3661257800">OTZ_SVC_CRYPT</a>, session_id);</div>
<div class="line"></div>
<div class="line">ret_func:</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a8fed76f3db2128740b11375c0e6e3441"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void ipc_test_echo </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>src_svc_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>src_session_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Test IPC command for echo operation. </p>
<p>This function helps to test IPC command of echo service.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">src_svc_id,:</td><td>Source service ID </td></tr>
    <tr><td class="paramname">src_session_id,:</td><td>Source session ID </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l01151">1151</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordtype">char</span>* req_buf = <span class="stringliteral">&quot;Test IPI echo cmd&quot;</span>;</div>
<div class="line">        <span class="keywordtype">int</span>   req_buf_len = <a class="code" href="sw__string__functions_8h.html#a67166a224e2739d54a617403135fa7f9" title="strlen - Find the length of a string">sw_strlen</a>(req_buf) + 1;</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">char</span> res_buf[256];</div>
<div class="line">        <span class="keywordtype">int</span>  res_buf_len = 256;</div>
<div class="line">        <span class="keywordtype">int</span>  ret_val;</div>
<div class="line"></div>
<div class="line">        ret_val = <a class="code" href="secure__api_8h.html#a7c4a917abcf6dcc2ac7153df6ba0f8bc" title="Helper function to send the data between two tasks for single request and single response buffer...">ipc_api</a>(src_svc_id, src_session_id, <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aa2cb1d1aee99cb072f3c2e5928ffbf65c">OTZ_SVC_ECHO</a>,  </div>
<div class="line">                        <a class="code" href="otz__id_8h.html#a37531dc6bfb63de7471c123bf53a84c5a270d9a21da6ec4767fe5f77db91b01a6">OTZ_ECHO_CMD_ID_IPI_SEND_CMD</a>, req_buf, req_buf_len, </div>
<div class="line">                        res_buf, res_buf_len, &amp;res_buf_len);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(ret_val == <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: ipc echo test: %s\n&quot;</span>, res_buf);</div>
<div class="line">        }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaa4b8adf40809cef80a99bf7ffc6bfa0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int open_session_from_ns </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>param</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Dispatcher command function to handle the Open session request from non-secure world. </p>
<p>This function invokes the open session API and its get called from dispatcher task.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">param,:</td><td>pointer to struct <a class="el" href="structotz__smc__cmd.html" title="SMC command structure.">otz_smc_cmd</a></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Session established successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
 </dd></dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00061">61</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"></div>
<div class="line">        <span class="keywordtype">int</span> ret_val;</div>
<div class="line">        <span class="keywordtype">int</span> *svc_id = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        <a class="code" href="structsa__config__t.html" title="Secure API configuration details for task.">sa_config_t</a> sa_config;</div>
<div class="line">        <a class="code" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a> cmd_phy;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structotz__smc__cmd.html" title="SMC command structure.">otz_smc_cmd</a> *cmd = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        <span class="keywordtype">void</span> *session_context = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"></div>
<div class="line">        cmd_phy = (<a class="code" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>) param;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code" href="page__table_8h.html#a5fc63d641c4d938c6bcf4768203afffe" title="Wrapper function for __map_to_ns.">map_to_ns</a>(cmd_phy, (<a class="code" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>*) &amp;cmd)) {</div>
<div class="line">                ret_val = <a class="code" href="sw__types_8h.html#a0e40f13f8595fceec45f6f8a0c35cf7c">OTZ_ENOMEM</a>;</div>
<div class="line">                <span class="keywordflow">goto</span> ret_func;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(cmd-&gt;<a class="code" href="structotz__smc__cmd.html#a140bcb490f4a917d056dd1466e80601a">resp_buf_len</a> == 0) {</div>
<div class="line">                ret_val = <a class="code" href="sw__types_8h.html#ade5dde89d25481cc2f1ebe77a8d0d85b">OTZ_EFAIL</a>;</div>
<div class="line">                <span class="keywordflow">goto</span> ret_func;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code" href="page__table_8h.html#a5fc63d641c4d938c6bcf4768203afffe" title="Wrapper function for __map_to_ns.">map_to_ns</a>(cmd-&gt;<a class="code" href="structotz__smc__cmd.html#a46df7a184130350e3ea4492f60517a2d">resp_buf_phys</a>, (<a class="code" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>*)&amp;session_context) != 0) {</div>
<div class="line">                ret_val = <a class="code" href="sw__types_8h.html#a0e40f13f8595fceec45f6f8a0c35cf7c">OTZ_ENOMEM</a>;</div>
<div class="line">                <span class="keywordflow">goto</span> ret_func;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code" href="page__table_8h.html#a5fc63d641c4d938c6bcf4768203afffe" title="Wrapper function for __map_to_ns.">map_to_ns</a>(cmd-&gt;<a class="code" href="structotz__smc__cmd.html#a2b2fe0686ca90f3d4a1b7ff5a36972da">req_buf_phys</a>, (<a class="code" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>*)&amp;svc_id) != 0) {</div>
<div class="line">                ret_val = <a class="code" href="sw__types_8h.html#a0e40f13f8595fceec45f6f8a0c35cf7c">OTZ_ENOMEM</a>;</div>
<div class="line">                <span class="keywordflow">goto</span> ret_func;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(*svc_id == <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aa3f46aad753a2d88ce91ecf2b3393d8b0">OTZ_SVC_INVALID</a>) {</div>
<div class="line">                ret_val = <a class="code" href="sw__types_8h.html#ade5dde89d25481cc2f1ebe77a8d0d85b">OTZ_EFAIL</a>;</div>
<div class="line">                <span class="keywordflow">goto</span> ret_func;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        ret_val = <a class="code" href="secure__api_8h.html#ac4e7d606b3dba5159d3c3a7a9f1d7511" title="Invokes the init function of the service task.">sa_create_entry_point</a>(*svc_id, &amp;sa_config);</div>
<div class="line">        <span class="keywordflow">if</span>(ret_val == <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                ret_val = <a class="code" href="secure__api_8h.html#af39d5aab76117e76cecf6d911cdaefb6" title="Open Session.">sa_open_session</a>(&amp;sa_config, session_context);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(ret_val != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                <a class="code" href="secure__api_8h.html#af04390d3da0fa08dc61dfa5ebca4fa9d" title="Invokes the exit function of the service task.">sa_destroy_entry_point</a>(*svc_id,</div>
<div class="line">                                sa_config.<a class="code" href="structsa__config__t.html#af0628d17593288b2f6cc0c70a5103b77">data</a>,sa_config.<a class="code" href="structsa__config__t.html#aaf22a3f2509c5b4b1c7eeccc4be71a10">elf_flag</a>);   </div>
<div class="line">                cmd-&gt;<a class="code" href="structotz__smc__cmd.html#af7d2eb383125d6902dd2c47f827ef689">cmd_status</a> = <a class="code" href="otz__common_8h.html#abd4c55771a07a0fe1a3d212cbc96f030a256b0cd8fb859d02f0b74116616c10f4">OTZ_STATUS_INCOMPLETE</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: session context %x\n&quot;</span>, *((<span class="keywordtype">int</span>*)session_context));</div>
<div class="line">                cmd-&gt;<a class="code" href="structotz__smc__cmd.html#a30619044c5aa254692aa0c3309c447c0">ret_resp_buf_len</a> = <span class="keyword">sizeof</span>(int);</div>
<div class="line">                cmd-&gt;<a class="code" href="structotz__smc__cmd.html#af7d2eb383125d6902dd2c47f827ef689">cmd_status</a> = <a class="code" href="otz__common_8h.html#abd4c55771a07a0fe1a3d212cbc96f030abe1b9c787ad33e4a1faf1a8c06ac3f1d">OTZ_STATUS_COMPLETE</a>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">ret_func:</div>
<div class="line">        <span class="keywordflow">if</span>(svc_id)</div>
<div class="line">                <a class="code" href="page__table_8h.html#aca3f6249157b4ed2c5c62e862bde4eee" title="Wrapper function for __unmap_from_ns.">unmap_from_ns</a>((<a class="code" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>)svc_id);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(session_context)</div>
<div class="line">                <a class="code" href="page__table_8h.html#aca3f6249157b4ed2c5c62e862bde4eee" title="Wrapper function for __unmap_from_ns.">unmap_from_ns</a>((<a class="code" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>)session_context);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(cmd)    </div>
<div class="line">                <a class="code" href="page__table_8h.html#aca3f6249157b4ed2c5c62e862bde4eee" title="Wrapper function for __unmap_from_ns.">unmap_from_ns</a>((<a class="code" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>)cmd);    </div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> ret_val;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a14068d1f0e3ae583b55fdae60b67dc4a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int open_session_from_secure </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>svc_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>session_id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Open session request from secure application task. </p>
<p>This function invokes the open session API and its get called from secure application task. This is to initiate the request from secure application, either for IPI or secure to non-secure world communication.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">svc_id,:</td><td>Service ID </td></tr>
    <tr><td class="paramname">session_id,:</td><td>Pointer to session ID as an output parameter</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Session established successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
 </dd></dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00208">208</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> ret_val;</div>
<div class="line">        <a class="code" href="structsa__config__t.html" title="Secure API configuration details for task.">sa_config_t</a> sa_config;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(svc_id == <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aa3f46aad753a2d88ce91ecf2b3393d8b0">OTZ_SVC_INVALID</a>) {</div>
<div class="line">                ret_val = <a class="code" href="sw__types_8h.html#ade5dde89d25481cc2f1ebe77a8d0d85b">OTZ_EFAIL</a>;</div>
<div class="line">                <span class="keywordflow">goto</span> ret_func;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        ret_val = <a class="code" href="secure__api_8h.html#ac4e7d606b3dba5159d3c3a7a9f1d7511" title="Invokes the init function of the service task.">sa_create_entry_point</a>(svc_id, &amp;sa_config);</div>
<div class="line">        <span class="keywordflow">if</span>(ret_val == <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                ret_val = <a class="code" href="secure__api_8h.html#af39d5aab76117e76cecf6d911cdaefb6" title="Open Session.">sa_open_session</a>(&amp;sa_config, session_id);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(ret_val == <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>) {</div>
<div class="line">                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: session context %x\n&quot;</span>, *((<span class="keywordtype">int</span>*)session_id));</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">                <a class="code" href="secure__api_8h.html#af04390d3da0fa08dc61dfa5ebca4fa9d" title="Invokes the exit function of the service task.">sa_destroy_entry_point</a>(svc_id, sa_config.<a class="code" href="structsa__config__t.html#af0628d17593288b2f6cc0c70a5103b77">data</a>,</div>
<div class="line">                                sa_config.<a class="code" href="structsa__config__t.html#aaf22a3f2509c5b4b1c7eeccc4be71a10">elf_flag</a>);   </div>
<div class="line">        }</div>
<div class="line">ret_func:</div>
<div class="line">        <span class="keywordflow">return</span> ret_val;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adf1c653d9a96132b4c7b150420aedc2f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int otz_encode_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structotz__secure__encode__cmd.html">otz_secure_encode_cmd</a> *&#160;</td>
          <td class="paramname"><em>enc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structotzc__encode__meta.html">otzc_encode_meta</a> **&#160;</td>
          <td class="paramname"><em>pmeta_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structotz__secure__encode__ctx.html">otz_secure_encode_ctx</a> **&#160;</td>
          <td class="paramname"><em>penc_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>encode_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper function to encode the data which originate from secure application. </p>
<p>This function encodes the data into a encoder stream and this function gets called from secure application. This will be used for IPI or secure to non-secure communication.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">enc,:</td><td>Encode command structure </td></tr>
    <tr><td class="paramname">pmeta_data,:</td><td>Meta data which get populated based on the encoding </td></tr>
    <tr><td class="paramname">penc_context,:</td><td>Encoder context which contains the encoded stream for request and response buffer and its details. </td></tr>
    <tr><td class="paramname">encode_type,:</td><td>Encoding data type - UINT32 or Shared memory</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Encoded data successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
 </dd></dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00618">618</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> ret_val = <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structotzc__encode__meta.html" title="Metadata used for encoding/decoding.">otzc_encode_meta</a> *meta_data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        <span class="keyword">struct </span><a class="code" href="structotz__secure__encode__ctx.html" title="Encode context.">otz_secure_encode_ctx</a> *enc_context = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"></div>
<div class="line">        meta_data = *pmeta_data;</div>
<div class="line">        enc_context = *penc_context;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(enc == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line">                ret_val = <a class="code" href="sw__types_8h.html#a73a2d1613cea88f93fbb8830b2fe857a">OTZ_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">                <span class="keywordflow">goto</span> ret_func;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(encode_type != <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beacafbe80d88442cff08f386a74daf8bb9c8">OTZ_ENC_UINT32</a> &amp;&amp; encode_type != <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca96c21c8682cab91130f619cb860602ed">OTZ_SECURE_MEM_REF</a>) {</div>
<div class="line">                ret_val = <a class="code" href="sw__types_8h.html#a73a2d1613cea88f93fbb8830b2fe857a">OTZ_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">                <span class="keywordflow">goto</span> ret_func;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(enc_context == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line">                enc_context = (<span class="keyword">struct </span><a class="code" href="structotz__secure__encode__ctx.html" title="Encode context.">otz_secure_encode_ctx</a> *)<a class="code" href="sw__buddy_8h.html#a66652368e6d05f18bdc4be02b0c62694">sw_malloc</a>(</div>
<div class="line">                                <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structotz__secure__encode__ctx.html" title="Encode context.">otz_secure_encode_ctx</a>));</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>(!enc_context) {</div>
<div class="line">                        ret_val = <a class="code" href="sw__types_8h.html#a0e40f13f8595fceec45f6f8a0c35cf7c">OTZ_ENOMEM</a>;</div>
<div class="line">                        <span class="keywordflow">goto</span> ret_free_mem;</div>
<div class="line">                }</div>
<div class="line">                <a class="code" href="sw__mem__functions_8h.html#a14af1b39b1154a36624740bad34b813f" title="memory set">sw_memset</a>(enc_context, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structotz__secure__encode__ctx.html" title="Encode context.">otz_secure_encode_ctx</a>));</div>
<div class="line">        } </div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(meta_data == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line">                meta_data = (<span class="keyword">struct </span><a class="code" href="structotzc__encode__meta.html" title="Metadata used for encoding/decoding.">otzc_encode_meta</a> *)<a class="code" href="sw__buddy_8h.html#a66652368e6d05f18bdc4be02b0c62694">sw_malloc</a>(</div>
<div class="line">                                <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structotzc__encode__meta.html" title="Metadata used for encoding/decoding.">otzc_encode_meta</a>) *</div>
<div class="line">                                (<a class="code" href="otz__common_8h.html#ae03d01e9604f8191960ab4faff98c12e">OTZ_MAX_RES_PARAMS</a> + <a class="code" href="otz__common_8h.html#af68d1342e11ec79eb995c40ad0e1303d">OTZ_MAX_REQ_PARAMS</a>));</div>
<div class="line">                <span class="keywordflow">if</span>(!meta_data) {</div>
<div class="line">                        ret_val = <a class="code" href="sw__types_8h.html#a0e40f13f8595fceec45f6f8a0c35cf7c">OTZ_ENOMEM</a>;</div>
<div class="line">                        <span class="keywordflow">goto</span> ret_free_mem;</div>
<div class="line">                }</div>
<div class="line">                <a class="code" href="sw__mem__functions_8h.html#a14af1b39b1154a36624740bad34b813f" title="memory set">sw_memset</a>(meta_data, 0, <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structotzc__encode__meta.html" title="Metadata used for encoding/decoding.">otzc_encode_meta</a>) *</div>
<div class="line">                                (<a class="code" href="otz__common_8h.html#ae03d01e9604f8191960ab4faff98c12e">OTZ_MAX_RES_PARAMS</a> + <a class="code" href="otz__common_8h.html#af68d1342e11ec79eb995c40ad0e1303d">OTZ_MAX_REQ_PARAMS</a>));</div>
<div class="line">        } </div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span>(enc-&gt;<a class="code" href="structotz__secure__encode__cmd.html#a9cc703d4a32b0900f45449e5ea4e2607">param_type</a> == <a class="code" href="otz__common_8h.html#a792f9d4615b444fce1b56b3c7b6e8052af60016bf7987a1ce074d83f028f07614">OTZC_PARAM_IN</a>) {  </div>
<div class="line">                <span class="keywordflow">if</span>(!enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a7513d2246199ffe6feb1c29661df9d83">req_addr</a>) {</div>
<div class="line">                        enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a7513d2246199ffe6feb1c29661df9d83">req_addr</a> = (<span class="keywordtype">void</span> *)<a class="code" href="sw__buddy_8h.html#a66652368e6d05f18bdc4be02b0c62694">sw_malloc</a>(<a class="code" href="otz__common_8h.html#a4002145756597ed650cbd0447719ac6c">OTZ_1K_SIZE</a>);</div>
<div class="line">                        <span class="keywordflow">if</span>(!enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a7513d2246199ffe6feb1c29661df9d83">req_addr</a>) {</div>
<div class="line">                                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: otz_client_encode: request addr malloc failed\n&quot;</span>);</div>
<div class="line">                                ret_val = <a class="code" href="sw__types_8h.html#a0e40f13f8595fceec45f6f8a0c35cf7c">OTZ_ENOMEM</a>;</div>
<div class="line">                                <span class="keywordflow">goto</span> ret_free_mem;</div>
<div class="line">                        }</div>
<div class="line">                        enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#aa7b1f5a4b1c8a14610cc9cc8efd7b81b">enc_req_offset</a> = 0;</div>
<div class="line">                        enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a411088c3eec2ffd06b2c60be382b77db">enc_req_pos</a> = 0;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span>((enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#aa7b1f5a4b1c8a14610cc9cc8efd7b81b">enc_req_offset</a> + <span class="keyword">sizeof</span>(<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>) &lt;= </div>
<div class="line">                                        <a class="code" href="otz__common_8h.html#a4002145756597ed650cbd0447719ac6c">OTZ_1K_SIZE</a>) &amp;&amp;</div>
<div class="line">                                (enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a411088c3eec2ffd06b2c60be382b77db">enc_req_pos</a> &lt; <a class="code" href="otz__common_8h.html#af68d1342e11ec79eb995c40ad0e1303d">OTZ_MAX_REQ_PARAMS</a>)) {</div>
<div class="line">                        *((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>*)enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a7513d2246199ffe6feb1c29661df9d83">req_addr</a> + enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#aa7b1f5a4b1c8a14610cc9cc8efd7b81b">enc_req_offset</a>) =</div>
<div class="line">                                (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)enc-&gt;<a class="code" href="structotz__secure__encode__cmd.html#a497cda85a2e25f1dee3f5a4fea09e827">data</a>;</div>
<div class="line">                        enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#aa7b1f5a4b1c8a14610cc9cc8efd7b81b">enc_req_offset</a> += <span class="keyword">sizeof</span>(<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>);</div>
<div class="line"></div>
<div class="line">                        meta_data[enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a411088c3eec2ffd06b2c60be382b77db">enc_req_pos</a>].<a class="code" href="structotzc__encode__meta.html#a88023806f0f388e879fb6e264c65419c">type</a> = encode_type;</div>
<div class="line">                        meta_data[enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a411088c3eec2ffd06b2c60be382b77db">enc_req_pos</a>].<a class="code" href="structotzc__encode__meta.html#a9ed5f89cd7e766cfbcc92af753e13a8b">len</a> = enc-&gt;<a class="code" href="structotz__secure__encode__cmd.html#a02767fcd38e58b6a2649eb56eebfea72">len</a>;</div>
<div class="line">                        enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a411088c3eec2ffd06b2c60be382b77db">enc_req_pos</a>++;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> {</div>
<div class="line">                        ret_val = <a class="code" href="sw__types_8h.html#a0e40f13f8595fceec45f6f8a0c35cf7c">OTZ_ENOMEM</a>;</div>
<div class="line">                        <span class="keywordflow">goto</span> ret_free_mem;</div>
<div class="line">                }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(enc-&gt;<a class="code" href="structotz__secure__encode__cmd.html#a9cc703d4a32b0900f45449e5ea4e2607">param_type</a> == <a class="code" href="otz__common_8h.html#a792f9d4615b444fce1b56b3c7b6e8052a53a3f6b1183de5cf3cf9c9d564b164bc">OTZC_PARAM_OUT</a>) {   </div>
<div class="line">                <span class="keywordflow">if</span>(!enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#abcd7fbec6df74d8b939c0a97947717b7">res_addr</a>) {</div>
<div class="line">                        enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#abcd7fbec6df74d8b939c0a97947717b7">res_addr</a> = (<span class="keywordtype">void</span> *)<a class="code" href="sw__buddy_8h.html#a66652368e6d05f18bdc4be02b0c62694">sw_malloc</a>(<a class="code" href="otz__common_8h.html#a4002145756597ed650cbd0447719ac6c">OTZ_1K_SIZE</a>);</div>
<div class="line">                        <span class="keywordflow">if</span>(!enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#abcd7fbec6df74d8b939c0a97947717b7">res_addr</a>) {</div>
<div class="line">                                <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: otz_client_encode: response addr malloc failed\n&quot;</span>);</div>
<div class="line">                                ret_val = <a class="code" href="sw__types_8h.html#a0e40f13f8595fceec45f6f8a0c35cf7c">OTZ_ENOMEM</a>;</div>
<div class="line">                                <span class="keywordflow">goto</span> ret_free_mem;</div>
<div class="line">                        }</div>
<div class="line"></div>
<div class="line">                        enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a93000d009ece5da4a14402b31ddd82d9">enc_res_pos</a> = <a class="code" href="otz__common_8h.html#af68d1342e11ec79eb995c40ad0e1303d">OTZ_MAX_REQ_PARAMS</a>;</div>
<div class="line">                        enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a07e5a3ad08eb9a072f5a622a532c6278">enc_res_offset</a> = 0;</div>
<div class="line">                }</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">if</span>((enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a07e5a3ad08eb9a072f5a622a532c6278">enc_res_offset</a> + <span class="keyword">sizeof</span>(<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)</div>
<div class="line">                                        &lt;= <a class="code" href="otz__common_8h.html#a4002145756597ed650cbd0447719ac6c">OTZ_1K_SIZE</a>) &amp;&amp;</div>
<div class="line">                                (enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a93000d009ece5da4a14402b31ddd82d9">enc_res_pos</a> &lt; </div>
<div class="line">                                 (<a class="code" href="otz__common_8h.html#ae03d01e9604f8191960ab4faff98c12e">OTZ_MAX_RES_PARAMS</a> + <a class="code" href="otz__common_8h.html#af68d1342e11ec79eb995c40ad0e1303d">OTZ_MAX_REQ_PARAMS</a> ))) {</div>
<div class="line">                        *((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>*)enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#abcd7fbec6df74d8b939c0a97947717b7">res_addr</a> + </div>
<div class="line">                                        enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a07e5a3ad08eb9a072f5a622a532c6278">enc_res_offset</a>) </div>
<div class="line">                                = (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)enc-&gt;<a class="code" href="structotz__secure__encode__cmd.html#a497cda85a2e25f1dee3f5a4fea09e827">data</a>;</div>
<div class="line">                        enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a07e5a3ad08eb9a072f5a622a532c6278">enc_res_offset</a> += <span class="keyword">sizeof</span>(<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>);</div>
<div class="line">                        meta_data[enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a93000d009ece5da4a14402b31ddd82d9">enc_res_pos</a>].<a class="code" href="structotzc__encode__meta.html#a88023806f0f388e879fb6e264c65419c">type</a> </div>
<div class="line">                                =  encode_type;</div>
<div class="line">                        meta_data[enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a93000d009ece5da4a14402b31ddd82d9">enc_res_pos</a>].<a class="code" href="structotzc__encode__meta.html#a9ed5f89cd7e766cfbcc92af753e13a8b">len</a> = enc-&gt;<a class="code" href="structotz__secure__encode__cmd.html#a02767fcd38e58b6a2649eb56eebfea72">len</a>;</div>
<div class="line">                        enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a93000d009ece5da4a14402b31ddd82d9">enc_res_pos</a>++;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">else</span> {</div>
<div class="line">                        ret_val = <a class="code" href="sw__types_8h.html#a0e40f13f8595fceec45f6f8a0c35cf7c">OTZ_ENOMEM</a>;</div>
<div class="line">                        <span class="keywordflow">goto</span> ret_free_mem;</div>
<div class="line">                }   </div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">                ret_val = <a class="code" href="sw__types_8h.html#a73a2d1613cea88f93fbb8830b2fe857a">OTZ_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">                <span class="keywordflow">goto</span> ret_func;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">goto</span> ret_func;</div>
<div class="line"></div>
<div class="line">ret_free_mem:</div>
<div class="line">        <span class="keywordflow">if</span>(enc_context) {</div>
<div class="line">                <span class="keywordflow">if</span>(enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a7513d2246199ffe6feb1c29661df9d83">req_addr</a>) {</div>
<div class="line">                        <a class="code" href="sw__buddy_8h.html#a18008f7ca319ae3bbe7c8cc24bbc7d4b">sw_free</a>(enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a7513d2246199ffe6feb1c29661df9d83">req_addr</a>);</div>
<div class="line">                        enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a7513d2246199ffe6feb1c29661df9d83">req_addr</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span>(enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#abcd7fbec6df74d8b939c0a97947717b7">res_addr</a>) {</div>
<div class="line">                        <a class="code" href="sw__buddy_8h.html#a18008f7ca319ae3bbe7c8cc24bbc7d4b">sw_free</a>(enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#abcd7fbec6df74d8b939c0a97947717b7">res_addr</a>);</div>
<div class="line">                        enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#abcd7fbec6df74d8b939c0a97947717b7">res_addr</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">                }</div>
<div class="line">                <a class="code" href="sw__buddy_8h.html#a18008f7ca319ae3bbe7c8cc24bbc7d4b">sw_free</a>(enc_context);</div>
<div class="line">        } </div>
<div class="line">        <span class="keywordflow">if</span>(meta_data) {</div>
<div class="line">                <a class="code" href="sw__buddy_8h.html#a18008f7ca319ae3bbe7c8cc24bbc7d4b">sw_free</a>(meta_data);</div>
<div class="line">        } </div>
<div class="line">ret_func:</div>
<div class="line">        <span class="keywordflow">if</span>(! (*pmeta_data))</div>
<div class="line">                *pmeta_data = meta_data;</div>
<div class="line">        <span class="keywordflow">if</span>(! (*penc_context))</div>
<div class="line">                *penc_context = enc_context;</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> ret_val;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad87d6051e9afef51225b61095495b00d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void otz_ipi </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structotz__smc__cmd.html">otz_smc_cmd</a> *&#160;</td>
          <td class="paramname"><em>smc_cmd</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Invoke IPI. </p>
<p>This function formulate the parameters for IPI and suspend the current task and invoke the SWI command for IPI notification</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">smc_cmd,:</td><td>Pointer to command structure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cpu__ipi_8c_source.html#l00041">41</a> of file <a class="el" href="cpu__ipi_8c_source.html">cpu_ipi.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="cpu__data_8h.html#af7dace657e83fbc88c3d8196bd0f5c41" title="Parameters stack which is used to SMC call parameters.">params_stack</a>[0] = <a class="code" href="smc__id_8h.html#ab2a2cc9f9983cdf01f6b80c3ee0ca519">CALL_TRUSTZONE_API</a>;</div>
<div class="line">    <a class="code" href="cpu__data_8h.html#af7dace657e83fbc88c3d8196bd0f5c41" title="Parameters stack which is used to SMC call parameters.">params_stack</a>[1] = (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)smc_cmd;</div>
<div class="line">    <a class="code" href="cpu__data_8h.html#af7dace657e83fbc88c3d8196bd0f5c41" title="Parameters stack which is used to SMC call parameters.">params_stack</a>[2] = <a class="code" href="otz__common_8h.html#a77964e56914e3eec4558c784e6ecb182a1f6b81d7cb278746b802e4954257aa91">OTZ_CMD_TYPE_SECURE_TO_SECURE</a>;</div>
<div class="line">    <a class="code" href="cpu__data_8h.html#af7dace657e83fbc88c3d8196bd0f5c41" title="Parameters stack which is used to SMC call parameters.">params_stack</a>[3] = 0;</div>
<div class="line">    <a class="code" href="cpu__data_8h.html#a00e5d91893806fe6133c90b96ac1ca94" title="Valid params flag.">valid_params_flag</a> = 1;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="global_8c.html#a79f94efec61544a5c91b1b89eeb8bfd3" title="Suspends the task.">suspend_task</a>(smc_cmd-&gt;<a class="code" href="structotz__smc__cmd.html#a12a6bd3f7ff1c4a86df9773636fbec46">src_context</a>, <a class="code" href="task_8h.html#a6924eb4ed00ed119294b1f2d81a8d7dda58838702ea5492990134c6b51ff8f251">TASK_STATE_WAIT</a>);</div>
<div class="line"><span class="preprocessor">#ifdef CONFIG_EMULATE_FIQ</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="cpu_8h.html#a1c4201b4e140bba4983a328705fdac18">emulate_swi_handler</a>(0xcccc);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>     <span class="keyword">asm</span> <span class="keyword">volatile</span>(<span class="stringliteral">&quot;swi #0xcccc&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a468df6d87a321a197f874e3a07d3b31d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void otz_ipi_return </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structotz__smc__cmd.html">otz_smc_cmd</a> *&#160;</td>
          <td class="paramname"><em>smc_cmd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ret_val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return for IPI. </p>
<p>This function sets the IPI return value in the originated task. Reschedules the originated task.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">smc_cmd,:</td><td>Command parameter which got passed in IPI </td></tr>
    <tr><td class="paramname">ret_val,:</td><td>Return value of the target task result. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="cpu__ipi_8c_source.html#l00067">67</a> of file <a class="el" href="cpu__ipi_8c_source.html">cpu_ipi.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a426fa6e7d1eaa7c84e108835da641869">irq_flags_t</a> irqflags;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structsw__task.html" title="Task structure.">sw_task</a> *task = <a class="code" href="task_8h.html#ad433925c1b3445cdfd0b42c53f4b9a8c" title="Helper function to return task structure.">get_task</a>(smc_cmd-&gt;<a class="code" href="structotz__smc__cmd.html#a12a6bd3f7ff1c4a86df9773636fbec46">src_context</a>);</div>
<div class="line">    <span class="keywordflow">if</span>(task) {</div>
<div class="line">        task-&gt;<a class="code" href="structsw__task.html#a4cd1fbb02263bbd07af58795431d2cd1">tls</a>-&gt;<a class="code" href="structsw__tls.html#adbd525897d69293551f631668769e4b6">ipi_ret_val</a> = ret_val;</div>
<div class="line"></div>
<div class="line">        spin_lock_irqsave(&amp;<a class="code" href="global_8c.html#a2a711ca66f66e43369bd71b5d6533fbd" title="Global variable structure.">global_val</a>.<a class="code" href="structsw__global.html#a6b363e0a9895617842bdef7b1c76ee89">ready_to_run_lock</a>, &amp;irqflags);</div>
<div class="line">        <a class="code" href="global_8c.html#a0cd78eb963a7c40ebaabf43d55a9770b" title="Schedules the task.">schedule_task</a>(task);</div>
<div class="line">        spin_unlock_irqrestore(&amp;<a class="code" href="global_8c.html#a2a711ca66f66e43369bd71b5d6533fbd" title="Global variable structure.">global_val</a>.<a class="code" href="structsw__global.html#a6b363e0a9895617842bdef7b1c76ee89">ready_to_run_lock</a>,irqflags);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aeac54a699cee6c80d67865a35ce71752"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void otz_release_data </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structotz__secure__encode__ctx.html">otz_secure_encode_ctx</a> *&#160;</td>
          <td class="paramname"><em>enc_context</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structotzc__encode__meta.html">otzc_encode_meta</a> *&#160;</td>
          <td class="paramname"><em>meta_data</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Release the encoded data. </p>
<p>This function releases the resources which got allocated in encoding function.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">enc_context,:</td><td>Encode context </td></tr>
    <tr><td class="paramname">meta_data,:</td><td>Meta data which got populated in encoding </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00760">760</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span>(enc_context) {</div>
<div class="line">                <span class="keywordflow">if</span>(enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a7513d2246199ffe6feb1c29661df9d83">req_addr</a>) {</div>
<div class="line">                        <a class="code" href="sw__buddy_8h.html#a18008f7ca319ae3bbe7c8cc24bbc7d4b">sw_free</a>(enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a7513d2246199ffe6feb1c29661df9d83">req_addr</a>);</div>
<div class="line">                        enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#a7513d2246199ffe6feb1c29661df9d83">req_addr</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span>(enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#abcd7fbec6df74d8b939c0a97947717b7">res_addr</a>) {</div>
<div class="line">                        <a class="code" href="sw__buddy_8h.html#a18008f7ca319ae3bbe7c8cc24bbc7d4b">sw_free</a>(enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#abcd7fbec6df74d8b939c0a97947717b7">res_addr</a>);</div>
<div class="line">                        enc_context-&gt;<a class="code" href="structotz__secure__encode__ctx.html#abcd7fbec6df74d8b939c0a97947717b7">res_addr</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">                }</div>
<div class="line">                <a class="code" href="sw__buddy_8h.html#a18008f7ca319ae3bbe7c8cc24bbc7d4b">sw_free</a>(enc_context);</div>
<div class="line">        } </div>
<div class="line">        <span class="keywordflow">if</span>(meta_data) {</div>
<div class="line">                <a class="code" href="sw__buddy_8h.html#a18008f7ca319ae3bbe7c8cc24bbc7d4b">sw_free</a>(meta_data);</div>
<div class="line">        } </div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab005498bb644293762a2f577d0eb7eb3"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sa_close_session </td>
          <td>(</td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>session_context</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Close Session. </p>
<p>This function close the session which got established between secure and non-secure application. This function destroys the corresponding service task.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">session_context,:</td><td>Session ID</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Session closed successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
 </dd></dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00394">394</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> ret_val;</div>
<div class="line">        ret_val = <a class="code" href="task_8h.html#a1057a59409acffbd0c626dcebe0f5138" title="Destroy the created task.">destroy_task</a>(*((<span class="keywordtype">int</span>*)session_context));</div>
<div class="line">        <span class="keywordflow">return</span> ret_val;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac4e7d606b3dba5159d3c3a7a9f1d7511"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sa_create_entry_point </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>svc_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structsa__config__t.html">sa_config_t</a> *&#160;</td>
          <td class="paramname"><em>psa_config</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Invokes the init function of the service task. </p>
<p>This function invokes the init function of the corresponding service task</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">svc_id,:</td><td>Service identifier of the task </td></tr>
    <tr><td class="paramname">psa_config,:</td><td>Configuration details for the task</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Session established successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
 </dd></dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00270">270</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> ret=<a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>;</div>
<div class="line">        <span class="keywordflow">if</span>(svc_id == <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aa2cb1d1aee99cb072f3c2e5928ffbf65c">OTZ_SVC_ECHO</a>) {</div>
<div class="line">                 <span class="keywordflow">if</span>(<a class="code" href="echo__task_8c.html#a12bd3ced8788ed087ece46bb203694bc" title=": Echo task init">echo_task_init</a>(psa_config) != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>)</div>
<div class="line">                         <span class="keywordflow">return</span> -1;</div>
<div class="line">        } </div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(svc_id == <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aacbc01795f896499464e162fc15d87ced">OTZ_SVC_DRM</a>) {</div>
<div class="line">                <span class="keywordflow">if</span>( <a class="code" href="drm__task_8c.html#af6cb859271f38b85836a112fadc27842" title=": DRM task init">drm_task_init</a>(psa_config) != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>)</div>
<div class="line">                        <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(svc_id == <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aaffa07fe76b99c8529f2a5a3661257800">OTZ_SVC_CRYPT</a>) {</div>
<div class="line">                <span class="keywordflow">if</span>( <a class="code" href="crypto__task_8c.html#aad840aa12178371254cf54b4040c698c" title=": Crypto task init">crypto_task_init</a>(psa_config) != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>)</div>
<div class="line">                        <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(svc_id == <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aadba8cf97767809199e1eaec0bf9e8731">OTZ_SVC_MUTEX_TEST</a>) {</div>
<div class="line">                <span class="keywordflow">if</span>(<a class="code" href="elf__loader__app_8c.html#a0bb6b7debaa5edc43584f49158d8c277" title=": Mutex test task init">mutex_test_task_init</a>(psa_config) != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>)</div>
<div class="line">                        <span class="keywordflow">return</span> -1;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(svc_id == <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aabeab15394d1dab1b902190515516ea05">OTZ_SVC_GLOBAL</a>) {</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="dispatcher__task_8c.html#a24b2cf461d7256034a302b442796fbdc" title="Dispatcher task init.">dispatch_task_init</a>(psa_config);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef CONFIG_GUI_SUPPORT</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(svc_id == <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aae1473c238d5e1a8f1ec201674d58617a">OTZ_SVC_VIRTUAL_KEYBOARD</a>) {</div>
<div class="line">                <span class="keywordflow">if</span>(<a class="code" href="virtual__keyboard__task_8h.html#a4debbd6743c8d7f4dde7e54571cc7669" title=": Mutex test task init">virtual_keyboard_task_init</a>(psa_config) != <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>)</div>
<div class="line">                        <span class="keywordflow">return</span> -1;              </div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#ifdef CONFIG_SW_ELF_LOADER_SUPPORT</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span>(psa_config-&gt;<a class="code" href="structsa__config__t.html#aaf22a3f2509c5b4b1c7eeccc4be71a10">elf_flag</a> == <a class="code" href="elf__loader_8h.html#acfd3dc2389f7fcf6882a4c66cfbf06dc">ELF_FLAG</a>)</div>
<div class="line">                ret = <a class="code" href="sw__syscall_8h.html#ac0f29297004391a1e1557007fb5f8d7a" title="system call to load a elf">__elf_load</a>(psa_config);</div>
<div class="line">        <span class="keywordflow">return</span> ret;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af04390d3da0fa08dc61dfa5ebca4fa9d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sa_destroy_entry_point </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>svc_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>elf_flag</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Invokes the exit function of the service task. </p>
<p>This function invokes the exit function of the corresponding service task</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">svc_id,:</td><td>Service identifier of the task </td></tr>
    <tr><td class="paramname">data,:</td><td>Private data which need to be freed </td></tr>
    <tr><td class="paramname">elf_flag</td><td>: to free the mapped secure memory </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Session closed successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
</dd></dl>
<p>This function invokes the exit function of the corresponding service task</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">svc_id,:</td><td>Service identifier of the task </td></tr>
    <tr><td class="paramname">data,:</td><td>Private data which need to be freed</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Session closed successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
 </dd></dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00323">323</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"><span class="preprocessor">#if defined (CONFIG_SW_ELF_LOADER_SUPPORT)</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="comment">/* unmap the region of secure memory */</span></div>
<div class="line">        <span class="keywordflow">if</span> (elf_flag == <a class="code" href="elf__loader_8h.html#aa3de69f2cbb1862a37592061fbb666d2">ELF_FLAG_MAP</a>){</div>
<div class="line">                <a class="code" href="elf__loader_8c.html#ab6814f634bead0f3ecd360e88acd9df8" title="clean up function to remove the mappings">elf_loader_cleanup</a>();</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <span class="keywordflow">if</span>(svc_id == <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aa2cb1d1aee99cb072f3c2e5928ffbf65c">OTZ_SVC_ECHO</a>) {</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="echo__task_8c.html#a256184588424d2a5772b71dac814747b" title="Echo task exit.">echo_task_exit</a>(<a class="code" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span>(svc_id == <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aacbc01795f896499464e162fc15d87ced">OTZ_SVC_DRM</a>) {</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="drm__task_8c.html#af6d65f1d9674eb40a3fc99da6d56cd2d" title="DRM task exit.">drm_task_exit</a>(<a class="code" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span>(svc_id == <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aaffa07fe76b99c8529f2a5a3661257800">OTZ_SVC_CRYPT</a>) {</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="crypto__task_8c.html#a08a7a6ced0f333203820b975324b5311" title="Crypto task exit.">crypto_task_exit</a>(<a class="code" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span>(svc_id == <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aadba8cf97767809199e1eaec0bf9e8731">OTZ_SVC_MUTEX_TEST</a>) {</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="elf__loader__app_8c.html#a6a26858706ad2f8a2c87435acdf00dad" title="Mutex test task exit.">mutex_test_task_exit</a>(<a class="code" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a>);</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">if</span>(svc_id == <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aabeab15394d1dab1b902190515516ea05">OTZ_SVC_GLOBAL</a>) {</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="dispatcher__task_8c.html#a5b8539980492a6994b4e99826cfba661" title="Dispatcher task exit.">dispatch_task_exit</a>(<a class="code" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a>);</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#ifdef CONFIG_GUI_SUPPORT</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">if</span>(svc_id == <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aae1473c238d5e1a8f1ec201674d58617a">OTZ_SVC_VIRTUAL_KEYBOARD</a>) {</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="virtual__keyboard__task_8h.html#a47e85e31c09bbd6ecea9eb36eef2dc74" title="Mutex test task exit.">virtual_keyboard_task_exit</a>(<a class="code" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a>);</div>
<div class="line">        }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="sw__types_8h.html#ade5dde89d25481cc2f1ebe77a8d0d85b">OTZ_EFAIL</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af39d5aab76117e76cecf6d911cdaefb6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sa_open_session </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structsa__config__t.html">sa_config_t</a> *&#160;</td>
          <td class="paramname"><em>psa_config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&#160;</td>
          <td class="paramname"><em>session_context</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Open Session. </p>
<p>This function establish the session between secure and non-secure application. This function creates the task correspond to the service ID.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">psa_config,:</td><td>Pointer to task init configuration structure. </td></tr>
    <tr><td class="paramname">session_context,:</td><td>Session ID as output parameter.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Session established successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
 </dd></dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00372">372</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordtype">int</span> ret_val;</div>
<div class="line">        <span class="comment">/* session context = task id */</span></div>
<div class="line">        ret_val = <a class="code" href="task_8h.html#a43eeab0b9c59f88e4cff31a1bad971ec" title="Create a task.">create_task</a>(psa_config, (<span class="keywordtype">int</span>*)session_context);</div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">return</span> ret_val;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9bd892045df93e29b38e8744cb151c6b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int update_response_len </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structotzc__encode__meta.html">otzc_encode_meta</a> *&#160;</td>
          <td class="paramname"><em>meta_data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>len</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Helper function to update the response length. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">meta_data,:</td><td>Meta data helps to identify the encoded data </td></tr>
    <tr><td class="paramname">pos,:</td><td>Current position </td></tr>
    <tr><td class="paramname">len,:</td><td>new response length</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK - Updated responsed length successfully<br/>
 OTZ_* - An implementation-defined error code for any other error.<br/>
 </dd></dl>

<p>Definition at line <a class="el" href="secure__api_8c_source.html#l00589">589</a> of file <a class="el" href="secure__api_8c_source.html">secure_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordflow">if</span>(pos &lt;= <a class="code" href="otz__common_8h.html#af68d1342e11ec79eb995c40ad0e1303d">OTZ_MAX_REQ_PARAMS</a> + <a class="code" href="otz__common_8h.html#ae03d01e9604f8191960ab4faff98c12e">OTZ_MAX_RES_PARAMS</a>) {</div>
<div class="line">                meta_data[pos -1].<a class="code" href="structotzc__encode__meta.html#a2962366827a8abcb92fb657cbd232fb1">ret_len</a> = len;</div>
<div class="line">                <span class="keywordflow">return</span> 0;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span></div>
<div class="line">                <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jan 3 2013 00:33:53 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
