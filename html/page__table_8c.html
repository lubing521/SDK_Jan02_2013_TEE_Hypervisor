<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>page_table.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_6aeebb853ebd8c514e6186653c592c82.html">otzone</a></li><li class="navelem"><a class="el" href="dir_fb44076c8b62c63869cf8a830933e50d.html">src</a></li><li class="navelem"><a class="el" href="dir_5054d892aa124e015c653e8232659643.html">arch</a></li><li class="navelem"><a class="el" href="dir_a8ff73de53c273984b8a08f3bd00cae5.html">arm</a></li><li class="navelem"><a class="el" href="dir_0f6da8a9c5259cd162214505231682b4.html">armv7</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">page_table.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="sw__types_8h_source.html">sw_types.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__debug_8h_source.html">sw_debug.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__assert_8h_source.html">sw_assert.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__mem__functions_8h_source.html">sw_mem_functions.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="cache_8h_source.html">cache.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="cpu__mmu_8h_source.html">cpu_mmu.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="page__table_8h_source.html">page_table.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="mem__mng_8h_source.html">mem_mng.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="global_8h_source.html">global.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__list_8h_source.html">sw_list.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="uart_8h_source.html">uart.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__board_8h_source.html">sw_board.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="cpu__data_8h_source.html">cpu_data.h</a>&gt;</code><br/>
</div>
<p><a href="page__table_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a10974107733f92c2c3efbea407ef0c42"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#a10974107733f92c2c3efbea407ef0c42">get_secure_ptd</a> (void)</td></tr>
<tr class="memdesc:a10974107733f92c2c3efbea407ef0c42"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get secure page table pointer.  <a href="#a10974107733f92c2c3efbea407ef0c42"></a><br/></td></tr>
<tr class="separator:a10974107733f92c2c3efbea407ef0c42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a369ffb695e9118ac6e4ee04ea25ac5e6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#a369ffb695e9118ac6e4ee04ea25ac5e6">map_secure_page_table</a> (void)</td></tr>
<tr class="memdesc:a369ffb695e9118ac6e4ee04ea25ac5e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize page table entries.  <a href="#a369ffb695e9118ac6e4ee04ea25ac5e6"></a><br/></td></tr>
<tr class="separator:a369ffb695e9118ac6e4ee04ea25ac5e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7920ee52ee57fc11fadc11928d92987"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#aa7920ee52ee57fc11fadc11928d92987">map_to_secure</a> (<a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a> phy_addr, <a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> va_addr)</td></tr>
<tr class="separator:aa7920ee52ee57fc11fadc11928d92987"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aae72a51804a247c5ed3eae86aa01036a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#aae72a51804a247c5ed3eae86aa01036a">__map_to_ns</a> (<a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a> phy_addr, <a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> *va_addr)</td></tr>
<tr class="memdesc:aae72a51804a247c5ed3eae86aa01036a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create shared memory mapping between secure and non-secure kernel.  <a href="#aae72a51804a247c5ed3eae86aa01036a"></a><br/></td></tr>
<tr class="separator:aae72a51804a247c5ed3eae86aa01036a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5fc63d641c4d938c6bcf4768203afffe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#a5fc63d641c4d938c6bcf4768203afffe">map_to_ns</a> (<a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a> phy_addr, <a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> *va_addr)</td></tr>
<tr class="memdesc:a5fc63d641c4d938c6bcf4768203afffe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wrapper function for __map_to_ns.  <a href="#a5fc63d641c4d938c6bcf4768203afffe"></a><br/></td></tr>
<tr class="separator:a5fc63d641c4d938c6bcf4768203afffe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a790927327823cab37801fd18f60a4642"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#a790927327823cab37801fd18f60a4642">map_device</a> (<a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> va, <a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a> pa, <a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> size)</td></tr>
<tr class="memdesc:a790927327823cab37801fd18f60a4642"><td class="mdescLeft">&#160;</td><td class="mdescRight">Map devices.  <a href="#a790927327823cab37801fd18f60a4642"></a><br/></td></tr>
<tr class="separator:a790927327823cab37801fd18f60a4642"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a797a56ba15d55f0a14b0200afe0bce0e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#a797a56ba15d55f0a14b0200afe0bce0e">map_user_access_device</a> (<a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> va, <a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a> pa, <a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> size)</td></tr>
<tr class="memdesc:a797a56ba15d55f0a14b0200afe0bce0e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Map user access devices.  <a href="#a797a56ba15d55f0a14b0200afe0bce0e"></a><br/></td></tr>
<tr class="separator:a797a56ba15d55f0a14b0200afe0bce0e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa3398cdd5b2024bf4c9c6e1bc05a2a7d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#aa3398cdd5b2024bf4c9c6e1bc05a2a7d">map_device_table</a> (const struct <a class="el" href="structdevmap.html">devmap</a> *dt)</td></tr>
<tr class="memdesc:aa3398cdd5b2024bf4c9c6e1bc05a2a7d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Map device table.  <a href="#aa3398cdd5b2024bf4c9c6e1bc05a2a7d"></a><br/></td></tr>
<tr class="separator:aa3398cdd5b2024bf4c9c6e1bc05a2a7d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a00c2b39775a853252276206ce439dc96"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#a00c2b39775a853252276206ce439dc96">map_user_access_device_table</a> (const struct <a class="el" href="structdevmap.html">devmap</a> *dt)</td></tr>
<tr class="memdesc:a00c2b39775a853252276206ce439dc96"><td class="mdescLeft">&#160;</td><td class="mdescRight">Map User Access device table.  <a href="#a00c2b39775a853252276206ce439dc96"></a><br/></td></tr>
<tr class="separator:a00c2b39775a853252276206ce439dc96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a288b10ba6b3e5356af9961adf461f54f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#a288b10ba6b3e5356af9961adf461f54f">map_secure_memory</a> (<a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> va, <a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a> pa, <a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> size, <a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> ptf)</td></tr>
<tr class="memdesc:a288b10ba6b3e5356af9961adf461f54f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Map a range of secure memory area.  <a href="#a288b10ba6b3e5356af9961adf461f54f"></a><br/></td></tr>
<tr class="separator:a288b10ba6b3e5356af9961adf461f54f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a052242469f722badd350a69d03e9e88a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#a052242469f722badd350a69d03e9e88a">unmap_secure_memory</a> (<a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> va, <a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> size)</td></tr>
<tr class="memdesc:a052242469f722badd350a69d03e9e88a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unmap a range of secure memory area.  <a href="#a052242469f722badd350a69d03e9e88a"></a><br/></td></tr>
<tr class="separator:a052242469f722badd350a69d03e9e88a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaa870c20c24c735d412f1366faefeae4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#aaa870c20c24c735d412f1366faefeae4">map_nsmemsect_normal</a> (<a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> va, <a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a> pa, <a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> size)</td></tr>
<tr class="memdesc:aaa870c20c24c735d412f1366faefeae4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Map a range of non secure memory area as normal memory with attributes Outer and Inner write back, write allocate.  <a href="#aaa870c20c24c735d412f1366faefeae4"></a><br/></td></tr>
<tr class="separator:aaa870c20c24c735d412f1366faefeae4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af0ce58eed026b6e0bba73b9617c09b8d"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#af0ce58eed026b6e0bba73b9617c09b8d">unmap_nsmemsect_normal</a> (<a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> va, <a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> size)</td></tr>
<tr class="memdesc:af0ce58eed026b6e0bba73b9617c09b8d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unmap a range of non secure memory area.  <a href="#af0ce58eed026b6e0bba73b9617c09b8d"></a><br/></td></tr>
<tr class="separator:af0ce58eed026b6e0bba73b9617c09b8d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01c4526037a56ce113dd0f572d4da222"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#a01c4526037a56ce113dd0f572d4da222">map_section_entry</a> (<a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *pgd, struct <a class="el" href="structcpu__section.html">cpu_section</a> *entry)</td></tr>
<tr class="memdesc:a01c4526037a56ce113dd0f572d4da222"><td class="mdescLeft">&#160;</td><td class="mdescRight">Create a section map entry.  <a href="#a01c4526037a56ce113dd0f572d4da222"></a><br/></td></tr>
<tr class="separator:a01c4526037a56ce113dd0f572d4da222"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adf1446683f2fb6788a64115a22de1bb6"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#adf1446683f2fb6788a64115a22de1bb6">map_ns_section_entry</a> (<a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *pgd, struct <a class="el" href="structcpu__section.html">cpu_section</a> *entry)</td></tr>
<tr class="memdesc:adf1446683f2fb6788a64115a22de1bb6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Map the non-secure memory in secure page table for shared memory access.  <a href="#adf1446683f2fb6788a64115a22de1bb6"></a><br/></td></tr>
<tr class="separator:adf1446683f2fb6788a64115a22de1bb6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1269bd6c7673bcbb9217d118ea8347f0"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#a1269bd6c7673bcbb9217d118ea8347f0">unmap_section_entry</a> (<a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *pgd, <a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> va)</td></tr>
<tr class="separator:a1269bd6c7673bcbb9217d118ea8347f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea2bcbf5befeee89453e7233f8b8f199"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#aea2bcbf5befeee89453e7233f8b8f199">unmap_ns_section_entry</a> (<a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *pgd, <a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> va)</td></tr>
<tr class="memdesc:aea2bcbf5befeee89453e7233f8b8f199"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unmap the shared section entry from secure page table.  <a href="#aea2bcbf5befeee89453e7233f8b8f199"></a><br/></td></tr>
<tr class="separator:aea2bcbf5befeee89453e7233f8b8f199"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaadf422c3b31b06810ae0bdbda0f7835"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#aaadf422c3b31b06810ae0bdbda0f7835">unmap_from_secure</a> (<a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> va_addr)</td></tr>
<tr class="separator:aaadf422c3b31b06810ae0bdbda0f7835"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe9314a5cd1eff4bbce0c096042f6a54"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#afe9314a5cd1eff4bbce0c096042f6a54">__unmap_from_ns</a> (<a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> va_addr)</td></tr>
<tr class="memdesc:afe9314a5cd1eff4bbce0c096042f6a54"><td class="mdescLeft">&#160;</td><td class="mdescRight">Unmap the non-secure memory from secure page table.  <a href="#afe9314a5cd1eff4bbce0c096042f6a54"></a><br/></td></tr>
<tr class="separator:afe9314a5cd1eff4bbce0c096042f6a54"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca3f6249157b4ed2c5c62e862bde4eee"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#aca3f6249157b4ed2c5c62e862bde4eee">unmap_from_ns</a> (<a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> va_addr)</td></tr>
<tr class="memdesc:aca3f6249157b4ed2c5c62e862bde4eee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Wrapper function for __unmap_from_ns.  <a href="#aca3f6249157b4ed2c5c62e862bde4eee"></a><br/></td></tr>
<tr class="separator:aca3f6249157b4ed2c5c62e862bde4eee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac473c912ec8117218d8d7b1462e42161"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#ac473c912ec8117218d8d7b1462e42161">page_ref_add</a> (<a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> l1_pte)</td></tr>
<tr class="memdesc:ac473c912ec8117218d8d7b1462e42161"><td class="mdescLeft">&#160;</td><td class="mdescRight">Increment page table reference of shared memory.  <a href="#ac473c912ec8117218d8d7b1462e42161"></a><br/></td></tr>
<tr class="separator:ac473c912ec8117218d8d7b1462e42161"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d443c09278671e076978f7016269f52"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="page__table_8c.html#a4d443c09278671e076978f7016269f52">page_ref_release</a> (<a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> l1_pte)</td></tr>
<tr class="memdesc:a4d443c09278671e076978f7016269f52"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decrement page table reference of shared memory.  <a href="#a4d443c09278671e076978f7016269f52"></a><br/></td></tr>
<tr class="separator:a4d443c09278671e076978f7016269f52"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="aae72a51804a247c5ed3eae86aa01036a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int __map_to_ns </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>&#160;</td>
          <td class="paramname"><em>phy_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> *&#160;</td>
          <td class="paramname"><em>va_addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create shared memory mapping between secure and non-secure kernel. </p>
<p>This function creates the page table entry with ns bit set. So that this section of the non-secure memory act like a shared memory.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">phy_addr,:</td><td>Physical address of the non-secure memory </td></tr>
    <tr><td class="paramname">va_addr,:</td><td>Virtual address of the shared memory</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK <br/>
 OTZ_FAIL <br/>
 </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00122">122</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret_val;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structcpu__section.html" title="Section page table entry.">cpu_section</a> desc;</div>
<div class="line">    desc.<a class="code" href="structcpu__section.html#a985f81e41accb44872924ac29d008c70">va</a> =  phy_addr;</div>
<div class="line">    desc.pa =  phy_addr;</div>
<div class="line">    desc.dom = <a class="code" href="page__table_8h.html#a6d41982db6b7687e1eb4fa9ebc82bf1f">SECURE_ACCESS_DOMAIN</a>;</div>
<div class="line">    desc.ap = <a class="code" href="page__table_8h.html#afa0e571b65ad32bb40622aac6b21c69eac6b6e95619e894fd2e2321e8541af548">PRIV_RW_USR_RW</a>;</div>
<div class="line">    desc.xn = <a class="code" href="page__table_8h.html#aa64bf56002504df2f7b324dca0fa3afb">L1_EXECUTE_ALLOW</a>;</div>
<div class="line">    desc.tex = 0x1; </div>
<div class="line">    desc.c = 0x1;</div>
<div class="line">    desc.b = 0x1;  </div>
<div class="line">    desc.ns = 1;</div>
<div class="line">    desc.ng = 0;</div>
<div class="line"><span class="preprocessor">#ifdef CONFIG_SW_MULTICORE</span></div>
<div class="line"><span class="preprocessor"></span>    desc.s = 1;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>    desc.s = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    ret_val = <a class="code" href="page__table_8h.html#adf1446683f2fb6788a64115a22de1bb6" title="Map the non-secure memory in secure page table for shared memory access.">map_ns_section_entry</a>((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>*)secure_page_table, &amp;desc);</div>
<div class="line">    <span class="keywordflow">if</span>(!ret_val) {</div>
<div class="line">        *va_addr = desc.va;</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afe9314a5cd1eff4bbce0c096042f6a54"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int __unmap_from_ns </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>&#160;</td>
          <td class="paramname"><em>va_addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unmap the non-secure memory from secure page table. </p>
<p>This function unmaps the non-secure memory from secure page table. i.e. set 'NS' bit to zero</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">va_addr,:</td><td>Virtual address to be unmapped</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK <br/>
 </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00726">726</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret_val;</div>
<div class="line">    ret_val = <a class="code" href="page__table_8h.html#aea2bcbf5befeee89453e7233f8b8f199" title="Unmap the shared section entry from secure page table.">unmap_ns_section_entry</a>((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>*)secure_page_table, va_addr);</div>
<div class="line">    <span class="keywordflow">return</span> ret_val;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a10974107733f92c2c3efbea407ef0c42"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>* get_secure_ptd </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get secure page table pointer. </p>
<p>Returns the secure page table pointer.</p>
<p>This function returns the page table pointer</p>
<dl class="section return"><dt>Returns</dt><dd>Pointer to the page table </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00055">55</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="cpu__data_8h.html#a28233586622a636716549a593fc597c4" title="Secure page table.">secure_page_table</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a790927327823cab37801fd18f60a4642"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int map_device </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>&#160;</td>
          <td class="paramname"><em>va</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>&#160;</td>
          <td class="paramname"><em>pa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Map devices. </p>
<p>This function assumes that the start address and size are section aligned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">va,:</td><td>virtual address </td></tr>
    <tr><td class="paramname">pa,:</td><td>physical address  size: size</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK <br/>
 OTZ_FAIL <br/>
 </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00182">182</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">            <span class="keyword">struct </span><a class="code" href="structcpu__section.html" title="Section page table entry.">cpu_section</a> desc;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (size &amp; (<a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a> - 1))</div>
<div class="line">            <span class="keywordflow">goto</span> error;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="structcpu__section.html#a985f81e41accb44872924ac29d008c70">va</a> &amp; (<a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a> - 1))</div>
<div class="line">            <span class="keywordflow">goto</span> error;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="structcpu__section.html#a91a14277cea12c701ca75f11871897c2">pa</a> &amp; (<a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a> -1))</div>
<div class="line">            <span class="keywordflow">goto</span> error;</div>
<div class="line"></div>
<div class="line">    desc.<a class="code" href="structcpu__section.html#a4067484b965c309ab64925fcf46b101a">dom</a> = <a class="code" href="page__table_8h.html#a6d41982db6b7687e1eb4fa9ebc82bf1f">SECURE_ACCESS_DOMAIN</a>;</div>
<div class="line">    desc.ap = <a class="code" href="page__table_8h.html#afa0e571b65ad32bb40622aac6b21c69ea9fc7e6176561b72282db60fdc8c51f56">PRIV_RW_USR_NO</a>;</div>
<div class="line">    desc.xn = <a class="code" href="page__table_8h.html#a61a688cffbe7f6f1b8ddee7315ac1c2d">L1_EXECUTE_NEVER</a>;</div>
<div class="line">    <span class="comment">/* </span></div>
<div class="line"><span class="comment">     * Device </span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    desc.tex = 0x0; </div>
<div class="line">    desc.c = 0x0;</div>
<div class="line">    desc.b = 0x1;  </div>
<div class="line">    desc.ns = 0;</div>
<div class="line">    desc.ng = 0;</div>
<div class="line"><span class="preprocessor">#ifdef CONFIG_SW_MULTICORE</span></div>
<div class="line"><span class="preprocessor"></span>    desc.s = 1;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>    desc.s = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">while</span>(size) {</div>
<div class="line">        desc.va =  <a class="code" href="structcpu__section.html#a985f81e41accb44872924ac29d008c70">va</a>;</div>
<div class="line">        desc.pa =  <a class="code" href="structcpu__section.html#a91a14277cea12c701ca75f11871897c2">pa</a>;</div>
<div class="line">        <a class="code" href="page__table_8h.html#a01c4526037a56ce113dd0f572d4da222" title="Create a section map entry.">map_section_entry</a>(secure_page_table, &amp;desc);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="structcpu__section.html#a985f81e41accb44872924ac29d008c70">va</a> += <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">        <a class="code" href="structcpu__section.html#a91a14277cea12c701ca75f11871897c2">pa</a> += <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">        size -= <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">error:</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa3398cdd5b2024bf4c9c6e1bc05a2a7d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int map_device_table </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structdevmap.html">devmap</a> *&#160;</td>
          <td class="paramname"><em>dt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Map device table. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dt,:</td><td>pointer to array of device mappings Array has to terminated with zero.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK <br/>
 OTZ_FAIL <br/>
 </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00301">301</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordflow">while</span> (*(<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *)dt != 0) {</div>
<div class="line">                <a class="code" href="page__table_8c.html#a790927327823cab37801fd18f60a4642" title="Map devices.">map_device</a>(dt-&gt;<a class="code" href="structdevmap.html#a33baaf4e8f8dc3d565792546cec2caa8">dv_va</a>, dt-&gt;<a class="code" href="structdevmap.html#ad97a5ac7d381ceda0ee2e986351eb18b">dv_pa</a>, dt-&gt;<a class="code" href="structdevmap.html#a4c15e90d519b56483883c9999e58094b">dv_size</a>);</div>
<div class="line">                dt++;</div>
<div class="line">        };</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adf1446683f2fb6788a64115a22de1bb6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int map_ns_section_entry </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *&#160;</td>
          <td class="paramname"><em>pgd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcpu__section.html">cpu_section</a> *&#160;</td>
          <td class="paramname"><em>entry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Map the non-secure memory in secure page table for shared memory access. </p>
<p>This function creates the section mapping with 'NS' bit set to create a shared memory access.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pgd,:</td><td>Pointer to page table </td></tr>
    <tr><td class="paramname">entry,:</td><td>Pointer to section entry</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK <br/>
 OTZ_FAIL <br/>
 </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00585">585</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> l1_index = 0;</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *l1_pte;</div>
<div class="line"></div>
<div class="line">    l1_index = entry-&gt;<a class="code" href="structcpu__section.html#a985f81e41accb44872924ac29d008c70">va</a> &gt;&gt; 20;</div>
<div class="line">    l1_pte = pgd + l1_index;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span> ((*l1_pte) &amp; <a class="code" href="page__table_8h.html#ab75a945cf8991da4fc1e857dd82f7ffe">L1_TYPE_MASK</a>) {</div>
<div class="line">    <span class="keywordflow">case</span> (<a class="code" href="page__table_8h.html#a8031bfc0509f595afb1aca828da9da73">L1_TYPE_FAULT</a>):</div>
<div class="line">        *l1_pte = ( entry-&gt;<a class="code" href="structcpu__section.html#a91a14277cea12c701ca75f11871897c2">pa</a> &amp; <a class="code" href="page__table_8h.html#ae179c94865550ea9e56ce7a7b76597ab">SECTION_BASE_MASK</a>) | <a class="code" href="page__table_8h.html#a6bdf5c2f2b3a365693903118faf0aa4f">L1_TYPE_SECTION</a>;</div>
<div class="line">        *l1_pte |= (entry-&gt;<a class="code" href="structcpu__section.html#a4067484b965c309ab64925fcf46b101a">dom</a> &lt;&lt; <a class="code" href="page__table_8h.html#a4cecc2e604f0de4f4e948e65da156989">L1_DOMAIN_SHIFT</a>);</div>
<div class="line">        *l1_pte |= (entry-&gt;<a class="code" href="structcpu__section.html#ad50425e6161f78838bb7ea698e5dd348">b</a> &lt;&lt; <a class="code" href="page__table_8h.html#a65534f840b93fd8ef53f243d55b338fa">L1_SECTION_B_SHIFT</a>);</div>
<div class="line">        *l1_pte |= (entry-&gt;<a class="code" href="structcpu__section.html#a5039f7e8fa5e5c06eb27c746efe24716">c</a> &lt;&lt; <a class="code" href="page__table_8h.html#afba7944fb42cd342ceee6474e9f30fbe">L1_SECTION_C_SHIFT</a>);</div>
<div class="line">        *l1_pte |= (entry-&gt;<a class="code" href="structcpu__section.html#a8cd9e7242287b655973dff3f9542b95f">tex</a> &lt;&lt; <a class="code" href="page__table_8h.html#aca6a8ae44c608a01db1c8b26d89d1f9b">L1_SECTION_TEX_SHIFT</a>);</div>
<div class="line">        *l1_pte |= (entry-&gt;<a class="code" href="structcpu__section.html#a79096075798e2b9a895d3395784ff02b">xn</a> &lt;&lt; <a class="code" href="page__table_8h.html#ade3f5cbb65b4e707bafbf528f457929f">L1_SECTION_XN_SHIFT</a>);</div>
<div class="line">        *l1_pte |= ((entry-&gt;<a class="code" href="structcpu__section.html#a2842a077a6d8d757c42101cdf57a878e">ap</a> &amp; <a class="code" href="page__table_8h.html#a9004e401798facd312556bcf19774cf6">L1_SECTION_AP_MASK</a>) &lt;&lt; <a class="code" href="page__table_8h.html#a4747e2a6d990c581086b57c5812c2f88">L1_SECTION_AP_SHIFT</a>);</div>
<div class="line">        *l1_pte |= (((entry-&gt;<a class="code" href="structcpu__section.html#a2842a077a6d8d757c42101cdf57a878e">ap</a> &gt;&gt; 2) &amp; 0x1) &lt;&lt; <a class="code" href="page__table_8h.html#aee827d03962a9d09e481de3d7c483743">L1_SECTION_AP2_SHIFT</a>);</div>
<div class="line">        *l1_pte |= (entry-&gt;<a class="code" href="structcpu__section.html#ad4a3cfac3a42ea88f90484d0b85ff878">s</a> &lt;&lt; <a class="code" href="page__table_8h.html#ab7c37d70bf182d50ddbdb67bbc5c0895">L1_SECTION_S_SHIFT</a>);</div>
<div class="line">        *l1_pte |= (entry-&gt;<a class="code" href="structcpu__section.html#a1b3b2d519ed623ef59ed4de053dbe556">ng</a> &lt;&lt; <a class="code" href="page__table_8h.html#aa682d49b7e17c5fb7fb16477c1063533">L1_SECTION_NG_SHIFT</a>);</div>
<div class="line">        *l1_pte |= (entry-&gt;<a class="code" href="structcpu__section.html#a164e8a2c360da5efe40b930202e4f079">ns</a> &lt;&lt; <a class="code" href="page__table_8h.html#a7fe6dbb5bae47ae1909c763444492eb2">L1_SECTION_NS_SHIFT</a>);</div>
<div class="line"><span class="comment">/*              </span></div>
<div class="line"><span class="comment">                flush is not needed - page table is cacheable </span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line">        <a class="code" href="page__table_8h.html#ac473c912ec8117218d8d7b1462e42161" title="Increment page table reference of shared memory.">page_ref_add</a>((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)l1_pte);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> (<a class="code" href="page__table_8h.html#a6bdf5c2f2b3a365693903118faf0aa4f">L1_TYPE_SECTION</a>):</div>
<div class="line">        <span class="keywordflow">if</span>(!(*l1_pte &amp; <a class="code" href="page__table_8h.html#a62d8835466996d145a9dea85b3ae0b6d">L1_SECTION_NS_IDX_MASK</a>)) {</div>
<div class="line">            *l1_pte |= (1 &lt;&lt; <a class="code" href="page__table_8h.html#a7fe6dbb5bae47ae1909c763444492eb2">L1_SECTION_NS_SHIFT</a>);</div>
<div class="line"><span class="comment">/*              </span></div>
<div class="line"><span class="comment">                flush is not needed - page table is cacheable </span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line">        }</div>
<div class="line">        <a class="code" href="page__table_8h.html#ac473c912ec8117218d8d7b1462e42161" title="Increment page table reference of shared memory.">page_ref_add</a>((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)l1_pte);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: section_map_hva_to_hpa: This function supports &quot;</span></div>
<div class="line">                      <span class="stringliteral">&quot;only section mappings.\n&quot;</span>);</div>
<div class="line">        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW:   L1 descriptor: %08x\n&quot;</span>, *l1_pte);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaa870c20c24c735d412f1366faefeae4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int map_nsmemsect_normal </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>&#160;</td>
          <td class="paramname"><em>va</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>&#160;</td>
          <td class="paramname"><em>pa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Map a range of non secure memory area as normal memory with attributes Outer and Inner write back, write allocate. </p>
<p>This function assumes that the start address and size are section aligned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">va,:</td><td>virtual address </td></tr>
    <tr><td class="paramname">pa,:</td><td>physical address </td></tr>
    <tr><td class="paramname">size,:</td><td>size</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK <br/>
 OTZ_FAIL <br/>
 </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00443">443</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structcpu__section.html" title="Section page table entry.">cpu_section</a> desc;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (size &amp; (<a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a> - 1))</div>
<div class="line">            <span class="keywordflow">goto</span> error;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="structcpu__section.html#a985f81e41accb44872924ac29d008c70">va</a> &amp; (<a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a> - 1))</div>
<div class="line">            <span class="keywordflow">goto</span> error;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="structcpu__section.html#a91a14277cea12c701ca75f11871897c2">pa</a> &amp; (<a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a> -1))</div>
<div class="line">            <span class="keywordflow">goto</span> error;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Normal cacheable memory */</span></div>
<div class="line">    desc.<a class="code" href="structcpu__section.html#a4067484b965c309ab64925fcf46b101a">dom</a> = <a class="code" href="page__table_8h.html#a6d41982db6b7687e1eb4fa9ebc82bf1f">SECURE_ACCESS_DOMAIN</a>;</div>
<div class="line">    desc.ap = <a class="code" href="page__table_8h.html#afa0e571b65ad32bb40622aac6b21c69ea9fc7e6176561b72282db60fdc8c51f56">PRIV_RW_USR_NO</a>;</div>
<div class="line">    desc.xn = <a class="code" href="page__table_8h.html#a61a688cffbe7f6f1b8ddee7315ac1c2d">L1_EXECUTE_NEVER</a>;</div>
<div class="line">    <span class="comment">/* Outer and inner cache write back and write allocate */</span></div>
<div class="line">    desc.tex = 0x1; </div>
<div class="line">    desc.c = 0x1;</div>
<div class="line">    desc.b = 0x1;  </div>
<div class="line">    desc.ns = 1;</div>
<div class="line">    desc.ng = 1;</div>
<div class="line">    desc.s = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span>(size) {</div>
<div class="line">        desc.va =  <a class="code" href="structcpu__section.html#a985f81e41accb44872924ac29d008c70">va</a>;</div>
<div class="line">        desc.pa =  <a class="code" href="structcpu__section.html#a91a14277cea12c701ca75f11871897c2">pa</a>;</div>
<div class="line">        <span class="comment">/* Normal cacheable memory */</span></div>
<div class="line">        <a class="code" href="page__table_8h.html#adf1446683f2fb6788a64115a22de1bb6" title="Map the non-secure memory in secure page table for shared memory access.">map_ns_section_entry</a>(secure_page_table, &amp;desc);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="structcpu__section.html#a985f81e41accb44872924ac29d008c70">va</a> += <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">        <a class="code" href="structcpu__section.html#a91a14277cea12c701ca75f11871897c2">pa</a> += <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">        size -= <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">error:</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a01c4526037a56ce113dd0f572d4da222"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int map_section_entry </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *&#160;</td>
          <td class="paramname"><em>pgd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structcpu__section.html">cpu_section</a> *&#160;</td>
          <td class="paramname"><em>entry</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Create a section map entry. </p>
<p>This function creates section map entry in supplied page table</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pgd,:</td><td>Pointer to page table </td></tr>
    <tr><td class="paramname">entry,:</td><td>Pointer to section entry</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK <br/>
 OTZ_FAIL <br/>
 </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00530">530</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> l1_index = 0;</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *l1_pte;</div>
<div class="line"></div>
<div class="line">    l1_index = entry-&gt;<a class="code" href="structcpu__section.html#a985f81e41accb44872924ac29d008c70">va</a> &gt;&gt; 20;</div>
<div class="line">    l1_pte = pgd + l1_index;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span> ((*l1_pte) &amp; <a class="code" href="page__table_8h.html#ab75a945cf8991da4fc1e857dd82f7ffe">L1_TYPE_MASK</a>) {</div>
<div class="line">    <span class="keywordflow">case</span> (<a class="code" href="page__table_8h.html#a8031bfc0509f595afb1aca828da9da73">L1_TYPE_FAULT</a>):</div>
<div class="line">        *l1_pte = ( entry-&gt;<a class="code" href="structcpu__section.html#a91a14277cea12c701ca75f11871897c2">pa</a> &amp; <a class="code" href="page__table_8h.html#ae179c94865550ea9e56ce7a7b76597ab">SECTION_BASE_MASK</a>) | <a class="code" href="page__table_8h.html#a6bdf5c2f2b3a365693903118faf0aa4f">L1_TYPE_SECTION</a>;</div>
<div class="line">        *l1_pte |= (entry-&gt;<a class="code" href="structcpu__section.html#a4067484b965c309ab64925fcf46b101a">dom</a> &lt;&lt; <a class="code" href="page__table_8h.html#a4cecc2e604f0de4f4e948e65da156989">L1_DOMAIN_SHIFT</a>);</div>
<div class="line">        *l1_pte |= (entry-&gt;<a class="code" href="structcpu__section.html#ad50425e6161f78838bb7ea698e5dd348">b</a> &lt;&lt; <a class="code" href="page__table_8h.html#a65534f840b93fd8ef53f243d55b338fa">L1_SECTION_B_SHIFT</a>);</div>
<div class="line">        *l1_pte |= (entry-&gt;<a class="code" href="structcpu__section.html#a5039f7e8fa5e5c06eb27c746efe24716">c</a> &lt;&lt; <a class="code" href="page__table_8h.html#afba7944fb42cd342ceee6474e9f30fbe">L1_SECTION_C_SHIFT</a>);</div>
<div class="line">        *l1_pte |= (entry-&gt;<a class="code" href="structcpu__section.html#a8cd9e7242287b655973dff3f9542b95f">tex</a> &lt;&lt; <a class="code" href="page__table_8h.html#aca6a8ae44c608a01db1c8b26d89d1f9b">L1_SECTION_TEX_SHIFT</a>);</div>
<div class="line">        *l1_pte |= (entry-&gt;<a class="code" href="structcpu__section.html#a79096075798e2b9a895d3395784ff02b">xn</a> &lt;&lt; <a class="code" href="page__table_8h.html#ade3f5cbb65b4e707bafbf528f457929f">L1_SECTION_XN_SHIFT</a>);</div>
<div class="line">        *l1_pte |= ((entry-&gt;<a class="code" href="structcpu__section.html#a2842a077a6d8d757c42101cdf57a878e">ap</a> &amp; <a class="code" href="page__table_8h.html#a9004e401798facd312556bcf19774cf6">L1_SECTION_AP_MASK</a>) &lt;&lt; <a class="code" href="page__table_8h.html#a4747e2a6d990c581086b57c5812c2f88">L1_SECTION_AP_SHIFT</a>);</div>
<div class="line">        *l1_pte |= (((entry-&gt;<a class="code" href="structcpu__section.html#a2842a077a6d8d757c42101cdf57a878e">ap</a> &gt;&gt; 2) &amp; 0x1) &lt;&lt; <a class="code" href="page__table_8h.html#aee827d03962a9d09e481de3d7c483743">L1_SECTION_AP2_SHIFT</a>);</div>
<div class="line">        *l1_pte |= (entry-&gt;<a class="code" href="structcpu__section.html#ad4a3cfac3a42ea88f90484d0b85ff878">s</a> &lt;&lt; <a class="code" href="page__table_8h.html#ab7c37d70bf182d50ddbdb67bbc5c0895">L1_SECTION_S_SHIFT</a>);</div>
<div class="line">        *l1_pte |= (entry-&gt;<a class="code" href="structcpu__section.html#a1b3b2d519ed623ef59ed4de053dbe556">ng</a> &lt;&lt; <a class="code" href="page__table_8h.html#aa682d49b7e17c5fb7fb16477c1063533">L1_SECTION_NG_SHIFT</a>);</div>
<div class="line">        *l1_pte |= (entry-&gt;<a class="code" href="structcpu__section.html#a164e8a2c360da5efe40b930202e4f079">ns</a> &lt;&lt; <a class="code" href="page__table_8h.html#a7fe6dbb5bae47ae1909c763444492eb2">L1_SECTION_NS_SHIFT</a>);</div>
<div class="line"></div>
<div class="line"><span class="comment">/*              </span></div>
<div class="line"><span class="comment">                flush is not needed - page table is cacheable </span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">case</span> (<a class="code" href="page__table_8h.html#a6bdf5c2f2b3a365693903118faf0aa4f">L1_TYPE_SECTION</a>):</div>
<div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">        Change in flags need to be handled  </span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    <span class="keywordflow">default</span>:</div>
<div class="line">        <a class="code" href="sw__debug_8h.html#a2bcb9c9069995eea62c5a6a2b7a2ca52" title="Writes directly to device, with no permission check.">sw_printk</a>(<span class="stringliteral">&quot;SW: section_map_hva_to_hpa: This function supports &quot;</span></div>
<div class="line">                      <span class="stringliteral">&quot;only section mappings.\n&quot;</span>);</div>
<div class="line">        <a class="code" href="sw__debug_8h.html#a2bcb9c9069995eea62c5a6a2b7a2ca52" title="Writes directly to device, with no permission check.">sw_printk</a>(<span class="stringliteral">&quot;SW:   L1 descriptor: %08x\n&quot;</span>, *l1_pte);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a288b10ba6b3e5356af9961adf461f54f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int map_secure_memory </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>&#160;</td>
          <td class="paramname"><em>va</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>&#160;</td>
          <td class="paramname"><em>pa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td>
          <td class="paramname"><em>size</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td>
          <td class="paramname"><em>ptf</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Map a range of secure memory area. </p>
<p>This function assumes that the start address and size are section aligned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">va,:</td><td>virtual address </td></tr>
    <tr><td class="paramname">pa,:</td><td>physical address </td></tr>
    <tr><td class="paramname">flags,:</td><td>flags for access permission and exec</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK <br/>
 OTZ_FAIL <br/>
 </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00347">347</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structcpu__section.html" title="Section page table entry.">cpu_section</a> desc;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (size &amp; (<a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a> - 1)) </div>
<div class="line">            <span class="keywordflow">goto</span> error;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="structcpu__section.html#a985f81e41accb44872924ac29d008c70">va</a> &amp; (<a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a> - 1))</div>
<div class="line">            <span class="keywordflow">goto</span> error;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="structcpu__section.html#a91a14277cea12c701ca75f11871897c2">pa</a> &amp; (<a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a> -1))</div>
<div class="line">            <span class="keywordflow">goto</span> error;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    desc.<a class="code" href="structcpu__section.html#a4067484b965c309ab64925fcf46b101a">dom</a> = <a class="code" href="page__table_8h.html#a6d41982db6b7687e1eb4fa9ebc82bf1f">SECURE_ACCESS_DOMAIN</a>;</div>
<div class="line">    desc.ap = <a class="code" href="page__table_8h.html#a80a1537524d1e5445aea1291042ba7a8">ptf_to_ap</a>(ptf);</div>
<div class="line">    desc.xn = <a class="code" href="page__table_8h.html#a842ce18dd50a92386bb393cb19a93ecc">ptf_to_xn</a>(ptf);</div>
<div class="line">    <span class="comment">/* Default memory attributes:</span></div>
<div class="line"><span class="comment">     * - Outer and inner cache write back and write allocate</span></div>
<div class="line"><span class="comment">     * - Global </span></div>
<div class="line"><span class="comment">     * - sharable attribute based on the number of cores</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    desc.tex = 0x1; </div>
<div class="line">    desc.c = 0x1;</div>
<div class="line">    desc.b = 0x1;  </div>
<div class="line">    desc.ns = 0;</div>
<div class="line">    desc.ng = 0;</div>
<div class="line"><span class="preprocessor">#ifdef CONFIG_SW_MULTICORE</span></div>
<div class="line"><span class="preprocessor"></span>    desc.s = 1;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>    desc.s = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">while</span>(size) {</div>
<div class="line">        desc.va =  <a class="code" href="structcpu__section.html#a985f81e41accb44872924ac29d008c70">va</a>;</div>
<div class="line">        desc.pa =  <a class="code" href="structcpu__section.html#a91a14277cea12c701ca75f11871897c2">pa</a>;</div>
<div class="line">        <span class="comment">/* Normal cacheable memory */</span></div>
<div class="line">        <a class="code" href="page__table_8h.html#a01c4526037a56ce113dd0f572d4da222" title="Create a section map entry.">map_section_entry</a>(secure_page_table, &amp;desc);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="structcpu__section.html#a985f81e41accb44872924ac29d008c70">va</a> += <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">        <a class="code" href="structcpu__section.html#a91a14277cea12c701ca75f11871897c2">pa</a> += <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">        size -= <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">error:</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a369ffb695e9118ac6e4ee04ea25ac5e6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>* map_secure_page_table </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize page table entries. </p>
<p>This function creates the initial page table entries for secure kernel </p>
<dl class="section return"><dt>Returns</dt><dd>Pointer to the page table </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00066">66</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* clearing the page table */</span></div>
<div class="line">    <a class="code" href="sw__mem__functions_8h.html#a14af1b39b1154a36624740bad34b813f" title="memory set">sw_memset</a>(secure_page_table, 0, <a class="code" href="page__table_8h.html#a69931d7466d1cc09c4426186f4ca0e2c">PAGE_TABLE_SIZE</a>);</div>
<div class="line"></div>
<div class="line">    <a class="code" href="board_8c.html#a198a34d6c3144e9c653e805a80ed161d">board_map_secure_page_table</a>(secure_page_table);</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="cpu__data_8h.html#a28233586622a636716549a593fc597c4" title="Secure page table.">secure_page_table</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5fc63d641c4d938c6bcf4768203afffe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int map_to_ns </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>&#160;</td>
          <td class="paramname"><em>phy_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a> *&#160;</td>
          <td class="paramname"><em>va_addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wrapper function for __map_to_ns. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">phy_addr</td><td></td></tr>
    <tr><td class="paramname">va_addr</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00159">159</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"><span class="preprocessor">#ifdef CONFIG_KSPACE_PROTECTION</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="sw__syscall_8h.html#a52fa167d5b7b21f02f5b759de200e2a5" title="system call to map a address as non-secure entry">__asm_map_to_ns</a>(phy_addr,va_addr);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">return</span>  <a class="code" href="page__table_8h.html#aae72a51804a247c5ed3eae86aa01036a" title="Create shared memory mapping between secure and non-secure kernel.">__map_to_ns</a>(phy_addr,va_addr);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aa7920ee52ee57fc11fadc11928d92987"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int map_to_secure </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>&#160;</td>
          <td class="paramname"><em>phy_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>&#160;</td>
          <td class="paramname"><em>va_addr</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">phy_addr</td><td></td></tr>
    <tr><td class="paramname">va_addr</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00085">85</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structcpu__section.html" title="Section page table entry.">cpu_section</a> desc;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* Normal cacheable memory */</span></div>
<div class="line">    desc.<a class="code" href="structcpu__section.html#a985f81e41accb44872924ac29d008c70">va</a> =  va_addr;</div>
<div class="line">    desc.pa =  phy_addr;</div>
<div class="line">    desc.dom = <a class="code" href="page__table_8h.html#a6d41982db6b7687e1eb4fa9ebc82bf1f">SECURE_ACCESS_DOMAIN</a>;</div>
<div class="line">    desc.ap = <a class="code" href="page__table_8h.html#afa0e571b65ad32bb40622aac6b21c69eac6b6e95619e894fd2e2321e8541af548">PRIV_RW_USR_RW</a>;</div>
<div class="line">    desc.xn = <a class="code" href="page__table_8h.html#aa64bf56002504df2f7b324dca0fa3afb">L1_EXECUTE_ALLOW</a>;</div>
<div class="line">    <span class="comment">/* Outer and inner cache write back and write allocate */</span></div>
<div class="line">    desc.tex = 0x1; </div>
<div class="line">    desc.c = 0x1;</div>
<div class="line">    desc.b = 0x1;</div>
<div class="line">    desc.ns = 0;</div>
<div class="line">    desc.ng = 1;</div>
<div class="line"><span class="preprocessor">#ifdef CONFIG_SW_MULTICORE</span></div>
<div class="line"><span class="preprocessor"></span>    desc.s = 1;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>    desc.s = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="page__table_8h.html#a01c4526037a56ce113dd0f572d4da222" title="Create a section map entry.">map_section_entry</a>(secure_page_table, &amp;desc);</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a797a56ba15d55f0a14b0200afe0bce0e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int map_user_access_device </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>&#160;</td>
          <td class="paramname"><em>va</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>&#160;</td>
          <td class="paramname"><em>pa</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Map user access devices. </p>
<p>This function assumes that the start address and size are section aligned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">va,:</td><td>virtual address </td></tr>
    <tr><td class="paramname">pa,:</td><td>physical address  size: size</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK <br/>
 OTZ_FAIL <br/>
 </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00242">242</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">            <span class="keyword">struct </span><a class="code" href="structcpu__section.html" title="Section page table entry.">cpu_section</a> desc;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (size &amp; (<a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a> - 1))</div>
<div class="line">            <span class="keywordflow">goto</span> error;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="structcpu__section.html#a985f81e41accb44872924ac29d008c70">va</a> &amp; (<a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a> - 1))</div>
<div class="line">            <span class="keywordflow">goto</span> error;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="structcpu__section.html#a91a14277cea12c701ca75f11871897c2">pa</a> &amp; (<a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a> -1))</div>
<div class="line">            <span class="keywordflow">goto</span> error;</div>
<div class="line"></div>
<div class="line">    desc.<a class="code" href="structcpu__section.html#a4067484b965c309ab64925fcf46b101a">dom</a> = <a class="code" href="page__table_8h.html#a6d41982db6b7687e1eb4fa9ebc82bf1f">SECURE_ACCESS_DOMAIN</a>;</div>
<div class="line">    desc.ap = <a class="code" href="page__table_8h.html#afa0e571b65ad32bb40622aac6b21c69eac6b6e95619e894fd2e2321e8541af548">PRIV_RW_USR_RW</a>;</div>
<div class="line">    desc.xn = <a class="code" href="page__table_8h.html#a61a688cffbe7f6f1b8ddee7315ac1c2d">L1_EXECUTE_NEVER</a>;</div>
<div class="line">    <span class="comment">/* </span></div>
<div class="line"><span class="comment">     * Device </span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line">    desc.tex = 0x0; </div>
<div class="line">    desc.c = 0x0;</div>
<div class="line">    desc.b = 0x1;  </div>
<div class="line">    desc.ns = 0;</div>
<div class="line">    desc.ng = 0;</div>
<div class="line"><span class="preprocessor">#ifdef CONFIG_SW_MULTICORE</span></div>
<div class="line"><span class="preprocessor"></span>    desc.s = 1;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>    desc.s = 0;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">while</span>(size) {</div>
<div class="line">        desc.va =  <a class="code" href="structcpu__section.html#a985f81e41accb44872924ac29d008c70">va</a>;</div>
<div class="line">        desc.pa =  <a class="code" href="structcpu__section.html#a91a14277cea12c701ca75f11871897c2">pa</a>;</div>
<div class="line">        <a class="code" href="page__table_8h.html#a01c4526037a56ce113dd0f572d4da222" title="Create a section map entry.">map_section_entry</a>(secure_page_table, &amp;desc);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="structcpu__section.html#a985f81e41accb44872924ac29d008c70">va</a> += <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">        <a class="code" href="structcpu__section.html#a91a14277cea12c701ca75f11871897c2">pa</a> += <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">        size -= <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">error:</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a00c2b39775a853252276206ce439dc96"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int map_user_access_device_table </td>
          <td>(</td>
          <td class="paramtype">const struct <a class="el" href="structdevmap.html">devmap</a> *&#160;</td>
          <td class="paramname"><em>dt</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Map User Access device table. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">dt,:</td><td>pointer to array of device mappings Array has to terminated with zero.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK <br/>
 OTZ_FAIL <br/>
 </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00323">323</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">        <span class="keywordflow">while</span> (*(<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *)dt != 0) {</div>
<div class="line">                <a class="code" href="page__table_8c.html#a797a56ba15d55f0a14b0200afe0bce0e" title="Map user access devices.">map_user_access_device</a>(dt-&gt;<a class="code" href="structdevmap.html#a33baaf4e8f8dc3d565792546cec2caa8">dv_va</a>, dt-&gt;<a class="code" href="structdevmap.html#ad97a5ac7d381ceda0ee2e986351eb18b">dv_pa</a>, dt-&gt;<a class="code" href="structdevmap.html#a4c15e90d519b56483883c9999e58094b">dv_size</a>);</div>
<div class="line">                dt++;</div>
<div class="line"></div>
<div class="line">        };</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac473c912ec8117218d8d7b1462e42161"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int page_ref_add </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td>
          <td class="paramname"><em>l1_pte</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Increment page table reference of shared memory. </p>
<p>This function increment the reference count of mapped shared memory</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">l1_pte,:</td><td>Page table entry</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK <br/>
 OTZ_FAIL <br/>
 </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00761">761</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *l;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structsw__global.html" title="Global variables structure.">sw_global</a> *pglobal = &amp;<a class="code" href="global_8c.html#a2a711ca66f66e43369bd71b5d6533fbd" title="Global variable structure.">global_val</a>;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structsw__page__ref.html" title="Page table reference.">sw_page_ref</a> *page_ref = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    <span class="keywordtype">bool</span> found = <a class="code" href="sw__semaphores_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!list_empty(&amp;pglobal-&gt;<a class="code" href="structsw__global.html#a4316d507fa07ebf53cff75a5e54a05c0">page_ref_list</a>)) {</div>
<div class="line">        <a class="code" href="sw__list_8h.html#abeae4779f478cbb5e1d437e6853c77c5">list_for_each</a>(l, &amp;pglobal-&gt;<a class="code" href="structsw__global.html#a4316d507fa07ebf53cff75a5e54a05c0">page_ref_list</a>) {</div>
<div class="line">            page_ref = <a class="code" href="sw__list_8h.html#a26c976b7f654e70df318c1843e5094de">list_entry</a>(l, <span class="keyword">struct</span> <a class="code" href="structsw__page__ref.html" title="Page table reference.">sw_page_ref</a>, <a class="code" href="sw__buddy_8h.html#a97a56df9c26e733777ccbf0bcc1a1df2">head</a>);</div>
<div class="line">            <span class="keywordflow">if</span> (page_ref-&gt;<a class="code" href="structsw__page__ref.html#a253a9a3d9b24029d20dc267329645a8d">l1_pte</a> == <a class="code" href="structsw__page__ref.html#a253a9a3d9b24029d20dc267329645a8d">l1_pte</a>) {</div>
<div class="line">                found = <a class="code" href="sw__semaphores_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!found) {</div>
<div class="line">        page_ref = (<span class="keyword">struct </span><a class="code" href="structsw__page__ref.html" title="Page table reference.">sw_page_ref</a>*)<a class="code" href="sw__buddy_8h.html#ae6f063fadf564f51c72ac39a83d9b550">sw_malloc_private</a>(<a class="code" href="sw__buddy_8h.html#aec6635083e97f6d7929adfe2179dabdc">COMMON_HEAP_ID</a>,</div>
<div class="line">                                        <span class="keyword">sizeof</span>(<span class="keyword">struct</span> <a class="code" href="structsw__page__ref.html" title="Page table reference.">sw_page_ref</a>));</div>
<div class="line">        <span class="keywordflow">if</span>(!page_ref) {</div>
<div class="line">            <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: page reference allocation: malloc failed\n&quot;</span>);</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="sw__types_8h.html#ade5dde89d25481cc2f1ebe77a8d0d85b">OTZ_EFAIL</a>; </div>
<div class="line">        }</div>
<div class="line">        page_ref-&gt;<a class="code" href="structsw__page__ref.html#a253a9a3d9b24029d20dc267329645a8d">l1_pte</a> = <a class="code" href="structsw__page__ref.html#a253a9a3d9b24029d20dc267329645a8d">l1_pte</a>;</div>
<div class="line">        page_ref-&gt;<a class="code" href="structsw__page__ref.html#a62e30d0dbe3862a5322c18af51f356cb">ref_cnt</a> = 0;</div>
<div class="line">        list_add_tail(&amp;pglobal-&gt;<a class="code" href="structsw__global.html#a4316d507fa07ebf53cff75a5e54a05c0">page_ref_list</a>, &amp;page_ref-&gt;<a class="code" href="structsw__page__ref.html#a3aa04d467aea921d469aa0173b4ab0d9">head</a>);</div>
<div class="line">    } </div>
<div class="line"></div>
<div class="line">    page_ref-&gt;<a class="code" href="structsw__page__ref.html#a62e30d0dbe3862a5322c18af51f356cb">ref_cnt</a>++;</div>
<div class="line"><span class="preprocessor">#ifdef PAGETABLE_DBG</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: add refer count 0x%x and l1_pte 0x%x\n&quot;</span>, page_ref-&gt;<a class="code" href="structsw__page__ref.html#a62e30d0dbe3862a5322c18af51f356cb">ref_cnt</a>, page_ref-&gt;<a class="code" href="structsw__page__ref.html#a253a9a3d9b24029d20dc267329645a8d">l1_pte</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="sw__semaphores_8h.html#aad472a601abac5aab18d6afddeab7de5">OTZ_OK</a>;   </div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4d443c09278671e076978f7016269f52"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int page_ref_release </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td>
          <td class="paramname"><em>l1_pte</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Decrement page table reference of shared memory. </p>
<p>This function decrement the reference count of mapped shared memory</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">l1_pte,:</td><td>Page table entry</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK <br/>
 OTZ_FAIL <br/>
 </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00808">808</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{   </div>
<div class="line">    <span class="keywordtype">int</span> <a class="code" href="structsw__page__ref.html#a62e30d0dbe3862a5322c18af51f356cb">ref_cnt</a>;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *l;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structsw__global.html" title="Global variables structure.">sw_global</a> *pglobal = &amp;<a class="code" href="global_8c.html#a2a711ca66f66e43369bd71b5d6533fbd" title="Global variable structure.">global_val</a>;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structsw__page__ref.html" title="Page table reference.">sw_page_ref</a> *page_ref = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    <span class="keywordtype">bool</span> found = <a class="code" href="sw__semaphores_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!list_empty(&amp;pglobal-&gt;<a class="code" href="structsw__global.html#a4316d507fa07ebf53cff75a5e54a05c0">page_ref_list</a>)) {</div>
<div class="line">        <a class="code" href="sw__list_8h.html#abeae4779f478cbb5e1d437e6853c77c5">list_for_each</a>(l, &amp;pglobal-&gt;<a class="code" href="structsw__global.html#a4316d507fa07ebf53cff75a5e54a05c0">page_ref_list</a>) {</div>
<div class="line">            page_ref = <a class="code" href="sw__list_8h.html#a26c976b7f654e70df318c1843e5094de">list_entry</a>(l, <span class="keyword">struct</span> <a class="code" href="structsw__page__ref.html" title="Page table reference.">sw_page_ref</a>, <a class="code" href="sw__buddy_8h.html#a97a56df9c26e733777ccbf0bcc1a1df2">head</a>);</div>
<div class="line">            <span class="keywordflow">if</span> (page_ref-&gt;<a class="code" href="structsw__page__ref.html#a253a9a3d9b24029d20dc267329645a8d">l1_pte</a> == <a class="code" href="structsw__page__ref.html#a253a9a3d9b24029d20dc267329645a8d">l1_pte</a>) {</div>
<div class="line">                found = <a class="code" href="sw__semaphores_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!found) {</div>
<div class="line">        <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: no page reference found\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="sw__types_8h.html#ade5dde89d25481cc2f1ebe77a8d0d85b">OTZ_EFAIL</a>;</div>
<div class="line">    } </div>
<div class="line"></div>
<div class="line">    page_ref-&gt;<a class="code" href="structsw__page__ref.html#a62e30d0dbe3862a5322c18af51f356cb">ref_cnt</a>--;</div>
<div class="line"></div>
<div class="line">    ref_cnt = page_ref-&gt;<a class="code" href="structsw__page__ref.html#a62e30d0dbe3862a5322c18af51f356cb">ref_cnt</a>;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef PAGETABLE_DBG</span></div>
<div class="line"><span class="preprocessor"></span>    <a class="code" href="sw__debug_8h.html#a501cc8c07cf94dc1a6269c0d3ba5a234">sw_printf</a>(<span class="stringliteral">&quot;SW: refer count 0x%x and l1_pte 0x%x\n&quot;</span>, ref_cnt, page_ref-&gt;<a class="code" href="structsw__page__ref.html#a253a9a3d9b24029d20dc267329645a8d">l1_pte</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">if</span>(page_ref-&gt;<a class="code" href="structsw__page__ref.html#a62e30d0dbe3862a5322c18af51f356cb">ref_cnt</a> == 0)</div>
<div class="line">    {</div>
<div class="line">        list_del(&amp;page_ref-&gt;<a class="code" href="structsw__page__ref.html#a3aa04d467aea921d469aa0173b4ab0d9">head</a>);  </div>
<div class="line">        <a class="code" href="sw__buddy_8h.html#adf62b1f83e5f1afcdd6342ad9a747b76">sw_free_private</a>(<a class="code" href="sw__buddy_8h.html#aec6635083e97f6d7929adfe2179dabdc">COMMON_HEAP_ID</a>, page_ref);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="structsw__page__ref.html#a62e30d0dbe3862a5322c18af51f356cb">ref_cnt</a>;   </div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aca3f6249157b4ed2c5c62e862bde4eee"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int unmap_from_ns </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>&#160;</td>
          <td class="paramname"><em>va_addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Wrapper function for __unmap_from_ns. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">va_addr</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00740">740</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"><span class="preprocessor">#ifdef CONFIG_KSPACE_PROTECTION </span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="sw__syscall_8h.html#a50b19daba8b36b309929b76f28f47345" title="system call to Unmap a non-secure address">__asm_unmap_from_ns</a>(va_addr);</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">return</span> <a class="code" href="page__table_8h.html#afe9314a5cd1eff4bbce0c096042f6a54" title="Unmap the non-secure memory from secure page table.">__unmap_from_ns</a>(va_addr);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aaadf422c3b31b06810ae0bdbda0f7835"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int unmap_from_secure </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>&#160;</td>
          <td class="paramname"><em>va_addr</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">va_addr</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00708">708</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret_val;</div>
<div class="line">    ret_val = <a class="code" href="page__table_8c.html#a1269bd6c7673bcbb9217d118ea8347f0">unmap_section_entry</a>((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>*)secure_page_table, va_addr);</div>
<div class="line">    <span class="keywordflow">return</span> ret_val;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aea2bcbf5befeee89453e7233f8b8f199"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int unmap_ns_section_entry </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *&#160;</td>
          <td class="paramname"><em>pgd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>&#160;</td>
          <td class="paramname"><em>va</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unmap the shared section entry from secure page table. </p>
<p>This function unmaps the secure memory section from secure page table. i.e. set 'NS' bit to zero</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pgd,:</td><td>Pointer to page table </td></tr>
    <tr><td class="paramname">va,:</td><td>Virtual address to be unmapped</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK <br/>
 </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00674">674</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> l1_index = 0;</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *<a class="code" href="structsw__page__ref.html#a253a9a3d9b24029d20dc267329645a8d">l1_pte</a>;</div>
<div class="line"></div>
<div class="line">    l1_index = va &gt;&gt; 20;</div>
<div class="line">    l1_pte = pgd + l1_index;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span> ((*l1_pte) &amp; <a class="code" href="page__table_8h.html#ab75a945cf8991da4fc1e857dd82f7ffe">L1_TYPE_MASK</a>) {</div>
<div class="line">        <span class="keywordflow">case</span> (<a class="code" href="page__table_8h.html#a8031bfc0509f595afb1aca828da9da73">L1_TYPE_FAULT</a>):</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> (<a class="code" href="page__table_8h.html#a6bdf5c2f2b3a365693903118faf0aa4f">L1_TYPE_SECTION</a>):</div>
<div class="line">            <span class="keywordflow">if</span>(<a class="code" href="page__table_8h.html#a4d443c09278671e076978f7016269f52" title="Decrement page table reference of shared memory.">page_ref_release</a>((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)l1_pte) == 0) {</div>
<div class="line">                <span class="keywordflow">if</span>((*l1_pte &amp; <a class="code" href="page__table_8h.html#a62d8835466996d145a9dea85b3ae0b6d">L1_SECTION_NS_IDX_MASK</a>)) {</div>
<div class="line">                      *l1_pte = 0;</div>
<div class="line"><span class="comment">/*              </span></div>
<div class="line"><span class="comment">                flush is not needed - page table is cacheable </span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af0ce58eed026b6e0bba73b9617c09b8d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int unmap_nsmemsect_normal </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>&#160;</td>
          <td class="paramname"><em>va</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unmap a range of non secure memory area. </p>
<p>This function assumes that the start address and size are section aligned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">va,:</td><td>virtual address </td></tr>
    <tr><td class="paramname">size,:</td><td>size</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK <br/>
 OTZ_FAIL <br/>
 </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00499">499</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (size &amp; (<a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a> - 1))</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (va &amp; (<a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a> - 1))</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">while</span>(size) {</div>
<div class="line">        <span class="comment">/* Normal cacheable memory */</span></div>
<div class="line">        <a class="code" href="page__table_8h.html#aea2bcbf5befeee89453e7233f8b8f199" title="Unmap the shared section entry from secure page table.">unmap_ns_section_entry</a>(secure_page_table, va);</div>
<div class="line"></div>
<div class="line">        va += <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">        size -= <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1269bd6c7673bcbb9217d118ea8347f0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int unmap_section_entry </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *&#160;</td>
          <td class="paramname"><em>pgd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>&#160;</td>
          <td class="paramname"><em>va</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pgd</td><td></td></tr>
    <tr><td class="paramname">va</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00638">638</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> l1_index = 0;</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>* <a class="code" href="structsw__page__ref.html#a253a9a3d9b24029d20dc267329645a8d">l1_pte</a>;</div>
<div class="line"></div>
<div class="line">    l1_index = va &gt;&gt; 20;</div>
<div class="line"></div>
<div class="line">    l1_pte = pgd + l1_index;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">switch</span>((*l1_pte) &amp; <a class="code" href="page__table_8h.html#ab75a945cf8991da4fc1e857dd82f7ffe">L1_TYPE_MASK</a>) {</div>
<div class="line">        <span class="keywordflow">case</span> (<a class="code" href="page__table_8h.html#a8031bfc0509f595afb1aca828da9da73">L1_TYPE_FAULT</a>):</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> (<a class="code" href="page__table_8h.html#a6bdf5c2f2b3a365693903118faf0aa4f">L1_TYPE_SECTION</a>):</div>
<div class="line">            *l1_pte = 0;</div>
<div class="line"><span class="comment">/*              </span></div>
<div class="line"><span class="comment">                flush is not needed - page table is cacheable </span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">default</span> :</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a052242469f722badd350a69d03e9e88a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int unmap_secure_memory </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a8a8f44dda695920b3f7210c1c28ff23b">va_t</a>&#160;</td>
          <td class="paramname"><em>va</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Unmap a range of secure memory area. </p>
<p>This function assumes that the start address and size are section aligned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">va,:</td><td>virtual address </td></tr>
    <tr><td class="paramname">size,:</td><td>size</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>otz_return_t: OTZ_OK <br/>
 OTZ_FAIL <br/>
 </dd></dl>

<p>Definition at line <a class="el" href="page__table_8c_source.html#l00410">410</a> of file <a class="el" href="page__table_8c_source.html">page_table.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (size &amp; (<a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a> - 1))</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (va &amp; (<a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a> - 1))</div>
<div class="line">            <span class="keywordflow">return</span> -1;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">while</span>(size) {</div>
<div class="line">        <a class="code" href="page__table_8c.html#a1269bd6c7673bcbb9217d118ea8347f0">unmap_section_entry</a>(secure_page_table, va);</div>
<div class="line">        va += <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">        size -= <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jan 3 2013 00:33:53 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
