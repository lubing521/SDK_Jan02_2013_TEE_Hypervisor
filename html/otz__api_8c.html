<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>otz_api.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0928947d66969185029197c0c35a3cff.html">otz_api</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">otz_api.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="stdlib_8h_source.html">stdlib.h</a>&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;errno.h&gt;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;sys/stat.h&gt;</code><br/>
<code>#include &lt;sys/ioctl.h&gt;</code><br/>
<code>#include &lt;sys/mman.h&gt;</code><br/>
<code>#include &lt;fcntl.h&gt;</code><br/>
<code>#include &lt;<a class="el" href="otz__api_8h_source.html">otz_api.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="otz__client_8h_source.html">otz_client.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="otz__id_8h_source.html">otz_id.h</a>&gt;</code><br/>
</div>
<p><a href="otz__api_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a29270e916339ced6667bc280ce48aa31"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a29270e916339ced6667bc280ce48aa31">otz_device_open</a> (void const *pk_device_name, void const *pk_init, <a class="el" href="structotz__device__t.html">otz_device_t</a> *ps_device)</td></tr>
<tr class="memdesc:a29270e916339ced6667bc280ce48aa31"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open the device.  <a href="#a29270e916339ced6667bc280ce48aa31"></a><br/></td></tr>
<tr class="separator:a29270e916339ced6667bc280ce48aa31"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a55d0b5b18114d5553e2546c50ab3b0b5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a55d0b5b18114d5553e2546c50ab3b0b5">otz_device_get_timelimit</a> (<a class="el" href="structotz__device__t.html">otz_device_t</a> *ps_device, <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> ui_timeout, <a class="el" href="structotz__timelimit__t.html">otz_timelimit_t</a> *ps_timelimit)</td></tr>
<tr class="memdesc:a55d0b5b18114d5553e2546c50ab3b0b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get local time limit.  <a href="#a55d0b5b18114d5553e2546c50ab3b0b5"></a><br/></td></tr>
<tr class="separator:a55d0b5b18114d5553e2546c50ab3b0b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe75dee12e5e7d00489297ce482b9f74"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#afe75dee12e5e7d00489297ce482b9f74">otz_operation_prepare_open</a> (<a class="el" href="structotz__device__t.html">otz_device_t</a> *ps_device, int pks_service, <a class="el" href="structotz__login__t.html">otz_login_t</a> const *pks_login, <a class="el" href="structotz__timelimit__t.html">otz_timelimit_t</a> const *pks_timelimit, <a class="el" href="structotz__session__t.html">otz_session_t</a> *ps_session, <a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation)</td></tr>
<tr class="memdesc:afe75dee12e5e7d00489297ce482b9f74"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare open operation.  <a href="#afe75dee12e5e7d00489297ce482b9f74"></a><br/></td></tr>
<tr class="separator:afe75dee12e5e7d00489297ce482b9f74"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9b0f5735d0aa17639a7ce957ecb5867f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a9b0f5735d0aa17639a7ce957ecb5867f">otz_operation_prepare_invoke</a> (<a class="el" href="structotz__session__t.html">otz_session_t</a> *ps_session, <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> ui_command, <a class="el" href="structotz__timelimit__t.html">otz_timelimit_t</a> const *pks_timelimit, <a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation)</td></tr>
<tr class="memdesc:a9b0f5735d0aa17639a7ce957ecb5867f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare operation for service request.  <a href="#a9b0f5735d0aa17639a7ce957ecb5867f"></a><br/></td></tr>
<tr class="separator:a9b0f5735d0aa17639a7ce957ecb5867f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56d72206cc55e912e8ce188fbe632c8a"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a56d72206cc55e912e8ce188fbe632c8a">otz_operation_prepare_close</a> (<a class="el" href="structotz__session__t.html">otz_session_t</a> *ps_session, <a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation)</td></tr>
<tr class="memdesc:a56d72206cc55e912e8ce188fbe632c8a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare the operation for close session.  <a href="#a56d72206cc55e912e8ce188fbe632c8a"></a><br/></td></tr>
<tr class="separator:a56d72206cc55e912e8ce188fbe632c8a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0d31dcaad228c53c2fb4094329111944"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a0d31dcaad228c53c2fb4094329111944">otz_operation_perform</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation, <a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> *pui_service_return)</td></tr>
<tr class="memdesc:a0d31dcaad228c53c2fb4094329111944"><td class="mdescLeft">&#160;</td><td class="mdescRight">Performs the previously prepared operation.  <a href="#a0d31dcaad228c53c2fb4094329111944"></a><br/></td></tr>
<tr class="separator:a0d31dcaad228c53c2fb4094329111944"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5e03210f006d016a07b0a27cbae0f5f7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a5e03210f006d016a07b0a27cbae0f5f7">otz_free_temp_shared_mem</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation)</td></tr>
<tr class="separator:a5e03210f006d016a07b0a27cbae0f5f7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7cca7c131a9236ee08c26ad743d2eec1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a7cca7c131a9236ee08c26ad743d2eec1">otz_operation_release</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation)</td></tr>
<tr class="memdesc:a7cca7c131a9236ee08c26ad743d2eec1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Release operation.  <a href="#a7cca7c131a9236ee08c26ad743d2eec1"></a><br/></td></tr>
<tr class="separator:a7cca7c131a9236ee08c26ad743d2eec1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adeb1c8c350ebefd309f503726a2b8e41"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#adeb1c8c350ebefd309f503726a2b8e41">otz_operation_cancel</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation)</td></tr>
<tr class="separator:adeb1c8c350ebefd309f503726a2b8e41"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a803f85d1b6da9a5ec167bb0f5450a0e4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a803f85d1b6da9a5ec167bb0f5450a0e4">otz_shared_memory_allocate</a> (<a class="el" href="structotz__session__t.html">otz_session_t</a> *ps_session, <a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a> *ps_shared_mem)</td></tr>
<tr class="memdesc:a803f85d1b6da9a5ec167bb0f5450a0e4"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function allocates a block of memory, defined by the structure pointed to by ps_shared_mem, which is shared between the client and the service it is connected to.  <a href="#a803f85d1b6da9a5ec167bb0f5450a0e4"></a><br/></td></tr>
<tr class="separator:a803f85d1b6da9a5ec167bb0f5450a0e4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a440cd98e3b951c796e15f29c51baac60"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a440cd98e3b951c796e15f29c51baac60">otz_shared_memory_register</a> (<a class="el" href="structotz__session__t.html">otz_session_t</a> *ps_session, <a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a> *ps_shared_mem)</td></tr>
<tr class="separator:a440cd98e3b951c796e15f29c51baac60"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45aca9f87329cb21e0e9517099dcfc0d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a45aca9f87329cb21e0e9517099dcfc0d">otz_shared_memory_release</a> (<a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a> *ps_shared_mem)</td></tr>
<tr class="memdesc:a45aca9f87329cb21e0e9517099dcfc0d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function allocates a block of memory, defined by the structure pointed to by ps_shared_mem, which is shared between the client and the service it is connected to. This function marks a block of shared memory associated with a session as no longer shared.  <a href="#a45aca9f87329cb21e0e9517099dcfc0d"></a><br/></td></tr>
<tr class="separator:a45aca9f87329cb21e0e9517099dcfc0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afaa5ecb61e5d492cf6da006dffd3bb2d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#afaa5ecb61e5d492cf6da006dffd3bb2d">otz_device_close</a> (<a class="el" href="structotz__device__t.html">otz_device_t</a> *ps_device)</td></tr>
<tr class="memdesc:afaa5ecb61e5d492cf6da006dffd3bb2d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Close the device connection.  <a href="#afaa5ecb61e5d492cf6da006dffd3bb2d"></a><br/></td></tr>
<tr class="separator:afaa5ecb61e5d492cf6da006dffd3bb2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5067283c78c6e22d4e4da117ec943f81"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a5067283c78c6e22d4e4da117ec943f81">otz_encode_uint32</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation, void const *<a class="el" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a>, int param_type)</td></tr>
<tr class="memdesc:a5067283c78c6e22d4e4da117ec943f81"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encode unsigned 32-bit integer.  <a href="#a5067283c78c6e22d4e4da117ec943f81"></a><br/></td></tr>
<tr class="separator:a5067283c78c6e22d4e4da117ec943f81"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92380414c091abe1de0b23d63f426bcf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a92380414c091abe1de0b23d63f426bcf">otz_encode_array</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation, void const *pk_array, <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> length, int param_type)</td></tr>
<tr class="memdesc:a92380414c091abe1de0b23d63f426bcf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encode binary array to the encoded message.  <a href="#a92380414c091abe1de0b23d63f426bcf"></a><br/></td></tr>
<tr class="separator:a92380414c091abe1de0b23d63f426bcf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74f4f32cc597cb04c352f0faaf353259"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a74f4f32cc597cb04c352f0faaf353259">otz_encode_array_space</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation, <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> length, int param_type)</td></tr>
<tr class="memdesc:a74f4f32cc597cb04c352f0faaf353259"><td class="mdescLeft">&#160;</td><td class="mdescRight">Encode empty binary array to the encoded message.  <a href="#a74f4f32cc597cb04c352f0faaf353259"></a><br/></td></tr>
<tr class="separator:a74f4f32cc597cb04c352f0faaf353259"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4663159507afcef1df21e7b29bbb1c6c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a4663159507afcef1df21e7b29bbb1c6c">otz_encode_memory_reference</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation, <a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a> *ps_shared_mem, <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> offset, <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> length, <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> flags, int param_type)</td></tr>
<tr class="memdesc:a4663159507afcef1df21e7b29bbb1c6c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Appends a reference of previously allocated shared block to the encoded buffer.  <a href="#a4663159507afcef1df21e7b29bbb1c6c"></a><br/></td></tr>
<tr class="separator:a4663159507afcef1df21e7b29bbb1c6c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac73c45b1f13368b895d888b1af02b122"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#ac73c45b1f13368b895d888b1af02b122">otz_decode_uint32</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation)</td></tr>
<tr class="memdesc:ac73c45b1f13368b895d888b1af02b122"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decode a unsigned 32-bit integer value from message.  <a href="#ac73c45b1f13368b895d888b1af02b122"></a><br/></td></tr>
<tr class="separator:ac73c45b1f13368b895d888b1af02b122"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a06653a27f5781a86e489d33952f598cf"><td class="memItemLeft" align="right" valign="top">void *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a06653a27f5781a86e489d33952f598cf">otz_decode_array_space</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation, <a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> *plength)</td></tr>
<tr class="memdesc:a06653a27f5781a86e489d33952f598cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Decode a block of binary data from the message.  <a href="#a06653a27f5781a86e489d33952f598cf"></a><br/></td></tr>
<tr class="separator:a06653a27f5781a86e489d33952f598cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59d3ca17d318082f1fb5ea24b3e8698f"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a59d3ca17d318082f1fb5ea24b3e8698f">otz_decode_get_type</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation)</td></tr>
<tr class="memdesc:a59d3ca17d318082f1fb5ea24b3e8698f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the decoder stream data type.  <a href="#a59d3ca17d318082f1fb5ea24b3e8698f"></a><br/></td></tr>
<tr class="separator:a59d3ca17d318082f1fb5ea24b3e8698f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a54fb04a14c11e1a4ce77c828eb232379"><td class="memItemLeft" align="right" valign="top"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="otz__api_8c.html#a54fb04a14c11e1a4ce77c828eb232379">otz_decode_get_error</a> (<a class="el" href="structotz__operation__t.html">otz_operation_t</a> *ps_operation)</td></tr>
<tr class="memdesc:a54fb04a14c11e1a4ce77c828eb232379"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get decode error.  <a href="#a54fb04a14c11e1a4ce77c828eb232379"></a><br/></td></tr>
<tr class="separator:a54fb04a14c11e1a4ce77c828eb232379"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a06653a27f5781a86e489d33952f598cf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* otz_decode_array_space </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> *&#160;</td>
          <td class="paramname"><em>plength</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Decode a block of binary data from the message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
    <tr><td class="paramname">plength</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l01192">1192</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(otz_check_decode(ps_operation)) {</div>
<div class="line">        *plength = 0;</div>
<div class="line">        <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.encode_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line"></div>
<div class="line">    ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                    <a class="code" href="otz__client_8h.html#a85758d78a3f7a7d60fd05b5561ca7e66">OTZ_CLIENT_IOCTL_DEC_ARRAY_SPACE</a>, &amp;<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (ret)</div>
<div class="line">    {</div>
<div class="line">        *plength = 0;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ae3ac49dcf8f3ce9b92e2f3c7004b94d2">dec_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9af6511e3f523080e2690708d86c6f73b6">OTZ_ERROR_DECODE_NO_DATA</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    *plength = <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.len;</div>
<div class="line">return_func:    </div>
<div class="line">    <span class="keywordflow">return</span> (<span class="keywordtype">void</span>*)<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data;</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a54fb04a14c11e1a4ce77c828eb232379"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_decode_get_error </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get decode error. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l01277">1277</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span>  ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ae3ac49dcf8f3ce9b92e2f3c7004b94d2">dec_error_state</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a59d3ca17d318082f1fb5ea24b3e8698f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> otz_decode_get_type </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the decoder stream data type. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l01232">1232</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> type = <a class="code" href="otz__api_8h.html#a543151d0e3457a37a15b96ab02e4418daee4efd202332a908cb06565feedb5b59">OTZ_TYPE_NONE</a>, ret;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(!ps_operation)</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span> (ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> != <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a">OTZ_STATE_DECODE</a>) </div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ae3ac49dcf8f3ce9b92e2f3c7004b94d2">dec_error_state</a> != <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>)</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.encode_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line"></div>
<div class="line">    ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                    <a class="code" href="otz__client_8h.html#adc6a7391c4371e38b98d0426c03f1ce3">OTZ_CLIENT_IOCTL_GET_DECODE_TYPE</a>, &amp;<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (ret)</div>
<div class="line">    {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>((<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data == <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beacafbe80d88442cff08f386a74daf8bb9c8">OTZ_ENC_UINT32</a>)</div>
<div class="line">        type = <a class="code" href="otz__api_8h.html#a543151d0e3457a37a15b96ab02e4418dacb08736841422c177ff05b448b3f27ca">OTZ_TYPE_UINT32</a>;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(((<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data == <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca5ecfa72c778a2f9613acbfe530866856">OTZ_ENC_ARRAY</a>) || </div>
<div class="line">            ((<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data == <a class="code" href="otz__id_8h.html#a3d6ef0f9d032e84e0b1cb1d4abc9beaca12d03340e4613f9875953e9a2ea969f5">OTZ_MEM_REF</a>))</div>
<div class="line">        type = <a class="code" href="otz__api_8h.html#a543151d0e3457a37a15b96ab02e4418dadab265691fd16eba9ef0938d35fc2d20">OTZ_TYPE_ARRAY</a>;        </div>
<div class="line"></div>
<div class="line"></div>
<div class="line">return_func:    </div>
<div class="line">    <span class="keywordflow">return</span> type;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac73c45b1f13368b895d888b1af02b122"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a> otz_decode_uint32 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Decode a unsigned 32-bit integer value from message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l01155">1155</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(otz_check_decode(ps_operation)) {</div>
<div class="line">       *((<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>*)<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data) = 0;</div>
<div class="line">       <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.encode_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line">    <a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.len  = <span class="keyword">sizeof</span>(<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>);</div>
<div class="line"></div>
<div class="line">    ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                    <a class="code" href="otz__client_8h.html#a3a906c6822ed16423cf394d12c4eee26">OTZ_CLIENT_IOCTL_DEC_UINT32</a>, &amp;<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (ret) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ae3ac49dcf8f3ce9b92e2f3c7004b94d2">dec_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9af6511e3f523080e2690708d86c6f73b6">OTZ_ERROR_DECODE_NO_DATA</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">       *((<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>*)<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data) = 0;</div>
<div class="line">       <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line">return_func:</div>
<div class="line">    <span class="keywordflow">return</span> *((<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>*)<a class="code" href="func2_8c.html#a16a8dd70c4a5d119b49b8c78d931d7b8" title="Sample application to show the implementation of Global Platform Client API specification.">dec</a>.data);</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afaa5ecb61e5d492cf6da006dffd3bb2d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_device_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__device__t.html">otz_device_t</a> *&#160;</td>
          <td class="paramname"><em>ps_device</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Close the device connection. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_device</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00763">763</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(!ps_device)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;d_close \n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">if</span> (ps_device-&gt;<a class="code" href="structotz__device__t.html#a183baef0c51d87da02961ea0abc591fe">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>)</div>
<div class="line">    {</div>
<div class="line">        ps_device-&gt;<a class="code" href="structotz__device__t.html#a183baef0c51d87da02961ea0abc591fe">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9">OTZ_STATE_UNDEFINED</a>;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ps_device-&gt;<a class="code" href="structotz__device__t.html#a183baef0c51d87da02961ea0abc591fe">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(ps_device-&gt;<a class="code" href="structotz__device__t.html#ad2a9008616d4b2f37a5eef14c8ebaa34">session_count</a> == 0)</div>
<div class="line">        {</div>
<div class="line">            printf(<span class="stringliteral">&quot;device closed \n&quot;</span>);</div>
<div class="line">            <a class="code" href="virtual__keyboard__app_8c.html#ae8a3b46baffb627f3917b08c4b84c49d">close</a>(ps_device-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>);</div>
<div class="line">            ps_device-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a> = 0;</div>
<div class="line">            ps_device-&gt;<a class="code" href="structotz__device__t.html#a183baef0c51d87da02961ea0abc591fe">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9">OTZ_STATE_UNDEFINED</a>;</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ps_device-&gt;<a class="code" href="structotz__device__t.html#ad2a9008616d4b2f37a5eef14c8ebaa34">session_count</a> != 0){</div>
<div class="line">            printf(<span class="stringliteral">&quot;warning: pending open sessions %d\n&quot;</span>, </div>
<div class="line">                        ps_device-&gt;<a class="code" href="structotz__device__t.html#ad2a9008616d4b2f37a5eef14c8ebaa34">session_count</a>);</div>
<div class="line">            ps_device-&gt;<a class="code" href="structotz__device__t.html#a49b91b73a55549b4e3ffebb22d011287">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a17a59e90aad673eacadb8490283f5499">OTZ_ERROR_ILLEGAL_STATE</a>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a323328909603b4a09891fb854cd15c5c">OTZ_ERROR_UNDEFINED</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a55d0b5b18114d5553e2546c50ab3b0b5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_device_get_timelimit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__device__t.html">otz_device_t</a> *&#160;</td>
          <td class="paramname"><em>ps_device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>ui_timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__timelimit__t.html">otz_timelimit_t</a> *&#160;</td>
          <td class="paramname"><em>ps_timelimit</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Get local time limit. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_device</td><td></td></tr>
    <tr><td class="paramname">ui_timeout</td><td></td></tr>
    <tr><td class="paramname">ps_timelimit</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00101">101</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a0669e32ad6657b360501a030dc12d4db">OTZ_ERROR_NOT_IMPLEMENTED</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a29270e916339ced6667bc280ce48aa31"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_device_open </td>
          <td>(</td>
          <td class="paramtype">void const *&#160;</td>
          <td class="paramname"><em>pk_device_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void const *&#160;</td>
          <td class="paramname"><em>pk_init</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__device__t.html">otz_device_t</a> *&#160;</td>
          <td class="paramname"><em>ps_device</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Open the device. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pk_device_name</td><td></td></tr>
    <tr><td class="paramname">pk_init</td><td></td></tr>
    <tr><td class="paramname">ps_device</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00051">51</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret=0;</div>
<div class="line">    <span class="keywordflow">if</span>(ps_device == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line">    {</div>
<div class="line">        printf(<span class="stringliteral">&quot;tz_device_open : Device is null\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(pk_device_name == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;/dev/otz_client is assigned as default device\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        pk_device_name = <span class="stringliteral">&quot;/dev/otz_client&quot;</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(pk_init == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;Device is opened as Read-only by default\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        pk_init = O_RDONLY;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ret = open(pk_device_name, (<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)pk_init); </div>
<div class="line">    <span class="keywordflow">if</span>( ret == -1){</div>
<div class="line">        ps_device-&gt;<a class="code" href="structotz__device__t.html#a183baef0c51d87da02961ea0abc591fe">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;</div>
<div class="line">        ps_device-&gt;<a class="code" href="structotz__device__t.html#a49b91b73a55549b4e3ffebb22d011287">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a011416e65f00b25a21592c87267eb9bd">OTZ_ERROR_GENERIC</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span>{</div>
<div class="line">        ps_device-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a> = ret ;</div>
<div class="line">        ps_device-&gt;<a class="code" href="structotz__device__t.html#a183baef0c51d87da02961ea0abc591fe">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a>;</div>
<div class="line">        ps_device-&gt;<a class="code" href="structotz__device__t.html#ad2a9008616d4b2f37a5eef14c8ebaa34">session_count</a> = 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a92380414c091abe1de0b23d63f426bcf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void otz_encode_array </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void const *&#160;</td>
          <td class="paramname"><em>pk_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>param_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encode binary array to the encoded message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
    <tr><td class="paramname">pk_array</td><td></td></tr>
    <tr><td class="paramname">length</td><td></td></tr>
    <tr><td class="paramname">param_type</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00869">869</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> enc;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(check_encode(ps_operation))</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">if</span>(<a class="code" href="structotz__client__encode__cmd.html#af88abf923e07a4c493758d604921b6bd">param_type</a> == <a class="code" href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ffa5c86bb59cf47117648ab204158c8b2f9">OTZ_PARAM_OUT</a>) {</div>
<div class="line">    perror(<span class="stringliteral">&quot;use encode array space for out buffer\n&quot;</span>);</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    enc.encode_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">    enc.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">    enc.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">    enc.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line"></div>
<div class="line">    enc.data = (<span class="keywordtype">void</span>*)pk_array;</div>
<div class="line">    enc.len  = length;</div>
<div class="line">    enc.param_type = <a class="code" href="structotz__client__encode__cmd.html#af88abf923e07a4c493758d604921b6bd">param_type</a>;</div>
<div class="line"></div>
<div class="line">    ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                    <a class="code" href="otz__client_8h.html#a5191da7defc442a4fd60f2db6127313a">OTZ_CLIENT_IOCTL_ENC_ARRAY</a>, &amp;enc);</div>
<div class="line">    <span class="keywordflow">if</span> (ret) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a> = enc.encode_id;</div>
<div class="line">    }</div>
<div class="line">     </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a74f4f32cc597cb04c352f0faaf353259"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void* otz_encode_array_space </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>param_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encode empty binary array to the encoded message. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
    <tr><td class="paramname">length</td><td></td></tr>
    <tr><td class="paramname">param_type</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00917">917</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> enc;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__session__shared__mem__info.html" title="Shared memory information for the session.">otz_session_shared_mem_info</a> mem_info;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordtype">int</span> ret = 0, mmap_flags;</div>
<div class="line"></div>
<div class="line">    enc.data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(check_encode(ps_operation))</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a> &gt;= <a class="code" href="otz__api_8h.html#a12bcf1760a725c67f750d606944ae8ca">MAX_MEMBLOCKS_PER_OPERATION</a>) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> =  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    enc.encode_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">    enc.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">    enc.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">    enc.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line"></div>
<div class="line">    mmap_flags = PROT_READ | PROT_WRITE;</div>
<div class="line"></div>
<div class="line">    enc.data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    enc.data = mmap(0, length, mmap_flags , MAP_SHARED,</div>
<div class="line">                    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, 0);    </div>
<div class="line">    <span class="keywordflow">if</span>(enc.data != MAP_FAILED) {</div>
<div class="line">        mem_info.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a>;</div>
<div class="line">        mem_info.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a>;</div>
<div class="line">        mem_info.user_mem_addr = (<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)enc.data;</div>
<div class="line">        ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                <a class="code" href="otz__client_8h.html#aec1c031dce90c397aa85665e1e9ca9a3">OTZ_CLIENT_IOCTL_SHR_MEM_ALLOCATE_REQ</a>, &amp;mem_info);</div>
<div class="line">        <span class="keywordflow">if</span>(ret == -1) {</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">            <span class="keywordflow">goto</span> free_map_data;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        perror(<span class="stringliteral">&quot;memory_allocate - mmap failed\n&quot;</span>); </div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        enc.data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> =  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;        </div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    enc.len  = length;</div>
<div class="line">    enc.param_type = param_type;</div>
<div class="line">    enc.offset = 0;</div>
<div class="line">    enc.flags = <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a33f6f503a1e274dc317a34352157100c">OTZ_MEM_SERVICE_RW</a>;</div>
<div class="line"></div>
<div class="line">    ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                   <a class="code" href="otz__client_8h.html#a6daae0061fa52b147dfefc290f63a319">OTZ_CLIENT_IOCTL_ENC_ARRAY_SPACE</a>, &amp;enc);</div>
<div class="line">    <span class="keywordflow">if</span> (ret) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> free_map_data;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a> = enc.encode_id;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a81a4ced50943d64ef286314650814aa3">temp_mem</a>[ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a>].<a class="code" href="structotz__mem__reference.html#a39df1ac5f9057a74513b315c8359e9b4">shared_mem</a> </div>
<div class="line">                                                        = enc.data;</div>
<div class="line"></div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a81a4ced50943d64ef286314650814aa3">temp_mem</a>[ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a>].<a class="code" href="structotz__mem__reference.html#ac84a349830e146ab101bb365437f0e41">offset</a> </div>
<div class="line">                                                                    = 0;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a81a4ced50943d64ef286314650814aa3">temp_mem</a>[ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a>].<a class="code" href="structotz__mem__reference.html#ada48b7ba047eb0b21e2ea9fe81418482">length</a> </div>
<div class="line">                                                                    = length;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a81a4ced50943d64ef286314650814aa3">temp_mem</a>[ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a>].<a class="code" href="structotz__mem__reference.html#abded90096f65a46b8e151aebc39571bf">param_type</a> </div>
<div class="line">                                                                   = param_type;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a>++;        </div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> enc.data;</div>
<div class="line">  </div>
<div class="line">free_map_data:</div>
<div class="line">    mem_info.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a>;</div>
<div class="line">    mem_info.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a>;</div>
<div class="line">    mem_info.user_mem_addr = (<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)enc.data;</div>
<div class="line">    munmap(enc.data, length);</div>
<div class="line">    ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>,</div>
<div class="line">            <a class="code" href="otz__client_8h.html#acc330cddd9c28f9ee43644552166878d">OTZ_CLIENT_IOCTL_SHR_MEM_FREE_REQ</a>, &amp;mem_info);</div>
<div class="line">    enc.data = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> =  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line"></div>
<div class="line">return_func:</div>
<div class="line">    <span class="keywordflow">return</span> enc.data;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4663159507afcef1df21e7b29bbb1c6c"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void otz_encode_memory_reference </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a> *&#160;</td>
          <td class="paramname"><em>ps_shared_mem</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>offset</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>length</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>flags</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>param_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Appends a reference of previously allocated shared block to the encoded buffer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
    <tr><td class="paramname">ps_shared_mem</td><td></td></tr>
    <tr><td class="paramname">offset</td><td></td></tr>
    <tr><td class="paramname">length</td><td></td></tr>
    <tr><td class="paramname">flags</td><td></td></tr>
    <tr><td class="paramname">param_type</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l01014">1014</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{    </div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> enc;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span>(check_encode(ps_operation))</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_shared_mem == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aea980bb9abe6250d2b89ae8095b9bcdb">OTZ_ERROR_ENCODE_FORMAT</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>((<a class="code" href="structotz__client__encode__cmd.html#a5090110ee136f28c5f2939b2b326d722">flags</a> == <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a7aa74f7037354b0cd675442b600060c0">OTZ_MEM_SERVICE_RO</a>) &amp;&amp; </div>
<div class="line">        (ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> != <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a7aa74f7037354b0cd675442b600060c0">OTZ_MEM_SERVICE_RO</a> &amp;&amp; </div>
<div class="line">         ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> != <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a33f6f503a1e274dc317a34352157100c">OTZ_MEM_SERVICE_RW</a>)) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aea980bb9abe6250d2b89ae8095b9bcdb">OTZ_ERROR_ENCODE_FORMAT</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>((<a class="code" href="structotz__client__encode__cmd.html#a5090110ee136f28c5f2939b2b326d722">flags</a> == <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a8035deccf29fcd9fe345e3f3e0e4accb">OTZ_MEM_SERVICE_WO</a>) &amp;&amp; </div>
<div class="line">        (ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> != <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a8035deccf29fcd9fe345e3f3e0e4accb">OTZ_MEM_SERVICE_WO</a> &amp;&amp; </div>
<div class="line">         ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> != <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a33f6f503a1e274dc317a34352157100c">OTZ_MEM_SERVICE_RW</a>)) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aea980bb9abe6250d2b89ae8095b9bcdb">OTZ_ERROR_ENCODE_FORMAT</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="structotz__client__encode__cmd.html#af88abf923e07a4c493758d604921b6bd">param_type</a> == <a class="code" href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ffa10b853b752b4cd31ca98321d86ec3db4">OTZ_PARAM_IN</a> &amp;&amp; <a class="code" href="structotz__client__encode__cmd.html#a5090110ee136f28c5f2939b2b326d722">flags</a> == <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a8035deccf29fcd9fe345e3f3e0e4accb">OTZ_MEM_SERVICE_WO</a>) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aea980bb9abe6250d2b89ae8095b9bcdb">OTZ_ERROR_ENCODE_FORMAT</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="structotz__client__encode__cmd.html#af88abf923e07a4c493758d604921b6bd">param_type</a> == <a class="code" href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ffa5c86bb59cf47117648ab204158c8b2f9">OTZ_PARAM_OUT</a> &amp;&amp; <a class="code" href="structotz__client__encode__cmd.html#a5090110ee136f28c5f2939b2b326d722">flags</a> == <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a7aa74f7037354b0cd675442b600060c0">OTZ_MEM_SERVICE_RO</a>) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aea980bb9abe6250d2b89ae8095b9bcdb">OTZ_ERROR_ENCODE_FORMAT</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(((<a class="code" href="structotz__client__encode__cmd.html#afb02027737a6491d2e520e2ed77672a6">offset</a> + length) &gt;  ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a28220f0262b41e7f1929f7df08857fa7">ui_length</a>)) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> =  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a> &gt;= <a class="code" href="otz__api_8h.html#a12bcf1760a725c67f750d606944ae8ca">MAX_MEMBLOCKS_PER_OPERATION</a>) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> =  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">        <span class="keywordflow">goto</span> return_func;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line"><span class="preprocessor">#if 0    </span></div>
<div class="line"><span class="preprocessor"></span>    <span class="comment">/* check for the overlapped memory operation in the response buffer block */</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code" href="structotz__client__encode__cmd.html#af88abf923e07a4c493758d604921b6bd">param_type</a> == <a class="code" href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ffa5c86bb59cf47117648ab204158c8b2f9">OTZ_PARAM_OUT</a>) {</div>
<div class="line">        <span class="keywordflow">for</span>(index = 0; index &lt; ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a> ; index++) {</div>
<div class="line">            <span class="keywordflow">if</span>( (ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[index].<a class="code" href="structotz__mem__reference.html#a39df1ac5f9057a74513b315c8359e9b4">shared_mem</a> == ps_shared_mem) &amp;&amp; </div>
<div class="line">                 (ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[index].<a class="code" href="structotz__mem__reference.html#abded90096f65a46b8e151aebc39571bf">param_type</a> == <a class="code" href="otz__api_8h.html#ac2b9c7ed6d9ebe7cdc56921f2f4ce6ffa5c86bb59cf47117648ab204158c8b2f9">OTZ_PARAM_OUT</a>)) {</div>
<div class="line">                <span class="keywordflow">if</span>(<a class="code" href="structotz__client__encode__cmd.html#afb02027737a6491d2e520e2ed77672a6">offset</a> &gt;= ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[index].<a class="code" href="structotz__mem__reference.html#ac84a349830e146ab101bb365437f0e41">offset</a> &amp;&amp; </div>
<div class="line">                    <a class="code" href="structotz__client__encode__cmd.html#afb02027737a6491d2e520e2ed77672a6">offset</a> &lt; (ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[index].<a class="code" href="structotz__mem__reference.html#ac84a349830e146ab101bb365437f0e41">offset</a> + </div>
<div class="line">                            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[index].<a class="code" href="structotz__mem__reference.html#ada48b7ba047eb0b21e2ea9fe81418482">length</a>)) {</div>
<div class="line">                    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> =  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">                }</div>
<div class="line">                <span class="keywordflow">if</span>((<a class="code" href="structotz__client__encode__cmd.html#afb02027737a6491d2e520e2ed77672a6">offset</a> + length) &gt;= ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[index].<a class="code" href="structotz__mem__reference.html#ac84a349830e146ab101bb365437f0e41">offset</a> &amp;&amp; </div>
<div class="line">                    (<a class="code" href="structotz__client__encode__cmd.html#afb02027737a6491d2e520e2ed77672a6">offset</a> + length) &lt; (ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[index].<a class="code" href="structotz__mem__reference.html#ac84a349830e146ab101bb365437f0e41">offset</a> + </div>
<div class="line">                              ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[index].<a class="code" href="structotz__mem__reference.html#ada48b7ba047eb0b21e2ea9fe81418482">length</a>)) {</div>
<div class="line">                    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> =  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">                    <span class="keywordflow">return</span>;</div>
<div class="line">                }            </div>
<div class="line">            }</div>
<div class="line">        }            </div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    </div>
<div class="line">    enc.encode_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">    enc.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">    enc.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">    enc.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line"></div>
<div class="line">    enc.data = ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a>;</div>
<div class="line">    enc.len  = length;</div>
<div class="line">    enc.offset = <a class="code" href="structotz__client__encode__cmd.html#afb02027737a6491d2e520e2ed77672a6">offset</a>;</div>
<div class="line">    enc.flags = <a class="code" href="structotz__client__encode__cmd.html#a5090110ee136f28c5f2939b2b326d722">flags</a>;</div>
<div class="line">    enc.param_type = <a class="code" href="structotz__client__encode__cmd.html#af88abf923e07a4c493758d604921b6bd">param_type</a>;</div>
<div class="line"></div>
<div class="line">    ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                <a class="code" href="otz__client_8h.html#a1e9c448543d21734707fff1c2ca516c7">OTZ_CLIENT_IOCTL_ENC_MEM_REF</a>, &amp;enc);</div>
<div class="line">    <span class="keywordflow">if</span> (ret){</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a> = enc.encode_id;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a>].<a class="code" href="structotz__mem__reference.html#a39df1ac5f9057a74513b315c8359e9b4">shared_mem</a> </div>
<div class="line">                                                        = ps_shared_mem;</div>
<div class="line"></div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a>].<a class="code" href="structotz__mem__reference.html#ac84a349830e146ab101bb365437f0e41">offset</a> </div>
<div class="line">                                                                    = <a class="code" href="structotz__client__encode__cmd.html#afb02027737a6491d2e520e2ed77672a6">offset</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a>].<a class="code" href="structotz__mem__reference.html#ada48b7ba047eb0b21e2ea9fe81418482">length</a> </div>
<div class="line">                                                                    = length;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a61f38a1645bbba533c026d82830f63e2">shared_mem</a>[ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a>].<a class="code" href="structotz__mem__reference.html#abded90096f65a46b8e151aebc39571bf">param_type</a> </div>
<div class="line">                                                                   = <a class="code" href="structotz__client__encode__cmd.html#af88abf923e07a4c493758d604921b6bd">param_type</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a>++;</div>
<div class="line">    }</div>
<div class="line">return_func:     </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5067283c78c6e22d4e4da117ec943f81"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void otz_encode_uint32 </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void const *&#160;</td>
          <td class="paramname"><em>data</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>param_type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Encode unsigned 32-bit integer. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation,:</td><td></td></tr>
    <tr><td class="paramname">data,:</td><td></td></tr>
    <tr><td class="paramname">param_type,:</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00830">830</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> enc;</div>
<div class="line">    <span class="keywordtype">int</span> ret;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(check_encode(ps_operation))</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"></div>
<div class="line">    enc.<a class="code" href="structotz__client__encode__cmd.html#a60354aef5351fdf4658e40fba86acffd">encode_id</a> = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">    enc.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">    enc.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">    enc.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line"></div>
<div class="line">    enc.data = (<span class="keywordtype">void</span>*)<a class="code" href="fat32_8h.html#a40767ad71451f60885c01f28dd2a4b47">data</a>;</div>
<div class="line">    enc.len  = <span class="keyword">sizeof</span>(<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>);</div>
<div class="line">    enc.param_type = <a class="code" href="structotz__client__encode__cmd.html#af88abf923e07a4c493758d604921b6bd">param_type</a>;</div>
<div class="line"></div>
<div class="line">    ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                    <a class="code" href="otz__client_8h.html#ac6a8a73b9377df5e63f60dfbf9163fbb">OTZ_CLIENT_IOCTL_ENC_UINT32</a>, &amp;enc);</div>
<div class="line">    <span class="keywordflow">if</span> (ret) {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a704265faf8b81f97738a6b5f0b3875d1">OTZ_ERROR_ENCODE_MEMORY</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a> = enc.encode_id;</div>
<div class="line">    }</div>
<div class="line">         </div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5e03210f006d016a07b0a27cbae0f5f7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void otz_free_temp_shared_mem </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00465">465</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__session__shared__mem__info.html" title="Shared memory information for the session.">otz_session_shared_mem_info</a> mem_info;</div>
<div class="line">    <span class="keywordtype">int</span> i;</div>
<div class="line">    mem_info.<a class="code" href="structotz__session__shared__mem__info.html#a4c3aae11b886efcf137735a54cf30af8">service_id</a> = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a>;</div>
<div class="line">    mem_info.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(i = 0; i &lt; ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a>; i++) {</div>
<div class="line">        mem_info.user_mem_addr = (<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a81a4ced50943d64ef286314650814aa3">temp_mem</a>[i].<a class="code" href="structotz__mem__reference.html#a39df1ac5f9057a74513b315c8359e9b4">shared_mem</a>;</div>
<div class="line">        munmap((<span class="keywordtype">void</span>*)mem_info.user_mem_addr, ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a81a4ced50943d64ef286314650814aa3">temp_mem</a>[i].<a class="code" href="structotz__mem__reference.html#ada48b7ba047eb0b21e2ea9fe81418482">length</a>);</div>
<div class="line">        ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">            <a class="code" href="otz__client_8h.html#acc330cddd9c28f9ee43644552166878d">OTZ_CLIENT_IOCTL_SHR_MEM_FREE_REQ</a>, &amp;mem_info);</div>
<div class="line">        <span class="keywordflow">if</span>(ret ){</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = ret;</div>
<div class="line">            perror(<span class="stringliteral">&quot;Warning : Freeing temp shared mem failed \n&quot;</span>);</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="adeb1c8c350ebefd309f503726a2b8e41"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void otz_operation_cancel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00574">574</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a0d31dcaad228c53c2fb4094329111944"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_operation_perform </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> *&#160;</td>
          <td class="paramname"><em>pui_service_return</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Performs the previously prepared operation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
    <tr><td class="paramname">pui_service_return</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00242">242</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structser__ses__id.html" title="Session details structure.">ser_ses_id</a> ses_close;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structser__ses__id.html" title="Session details structure.">ser_ses_id</a> ses_open;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> enc;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_operation == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || pui_service_return == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;operation_perform : Illegal argument\n&quot;</span>);    </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(!(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bacfa218bc516a757e26a7248eb959fb7e">OTZ_STATE_ENCODE</a> || </div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba218a34ca51a29c286a5ec794347d915b">OTZ_STATE_PERFORMABLE</a>)) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;operation_perform : Illegal state\n&quot;</span>);    </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a17a59e90aad673eacadb8490283f5499">OTZ_ERROR_ILLEGAL_STATE</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;perform \n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba2d1d39b46fb1b8a045558802f26d14d8">OTZ_STATE_RUNNING</a>;</div>
<div class="line"></div>
<div class="line">     <span class="comment">/* For close operation the service cannot return a message*/</span></div>
<div class="line">     <span class="comment">/* The client cannot cancel or time-out the operation */</span></div>
<div class="line">     <span class="comment">/* When this is complete irrespective of success or failure</span></div>
<div class="line"><span class="comment">      * the session is considered close */</span>  </div>
<div class="line">    <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> == <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74aa8869f3ce511b3a269235c8fd1ad5f63">OTZ_OPERATION_CLOSE</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a71114b71bb3794410ecd938bc62a441d">operation_count</a> == 1 &amp;&amp; </div>
<div class="line">                        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#afb75e8af2520aadc3c888a02ffdfa4f4">shared_mem_cnt</a> == 0){</div>
<div class="line">                <span class="comment">/* session can be closed */</span></div>
<div class="line">    </div>
<div class="line">            ses_close.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">            ses_close.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line">    </div>
<div class="line">            ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>,</div>
<div class="line">                        <a class="code" href="otz__client_8h.html#a4d3f346f8ed5d6932d3f8a47ecd06585">OTZ_CLIENT_IOCTL_SES_CLOSE_REQ</a>, &amp;ses_close);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span>(ret &lt; 0){</div>
<div class="line">     </div>
<div class="line">                <span class="comment">/* Error is detected before reaching the service */</span></div>
<div class="line">                *pui_service_return = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a011416e65f00b25a21592c87267eb9bd">OTZ_ERROR_GENERIC</a>;</div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;</div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">                <span class="comment">/*return  Error actually occurred */</span></div>
<div class="line">                <span class="comment">/*Decoder functions cannot be used on the operation */</span></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="preprocessor"></span>            <span class="comment">/*  The service does not exist */</span> </div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>;</div>
<div class="line">            <span class="comment">/* The system rejects a new session due to bad login credentials */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>.</div>
<div class="line">            <span class="comment">/* The secure environment is busy or low on resource and </span></div>
<div class="line"><span class="comment">             * cannot handle the request */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                     <span class="keywordflow">return</span> TZ_ERROR_BUSY;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                 <span class="keywordflow">if</span>(ret == -EFAULT)</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>;</div>
<div class="line"></div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a323328909603b4a09891fb854cd15c5c">OTZ_ERROR_UNDEFINED</a>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ret &gt; 0){</div>
<div class="line">                <span class="comment">/* Operation reaches the service but it returns error */</span></div>
<div class="line">                <span class="comment">/* Error code from Service assigned */</span></div>
<div class="line">                *pui_service_return = ret;</div>
<div class="line"></div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aca66b378fc1c26b5990a5edc5f334a55">OTZ_ERROR_SERVICE</a>; </div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">            *pui_service_return = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line"></div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#ad2a9008616d4b2f37a5eef14c8ebaa34">session_count</a>--;  </div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9">OTZ_STATE_UNDEFINED</a>;  </div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> = -1;  </div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> = <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aa3f46aad753a2d88ce91ecf2b3393d8b0">OTZ_SVC_INVALID</a>;  </div>
<div class="line"></div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span>{</div>
<div class="line">            <span class="comment">/* Undefined Behaviour */</span></div>
<div class="line">            printf(<span class="stringliteral">&quot;Operation_cnt or shared_mem_cnt != 0 undef behaviour\n&quot;</span>);</div>
<div class="line">            printf(<span class="stringliteral">&quot;Operation_cnt = %d   shared_mem_cnt = %d\n&quot;</span>,</div>
<div class="line">                        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a71114b71bb3794410ecd938bc62a441d">operation_count</a>,</div>
<div class="line">                        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#afb75e8af2520aadc3c888a02ffdfa4f4">shared_mem_cnt</a>);</div>
<div class="line">            <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a011416e65f00b25a21592c87267eb9bd">OTZ_ERROR_GENERIC</a>;</div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> == <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74ae3426ea3b47e48669f0994c9b7f69a06">OTZ_OPERATION_OPEN</a>)</div>
<div class="line">    {</div>
<div class="line">        ses_open.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a>;</div>
<div class="line"></div>
<div class="line">        ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>,</div>
<div class="line">                    <a class="code" href="otz__client_8h.html#a44cde702959998cc55975d32b57f5556">OTZ_CLIENT_IOCTL_SES_OPEN_REQ</a>, &amp;ses_open);</div>
<div class="line">            <span class="keywordflow">if</span>(ret &lt; 0){</div>
<div class="line">                 <span class="comment">/* Error is detected before reaching the service */</span></div>
<div class="line">                *pui_service_return = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a011416e65f00b25a21592c87267eb9bd">OTZ_ERROR_GENERIC</a>;</div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;</div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">                <span class="comment">/*return  Error actually occurred */</span></div>
<div class="line">                <span class="comment">/*Decoder functions cannot be used on the operation */</span></div>
<div class="line"></div>
<div class="line">            <span class="comment">/*  The encoder ran out of space */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == -<a class="code" href="sw__filelib_8h.html#a6a05c923dad0c1208043e9c20a58c8e5">ENOMEM</a>)</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9af73e3a356497d98c0f50006d4c81c34c">OTZ_ERROR_MEMORY</a>;</div>
<div class="line">                 <span class="keywordflow">if</span>(ret == -EFAULT)</div>
<div class="line">                     <span class="keywordflow">return</span>  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>;</div>
<div class="line">                 <span class="keywordflow">if</span>(ret == -EINVAL)</div>
<div class="line">                     <span class="keywordflow">return</span>  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="preprocessor"></span>                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">            <span class="comment">/*  The service does not exist */</span> </div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>;</div>
<div class="line">            <span class="comment">/* The system rejects a new session due to bad login credentials */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>.</div>
<div class="line">            <span class="comment">/* The operation has timed out, or been cancelled */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a7789ecf9ebab693d4a66a6b092152f7a">OTZ_ERROR_CANCEL</a>;</div>
<div class="line">            <span class="comment">/* The secure environment is busy or low on resource and </span></div>
<div class="line"><span class="comment">             * cannot handle the request */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                     <span class="keywordflow">return</span>  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a41673c9f07fe677e9ec5ff1548ae37f0">OTZ_ERROR_BUSY</a>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a323328909603b4a09891fb854cd15c5c">OTZ_ERROR_UNDEFINED</a>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ret &gt; 0){</div>
<div class="line">                <span class="comment">/* Operation reaches the service but it returns error */</span></div>
<div class="line">                <span class="comment">/* Error code from Service assigned */</span></div>
<div class="line">                *pui_service_return = ret;</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* The service may have a message for the client</span></div>
<div class="line"><span class="comment">                 * which can be decoded if needed */</span></div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a">OTZ_STATE_DECODE</a>;</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aca66b378fc1c26b5990a5edc5f334a55">OTZ_ERROR_SERVICE</a>; </div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;ses open success\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#ad2a9008616d4b2f37a5eef14c8ebaa34">session_count</a>++ ;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> = ses_open.session_id;</div>
<div class="line"></div>
<div class="line">        *pui_service_return = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a">OTZ_STATE_DECODE</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a>; </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> == <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74a2d4af296381db71825daa2f33e2ce4ba">OTZ_OPERATION_INVOKE</a>) {    </div>
<div class="line">        enc.encode_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">        enc.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">        enc.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">        enc.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line">    </div>
<div class="line">        ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>,</div>
<div class="line">                        <a class="code" href="otz__client_8h.html#a74d70f914f878eeceecf69ee64912a9b">OTZ_CLIENT_IOCTL_SEND_CMD_REQ</a>, &amp;enc);</div>
<div class="line"></div>
<div class="line">            <span class="keywordflow">if</span>(ret &lt; 0){</div>
<div class="line">                 <span class="comment">/* Error is detected before reaching the service */</span></div>
<div class="line">                *pui_service_return = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a011416e65f00b25a21592c87267eb9bd">OTZ_ERROR_GENERIC</a>;</div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;</div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">                <span class="comment">/*return  Error actually occurred */</span></div>
<div class="line">                <span class="comment">/*Decoder functions cannot be used on the operation */</span></div>
<div class="line"></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == -EFAULT)</div>
<div class="line">                     <span class="keywordflow">return</span>  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>;</div>
<div class="line">                 <span class="keywordflow">if</span>(ret == -EINVAL)</div>
<div class="line">                     <span class="keywordflow">return</span>  <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="preprocessor"></span>            <span class="comment">/*  The service does not exist */</span> </div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>;</div>
<div class="line">            <span class="comment">/* The system rejects a new session due to bad login credentials */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a568fb26279b5aeae36fe8e8dba0bfb90">OTZ_ERROR_ACCESS_DENIED</a>.</div>
<div class="line">            <span class="comment">/* The operation has timed out, or been cancelled */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a7789ecf9ebab693d4a66a6b092152f7a">OTZ_ERROR_CANCEL</a>;</div>
<div class="line">            <span class="comment">/* The secure environment is busy or low on resource and </span></div>
<div class="line"><span class="comment">             * cannot handle the request */</span></div>
<div class="line">                 <span class="keywordflow">if</span>(ret == )</div>
<div class="line">                     <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a41673c9f07fe677e9ec5ff1548ae37f0">OTZ_ERROR_BUSY</a>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>                <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a323328909603b4a09891fb854cd15c5c">OTZ_ERROR_UNDEFINED</a>;</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ret &gt; 0){</div>
<div class="line">                <span class="comment">/* Operation reaches the service but it returns error */</span></div>
<div class="line">                <span class="comment">/* Error code from Service assigned */</span></div>
<div class="line">                *pui_service_return = ret;</div>
<div class="line"></div>
<div class="line">                <span class="comment">/* The service may have a message for the client</span></div>
<div class="line"><span class="comment">                 * which can be decoded if needed */</span></div>
<div class="line">                ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a">OTZ_STATE_DECODE</a>;</div>
<div class="line">                <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9aca66b378fc1c26b5990a5edc5f334a55">OTZ_ERROR_SERVICE</a>; </div>
<div class="line">            }</div>
<div class="line"></div>
<div class="line">        *pui_service_return = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a">OTZ_STATE_DECODE</a>;</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a>; </div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a323328909603b4a09891fb854cd15c5c">OTZ_ERROR_UNDEFINED</a>;</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a56d72206cc55e912e8ce188fbe632c8a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_operation_prepare_close </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__session__t.html">otz_session_t</a> *&#160;</td>
          <td class="paramname"><em>ps_session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare the operation for close session. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_session</td><td></td></tr>
    <tr><td class="paramname">ps_operation</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00199">199</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span>(ps_session == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || ps_operation == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;operation prepare close : Illegal argument\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_session-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> != <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;operation prepare close : Illegal state\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a17a59e90aad673eacadb8490283f5499">OTZ_ERROR_ILLEGAL_STATE</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> != <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9">OTZ_STATE_UNDEFINED</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;operation prepare close : Illegal state\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a17a59e90aad673eacadb8490283f5499">OTZ_ERROR_ILLEGAL_STATE</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ps_session-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba96dd245ead2dc47347e8d4e26c037614">OTZ_STATE_CLOSING</a>;</div>
<div class="line">    ps_session-&gt;<a class="code" href="structotz__session__t.html#a71114b71bb3794410ecd938bc62a441d">operation_count</a>++;</div>
<div class="line"></div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a> = ps_session;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> = <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74aa8869f3ce511b3a269235c8fd1ad5f63">OTZ_OPERATION_CLOSE</a>;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba218a34ca51a29c286a5ec794347d915b">OTZ_STATE_PERFORMABLE</a>;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a> = 0;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a> = 0;</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#if 0</span></div>
<div class="line"><span class="preprocessor"></span><span class="comment">/*on failure*/</span></div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;   </div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9b0f5735d0aa17639a7ce957ecb5867f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_operation_prepare_invoke </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__session__t.html">otz_session_t</a> *&#160;</td>
          <td class="paramname"><em>ps_session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>&#160;</td>
          <td class="paramname"><em>ui_command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__timelimit__t.html">otz_timelimit_t</a> const *&#160;</td>
          <td class="paramname"><em>pks_timelimit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare operation for service request. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_session</td><td></td></tr>
    <tr><td class="paramname">ui_command</td><td></td></tr>
    <tr><td class="paramname">pks_timelimit</td><td></td></tr>
    <tr><td class="paramname">ps_operation</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00162">162</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_session == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || ps_operation == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;prepare invoke : Illegal argument\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_session-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> != <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;prepare invoke : Illegal state\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a17a59e90aad673eacadb8490283f5499">OTZ_ERROR_ILLEGAL_STATE</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a> = ps_session;</div>
<div class="line">     ps_session-&gt;<a class="code" href="structotz__session__t.html#a71114b71bb3794410ecd938bc62a441d">operation_count</a>++;</div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> = <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74a2d4af296381db71825daa2f33e2ce4ba">OTZ_OPERATION_INVOKE</a>;</div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bacfa218bc516a757e26a7248eb959fb7e">OTZ_STATE_ENCODE</a>;</div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a> = -1;</div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a> = ui_command;</div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#afe1724e2d7c25887cc48733bc7a47e98">enc_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ae3ac49dcf8f3ce9b92e2f3c7004b94d2">dec_error_state</a> = <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a1f154faaf042cef2433270a290399177">shared_mem_ref_count</a> = 0;</div>
<div class="line">     ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a> = 0;</div>
<div class="line">     <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="afe75dee12e5e7d00489297ce482b9f74"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_operation_prepare_open </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__device__t.html">otz_device_t</a> *&#160;</td>
          <td class="paramname"><em>ps_device</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>pks_service</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__login__t.html">otz_login_t</a> const *&#160;</td>
          <td class="paramname"><em>pks_login</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__timelimit__t.html">otz_timelimit_t</a> const *&#160;</td>
          <td class="paramname"><em>pks_timelimit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__session__t.html">otz_session_t</a> *&#160;</td>
          <td class="paramname"><em>ps_session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare open operation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_device</td><td></td></tr>
    <tr><td class="paramname">pks_service</td><td></td></tr>
    <tr><td class="paramname">pks_login</td><td></td></tr>
    <tr><td class="paramname">pks_timelimit</td><td></td></tr>
    <tr><td class="paramname">ps_session</td><td></td></tr>
    <tr><td class="paramname">ps_operation</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00120">120</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (ps_device == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || pks_service == <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aa3f46aad753a2d88ce91ecf2b3393d8b0">OTZ_SVC_INVALID</a> || </div>
<div class="line">        ps_session == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || ps_operation == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line">    </div>
<div class="line">        printf(<span class="stringliteral">&quot;operation prepare open : Illegal argument\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ps_session-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;</div>
<div class="line">    ps_session-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a> = ps_device;</div>
<div class="line">    ps_session-&gt;<a class="code" href="structotz__session__t.html#a71114b71bb3794410ecd938bc62a441d">operation_count</a> = 0;</div>
<div class="line">    ps_session-&gt;<a class="code" href="structotz__session__t.html#a71114b71bb3794410ecd938bc62a441d">operation_count</a>++;</div>
<div class="line">    ps_session-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> = pks_service;</div>
<div class="line">    ps_session-&gt;<a class="code" href="structotz__session__t.html#afb75e8af2520aadc3c888a02ffdfa4f4">shared_mem_cnt</a> = 0;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a98ea51e9edf291ab7d38c071b2257479">temp_mem_ref_count</a> = 0;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="sw__list_8h.html#a0ffe9d28c36d7b018a9cfae33bae45c0">INIT_LIST_HEAD</a>(&amp;ps_session-&gt;<a class="code" href="structotz__session__t.html#a622cecc77466298698501533ac5007ab">shared_mem_list</a>);</div>
<div class="line"></div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> = <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74ae3426ea3b47e48669f0994c9b7f69a06">OTZ_OPERATION_OPEN</a>;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bacfa218bc516a757e26a7248eb959fb7e">OTZ_STATE_ENCODE</a>;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a> = ps_session;</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7cca7c131a9236ee08c26ad743d2eec1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void otz_operation_release </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__operation__t.html">otz_operation_t</a> *&#160;</td>
          <td class="paramname"><em>ps_operation</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Release operation. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_operation</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00493">493</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__client__encode__cmd.html" title="Encode command structure.">otz_client_encode_cmd</a> enc;</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (ps_operation == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;operation release : Null operation\n&quot;</span>); </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (!(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> ==  <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bacfa218bc516a757e26a7248eb959fb7e">OTZ_STATE_ENCODE</a> ||</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba218a34ca51a29c286a5ec794347d915b">OTZ_STATE_PERFORMABLE</a> ||</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> ==  <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a">OTZ_STATE_DECODE</a> ||</div>
<div class="line">        ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> ==  <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>)) {</div>
<div class="line"></div>
<div class="line">        printf(<span class="stringliteral">&quot;operation release : Illegal state\n&quot;</span>); </div>
<div class="line">        printf(<span class="stringliteral">&quot;Warning : Undefined Behaviour\n&quot;</span>); </div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DBG</span></div>
<div class="line"><span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;o_release \n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a71114b71bb3794410ecd938bc62a441d">operation_count</a>--;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="otz__api_8c.html#a5e03210f006d016a07b0a27cbae0f5f7">otz_free_temp_shared_mem</a>(ps_operation);</div>
<div class="line">    <span class="comment">/* Open/Invoke operation has been prepared but not being</span></div>
<div class="line"><span class="comment">     * given to service for Implementation */</span></div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bacfa218bc516a757e26a7248eb959fb7e">OTZ_STATE_ENCODE</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> == <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74ae3426ea3b47e48669f0994c9b7f69a06">OTZ_OPERATION_OPEN</a>) {</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#ad2a9008616d4b2f37a5eef14c8ebaa34">session_count</a>--;</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9">OTZ_STATE_UNDEFINED</a>;</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> = -1;</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> = <a class="code" href="otz__id_8h.html#afbdebb53d1ef45ed1b498899088b4f7aa3f46aad753a2d88ce91ecf2b3393d8b0">OTZ_SVC_INVALID</a>;</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> == <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74a2d4af296381db71825daa2f33e2ce4ba">OTZ_OPERATION_INVOKE</a>) {</div>
<div class="line">            <span class="comment">/* Perform Necessary state reversal etc.,.*/</span></div>
<div class="line">        }</div>
<div class="line"></div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba218a34ca51a29c286a5ec794347d915b">OTZ_STATE_PERFORMABLE</a>){</div>
<div class="line">    <span class="comment">/* Close operation has been prepared but not being given to</span></div>
<div class="line"><span class="comment">     * service for Implementation */</span></div>
<div class="line"></div>
<div class="line">        <span class="keywordflow">if</span> ( ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> == <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74aa8869f3ce511b3a269235c8fd1ad5f63">OTZ_OPERATION_CLOSE</a>) {</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba18e6a7063c234fcf9b218db570ff6b9a">OTZ_STATE_DECODE</a>)</div>
<div class="line">    {</div>
<div class="line"></div>
<div class="line">        enc.encode_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#a059fa6c36eba3a8804a5eee3fbcc1938">encode_id</a>; </div>
<div class="line">        enc.cmd_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ad7543fc86a2ae72501658fbb62a107ec">enc_dec</a>.<a class="code" href="structotz__enc__dec__t.html#ac161556dc9ae0f0248f388d8d0d2589a">cmd_id</a>; </div>
<div class="line">        enc.service_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a> ;</div>
<div class="line">        enc.session_id = ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a> ;</div>
<div class="line"></div>
<div class="line">        ret = ioctl(ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                        <a class="code" href="otz__client_8h.html#a96a3275839a04f4d4380cfab6b977ea2">OTZ_CLIENT_IOCTL_OPERATION_RELEASE</a>, &amp;enc);</div>
<div class="line">        <span class="keywordflow">if</span> (ret){</div>
<div class="line">            perror(<span class="stringliteral">&quot;Operation release failed\n&quot;</span>);</div>
<div class="line">            ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a35b87a4180827c2064ff29377c6767db">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">            <span class="comment">/* Do Nothing;Just release the operation */</span></div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a5814b89d8fa281285ce31bc1ea4dfa7b">session</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#a44a6d29d2ce36d8d19f98da59c9c96cf">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9">OTZ_STATE_UNDEFINED</a>;</div>
<div class="line">    ps_operation-&gt;<a class="code" href="structotz__operation__t.html#ae17f2b49df1a19f5b33c9bec974f0fac">type</a> = <a class="code" href="otz__api_8h.html#a6e2349cbd9eb83af61bcd4fe3f9eeb74a4370cd5fbe2631ca67965cc40786f86f">OTZ_OPERATION_NONE</a>;</div>
<div class="line">    </div>
<div class="line">    return ; </div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a803f85d1b6da9a5ec167bb0f5450a0e4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_shared_memory_allocate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__session__t.html">otz_session_t</a> *&#160;</td>
          <td class="paramname"><em>ps_session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a> *&#160;</td>
          <td class="paramname"><em>ps_shared_mem</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function allocates a block of memory, defined by the structure pointed to by ps_shared_mem, which is shared between the client and the service it is connected to. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_session</td><td></td></tr>
    <tr><td class="paramname">ps_shared_mem</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00588">588</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret = 0, mmap_flags = PROT_READ | PROT_WRITE;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__session__shared__mem__info.html" title="Shared memory information for the session.">otz_session_shared_mem_info</a> mem_info;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_session == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || ps_shared_mem == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;shr_mem_allocate : Error Illegal argument\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a3316ec47aea3bdcdf930370a2f6c2898">OTZ_ERROR_ILLEGAL_ARGUMENT</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_session-&gt;<a class="code" href="structotz__session__t.html#a90dac9f6cee906456ffcafd222f36c3a">ui_state</a> != <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a> ||</div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a28220f0262b41e7f1929f7df08857fa7">ui_length</a> == 0 ||</div>
<div class="line">        (ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> != <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a7aa74f7037354b0cd675442b600060c0">OTZ_MEM_SERVICE_RO</a> &amp;&amp; </div>
<div class="line">         ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> != <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a8035deccf29fcd9fe345e3f3e0e4accb">OTZ_MEM_SERVICE_WO</a> &amp;&amp; </div>
<div class="line">         ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> != <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a33f6f503a1e274dc317a34352157100c">OTZ_MEM_SERVICE_RW</a>)) {</div>
<div class="line">        printf(<span class="stringliteral">&quot;shr_mem_allocate : Error Illegal state\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a17a59e90aad673eacadb8490283f5499">OTZ_ERROR_ILLEGAL_STATE</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> ==  <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a7aa74f7037354b0cd675442b600060c0">OTZ_MEM_SERVICE_RO</a>)</div>
<div class="line">        mmap_flags =  PROT_READ;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> ==  <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a8035deccf29fcd9fe345e3f3e0e4accb">OTZ_MEM_SERVICE_WO</a>)</div>
<div class="line">        mmap_flags =  PROT_WRITE;</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span>(ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> ==  <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527a33f6f503a1e274dc317a34352157100c">OTZ_MEM_SERVICE_RW</a>)</div>
<div class="line">        mmap_flags = PROT_READ | PROT_WRITE;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* call mem allocation function from the driver */</span></div>
<div class="line">    <span class="comment">/* should allocate eight byte aligned memory */</span></div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;mmap call  \n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;shared mem len  %d\n&quot;</span>,ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a28220f0262b41e7f1929f7df08857fa7">ui_length</a>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;shared mem fd  %d\n&quot;</span>,ps_session-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a> = mmap(0, ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a28220f0262b41e7f1929f7df08857fa7">ui_length</a>,</div>
<div class="line">                                      mmap_flags , MAP_SHARED,</div>
<div class="line">                                      ps_session-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, 0);</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;return from mmap\n&quot;</span>);</div>
<div class="line">    printf(<span class="stringliteral">&quot;mmap u_addr  %p\n&quot;</span>, (<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>*)ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">    <span class="keywordflow">if</span>(ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a> != MAP_FAILED) {</div>
<div class="line">        mem_info.service_id = ps_session-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a>;</div>
<div class="line">        mem_info.session_id = ps_session-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a>;</div>
<div class="line">        mem_info.user_mem_addr = (<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a>;</div>
<div class="line">        ret = ioctl(ps_session-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>, </div>
<div class="line">                <a class="code" href="otz__client_8h.html#aec1c031dce90c397aa85665e1e9ca9a3">OTZ_CLIENT_IOCTL_SHR_MEM_ALLOCATE_REQ</a>, &amp;mem_info);</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">        perror(<span class="stringliteral">&quot;otz_shared_memory_allocate - mmap failed\n&quot;</span>); </div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a6d85e53f3ac06e57b554242fe54c42e2">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        ret = -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ret != -1){ </div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a69fcd3101aa4de6539ecc56b25fc37c4">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bad9567be95d001d0f82dadb9e450a9fd3">OTZ_STATE_OPEN</a> ; </div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ad0d9d683bd7ffc078ae92319ac204547">session</a> = ps_session;</div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a76fc2ab1afa5c6f640177196fbe7427e">operation_count</a> = 0;</div>
<div class="line"></div>
<div class="line">        <a class="code" href="sw__list_8h.html#a0ffe9d28c36d7b018a9cfae33bae45c0">INIT_LIST_HEAD</a>(&amp;ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae57d14f3ca41a8b522ef8a8c98f60615">head_ref</a>);</div>
<div class="line">        list_add_tail(&amp;ps_session-&gt;<a class="code" href="structotz__session__t.html#a622cecc77466298698501533ac5007ab">shared_mem_list</a>, &amp;ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae57d14f3ca41a8b522ef8a8c98f60615">head_ref</a>);</div>
<div class="line">        ps_session-&gt;<a class="code" href="structotz__session__t.html#afb75e8af2520aadc3c888a02ffdfa4f4">shared_mem_cnt</a>++;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a2806558f4b03c44e78e8755ecda374e8">OTZ_SUCCESS</a>;</div>
<div class="line">    } </div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;shared_mem_allocation_failed\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a6d85e53f3ac06e57b554242fe54c42e2">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a69fcd3101aa4de6539ecc56b25fc37c4">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>;</div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a28220f0262b41e7f1929f7df08857fa7">ui_length</a> = 0 ; </div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> = <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527aa462fe85425a0bde33600ba164e20325">OTZ_MEM_SERVICE_UNDEFINED</a>; </div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ; </div>
<div class="line"></div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ad0d9d683bd7ffc078ae92319ac204547">session</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9af73e3a356497d98c0f50006d4c81c34c">OTZ_ERROR_MEMORY</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a323328909603b4a09891fb854cd15c5c">OTZ_ERROR_UNDEFINED</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a440cd98e3b951c796e15f29c51baac60"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="otz__api_8h.html#ad4f8dc61bf50df313bad5c8fded2539d">otz_return_t</a> otz_shared_memory_register </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__session__t.html">otz_session_t</a> *&#160;</td>
          <td class="paramname"><em>ps_session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a> *&#160;</td>
          <td class="paramname"><em>ps_shared_mem</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_session</td><td></td></tr>
    <tr><td class="paramname">ps_shared_mem</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00682">682</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="otz__api_8h.html#a81a7b5c8f80e9d01805dc40edeea10b9a0669e32ad6657b360501a030dc12d4db">OTZ_ERROR_NOT_IMPLEMENTED</a>;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a45aca9f87329cb21e0e9517099dcfc0d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void otz_shared_memory_release </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structotz__shared__mem__t.html">otz_shared_mem_t</a> *&#160;</td>
          <td class="paramname"><em>ps_shared_mem</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function allocates a block of memory, defined by the structure pointed to by ps_shared_mem, which is shared between the client and the service it is connected to. This function marks a block of shared memory associated with a session as no longer shared. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ps_shared_mem</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="otz__api_8c_source.html#l00693">693</a> of file <a class="el" href="otz__api_8c_source.html">otz_api.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> ret=0;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structotz__session__shared__mem__info.html" title="Shared memory information for the session.">otz_session_shared_mem_info</a> mem_info;</div>
<div class="line">    <span class="keyword">struct </span><a class="code" href="structlist.html">list</a> *l;</div>
<div class="line">    <a class="code" href="structotz__shared__mem__t.html" title="The otz_shared_memory_t structure is used to contain control information related to a block of shared...">otz_shared_mem_t</a>* ps_temp;</div>
<div class="line">    <span class="keywordtype">int</span> found = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_shared_mem == <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a76fc2ab1afa5c6f640177196fbe7427e">operation_count</a> != 0) {</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;shared mem release : Illegal arg\n&quot;</span>);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Warning: Undefined Behaviour\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a69fcd3101aa4de6539ecc56b25fc37c4">ui_state</a> == <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063bab7e987cd440e71515f7142537fdfb172">OTZ_STATE_INVALID</a>)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    mem_info.service_id = ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ad0d9d683bd7ffc078ae92319ac204547">session</a>-&gt;<a class="code" href="structotz__session__t.html#a87470714c679d32aab4a36516db9e265">service_id</a>;</div>
<div class="line">    mem_info.session_id = ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ad0d9d683bd7ffc078ae92319ac204547">session</a>-&gt;<a class="code" href="structotz__session__t.html#a0de10847cdda15fa0cf97493a00b6e9f">session_id</a>;</div>
<div class="line">    mem_info.user_mem_addr = (<a class="code" href="otz__api_8h.html#a435d1572bf3f880d55459d9805097f62">uint32_t</a>)ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a>;    </div>
<div class="line"></div>
<div class="line">    munmap(ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a>, ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a28220f0262b41e7f1929f7df08857fa7">ui_length</a>);</div>
<div class="line">    ret = ioctl(ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ad0d9d683bd7ffc078ae92319ac204547">session</a>-&gt;<a class="code" href="structotz__session__t.html#affe1125f065084bfa0bdb06f3601f351">device</a>-&gt;<a class="code" href="structotz__device__t.html#a6b37fae174cf4a4fb6a1f3a0300c587f">fd</a>,</div>
<div class="line">                   <a class="code" href="otz__client_8h.html#acc330cddd9c28f9ee43644552166878d">OTZ_CLIENT_IOCTL_SHR_MEM_FREE_REQ</a>, &amp;mem_info);</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>    printf(<span class="stringliteral">&quot;coming out of unmap\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>    <span class="keywordflow">if</span>(ret)</div>
<div class="line">    {</div>
<div class="line"><span class="preprocessor">#ifdef OTZ_DEBUG</span></div>
<div class="line"><span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;Ioctl for mem free failed\n&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span>        printf(<span class="stringliteral">&quot;Shared memory release failed\n&quot;</span>);</div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a6d85e53f3ac06e57b554242fe54c42e2">s_errno</a> = <a class="code" href="sw__filelib_8h.html#ad65a8842cc674e3ddf69355898c0ecbf">errno</a>;</div>
<div class="line">        <span class="keywordflow">return</span>; </div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a69fcd3101aa4de6539ecc56b25fc37c4">ui_state</a> = <a class="code" href="otz__api_8h.html#af7e5410bcac27927f8e1df8d0579063ba1e0434501ed2988455c4d43227b518c9">OTZ_STATE_UNDEFINED</a>;</div>
<div class="line">    ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a272f0619c08e9febd69b3a5947df3fb1">p_block</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#a28220f0262b41e7f1929f7df08857fa7">ui_length</a> = 0;</div>
<div class="line">    ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ae33064212c66c6b83b0a7c911a7a180c">ui_flags</a> = <a class="code" href="otz__api_8h.html#a0726f9cc52e17d8e6cd7dd085cc62527aa462fe85425a0bde33600ba164e20325">OTZ_MEM_SERVICE_UNDEFINED</a>;</div>
<div class="line">    ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#af01846f31ebaa3fe15ac339775b6c19d">session_id</a> = -1;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="sw__list_8h.html#abeae4779f478cbb5e1d437e6853c77c5">list_for_each</a>(l, &amp;ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ad0d9d683bd7ffc078ae92319ac204547">session</a>-&gt;<a class="code" href="structotz__session__t.html#a622cecc77466298698501533ac5007ab">shared_mem_list</a>) {</div>
<div class="line">        ps_temp = <a class="code" href="sw__list_8h.html#a26c976b7f654e70df318c1843e5094de">list_entry</a>(l, <a class="code" href="structotz__shared__mem__t.html" title="The otz_shared_memory_t structure is used to contain control information related to a block of shared...">otz_shared_mem_t</a>, head_ref);</div>
<div class="line">        <span class="keywordflow">if</span> (ps_temp == ps_shared_mem) {</div>
<div class="line">            found = 1;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(found) {</div>
<div class="line">        list_del(&amp;ps_temp-&gt;<a class="code" href="structotz__shared__mem__t.html#ae57d14f3ca41a8b522ef8a8c98f60615">head_ref</a>);</div>
<div class="line">        ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ad0d9d683bd7ffc078ae92319ac204547">session</a>-&gt;<a class="code" href="structotz__session__t.html#afb75e8af2520aadc3c888a02ffdfa4f4">shared_mem_cnt</a>--;</div>
<div class="line">    }</div>
<div class="line">    ps_shared_mem-&gt;<a class="code" href="structotz__shared__mem__t.html#ad0d9d683bd7ffc078ae92319ac204547">session</a> = <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    return ;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jan 3 2013 00:33:52 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
