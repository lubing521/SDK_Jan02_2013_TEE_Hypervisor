<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>mem_mng.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- end header part -->
<!-- Generated by Doxygen 1.8.2 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_6aeebb853ebd8c514e6186653c592c82.html">otzone</a></li><li class="navelem"><a class="el" href="dir_fb44076c8b62c63869cf8a830933e50d.html">src</a></li><li class="navelem"><a class="el" href="dir_ae72a19de923b7f4b595b906221fc8f6.html">core</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">mem_mng.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;<a class="el" href="sw__types_8h_source.html">sw_types.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__board_8h_source.html">sw_board.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__mem__functions_8h_source.html">sw_mem_functions.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="sw__debug_8h_source.html">sw_debug.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="page__table_8h_source.html">page_table.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="cpu__data_8h_source.html">cpu_data.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="cpu__mmu_8h_source.html">cpu_mmu.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="mem__mng_8h_source.html">mem_mng.h</a>&gt;</code><br/>
</div>
<p><a href="mem__mng_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a65cd86197b501b1ab28cee16fa16a1a0"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mem__mng_8c.html#a65cd86197b501b1ab28cee16fa16a1a0">sw_meminfo_init</a> (void)</td></tr>
<tr class="memdesc:a65cd86197b501b1ab28cee16fa16a1a0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes the address space in secure world by allocating and mapping the required pages.  <a href="#a65cd86197b501b1ab28cee16fa16a1a0"></a><br/></td></tr>
<tr class="separator:a65cd86197b501b1ab28cee16fa16a1a0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1eb57881c30e2e9cd09692a212b44605"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mem__mng_8c.html#a1eb57881c30e2e9cd09692a212b44605">sw_phy_page_alloc</a> (<a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> size)</td></tr>
<tr class="memdesc:a1eb57881c30e2e9cd09692a212b44605"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates physical pages for the required size.  <a href="#a1eb57881c30e2e9cd09692a212b44605"></a><br/></td></tr>
<tr class="separator:a1eb57881c30e2e9cd09692a212b44605"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a240866301f10bb63837178615584c9f4"><td class="memItemLeft" align="right" valign="top"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mem__mng_8c.html#a240866301f10bb63837178615584c9f4">sw_vir_page_alloc</a> (<a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> size)</td></tr>
<tr class="memdesc:a240866301f10bb63837178615584c9f4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocates physical pages for the required size.  <a href="#a240866301f10bb63837178615584c9f4"></a><br/></td></tr>
<tr class="separator:a240866301f10bb63837178615584c9f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae82ccc964dd993fa83b9b75983bf643a"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mem__mng_8c.html#ae82ccc964dd993fa83b9b75983bf643a">sw_phy_addr_reserve</a> (<a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a> phy_addr, int size)</td></tr>
<tr class="memdesc:ae82ccc964dd993fa83b9b75983bf643a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reserves the required pages in the bitmap.  <a href="#ae82ccc964dd993fa83b9b75983bf643a"></a><br/></td></tr>
<tr class="separator:ae82ccc964dd993fa83b9b75983bf643a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6ecf177e8665c07728c9c2053cf57807"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mem__mng_8c.html#a6ecf177e8665c07728c9c2053cf57807">sw_vir_addr_reserve</a> (<a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *vir_addr, int size)</td></tr>
<tr class="memdesc:a6ecf177e8665c07728c9c2053cf57807"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reserves the required pages in the bitmap.  <a href="#a6ecf177e8665c07728c9c2053cf57807"></a><br/></td></tr>
<tr class="separator:a6ecf177e8665c07728c9c2053cf57807"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01d012547538c1911c54c99698f71e3f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mem__mng_8c.html#a01d012547538c1911c54c99698f71e3f">sw_phy_addr_free</a> (<a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a> phy_addr, int size)</td></tr>
<tr class="memdesc:a01d012547538c1911c54c99698f71e3f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Frees the pages.  <a href="#a01d012547538c1911c54c99698f71e3f"></a><br/></td></tr>
<tr class="separator:a01d012547538c1911c54c99698f71e3f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a693354d2eff452e5a2c6786a7d965bf9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mem__mng_8c.html#a693354d2eff452e5a2c6786a7d965bf9">sw_vir_addr_free</a> (<a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> vir_addr, int size)</td></tr>
<tr class="memdesc:a693354d2eff452e5a2c6786a7d965bf9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reserves the required pages in the bitmap.  <a href="#a693354d2eff452e5a2c6786a7d965bf9"></a><br/></td></tr>
<tr class="separator:a693354d2eff452e5a2c6786a7d965bf9"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:aa0a92d30027b97bf859f280f51bd16e0"><td class="memItemLeft" align="right" valign="top">struct secure_world_mem_info&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a></td></tr>
<tr class="separator:aa0a92d30027b97bf859f280f51bd16e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a65cd86197b501b1ab28cee16fa16a1a0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>* sw_meminfo_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes the address space in secure world by allocating and mapping the required pages. </p>
<dl class="section return"><dt>Returns</dt><dd>Returns the address of the secure world page table </dd></dl>

<p>Definition at line <a class="el" href="mem__mng_8c_source.html#l00075">75</a> of file <a class="el" href="mem__mng_8c_source.html">mem_mng.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> sw_code_len = 0;</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> map_pa , map_va; </div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> alc_phy_add = 0;</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> alc_vir_add = 0;</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> tot_len_to_alloc; </div>
<div class="line"></div>
<div class="line">    <a class="code" href="sw__mem__functions_8h.html#a14af1b39b1154a36624740bad34b813f" title="memory set">sw_memset</a>( &amp;<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>));</div>
<div class="line">    </div>
<div class="line">    <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_addr_start      =    <a class="code" href="board_8c.html#ad83c9847970fa4ad4c9385edf1f2bab6" title="This functions returns the starting address of the Secure RAM.">get_secure_ram_start_addr</a>();</div>
<div class="line">    <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_memregion_size  =    <a class="code" href="board_8c.html#a37e76f9f24360bb83d1a6de5f5fcead2" title="This function returns the End address of the Secure RAM.">get_secure_ram_end_addr</a>() -</div>
<div class="line">                                      <a class="code" href="board_8c.html#ad83c9847970fa4ad4c9385edf1f2bab6" title="This functions returns the starting address of the Secure RAM.">get_secure_ram_start_addr</a>() + 1;</div>
<div class="line">    <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.num_phy_pag_free = </div>
<div class="line">                    ((<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_memregion_size) &gt;&gt; <a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_addr_start = <a class="code" href="cpu__data_8h.html#a555d36e2b5151946a30aa7931eebc5d3" title="This function returns the start of the virtual address of the secure world from the linker script...">get_sw_code_start</a>() ;</div>
<div class="line">    <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_memregion_size = <a class="code" href="mem__mng_8h.html#a88312f533f7917daee387b40622b02ec">VIR_ASPACE_SIZE</a> ;</div>
<div class="line">    <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.num_vir_pag_free =</div>
<div class="line">                    ((<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_memregion_size) &gt;&gt; <a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> ( <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_addr_start &amp; <a class="code" href="mem__mng_8h.html#af71d76263a681588b393b22b499e1e82">PAGE_OFFSET_MASK</a>){</div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_addr_start +=</div>
<div class="line">            (<a class="code" href="mem__mng_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a> - (<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_addr_start &amp; <a class="code" href="mem__mng_8h.html#af71d76263a681588b393b22b499e1e82">PAGE_OFFSET_MASK</a>));</div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_memregion_size -=</div>
<div class="line">            (<a class="code" href="mem__mng_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a> - (<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_addr_start &amp; <a class="code" href="mem__mng_8h.html#af71d76263a681588b393b22b499e1e82">PAGE_OFFSET_MASK</a>));</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>( <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_memregion_size &amp; <a class="code" href="mem__mng_8h.html#af71d76263a681588b393b22b499e1e82">PAGE_OFFSET_MASK</a>){</div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_memregion_size -= </div>
<div class="line">             (<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_memregion_size &amp; <a class="code" href="mem__mng_8h.html#af71d76263a681588b393b22b499e1e82">PAGE_OFFSET_MASK</a>) ;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap_len = (<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_memregion_size &gt;&gt; </div>
<div class="line">                                            (<a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a> + 3)) + 1;</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* memory word alignment */</span></div>
<div class="line">    <span class="keywordflow">if</span>(<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap_len &amp; 0x3) {</div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap_len  += </div>
<div class="line">                    4 - (<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap_len &amp; 0x3);</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_mem_bmap_len = (<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_memregion_size &gt;&gt; </div>
<div class="line">                                            (<a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a> + 3)) + 1;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap = <a class="code" href="cpu__data_8c.html#aa1918865e22c2c704f45544ad0994e65" title="Function returns the End address of the secure world code which is given in the Linker script...">get_sw_code_end</a>();</div>
<div class="line"></div>
<div class="line">    <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_mem_bmap = (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>*)((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap</div>
<div class="line">                                + <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap_len);</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    <a class="code" href="sw__mem__functions_8h.html#a14af1b39b1154a36624740bad34b813f" title="memory set">sw_memset</a>(<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap , 0 ,</div>
<div class="line">            (<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap_len +<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_mem_bmap_len));</div>
<div class="line">    sw_code_len = (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)<a class="code" href="cpu__data_8c.html#aa1918865e22c2c704f45544ad0994e65" title="Function returns the End address of the secure world code which is given in the Linker script...">get_sw_code_end</a>() - (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)<a class="code" href="cpu__data_8h.html#a555d36e2b5151946a30aa7931eebc5d3" title="This function returns the start of the virtual address of the secure world from the linker script...">get_sw_code_start</a>();</div>
<div class="line"></div>
<div class="line">    map_pa = <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_addr_start; </div>
<div class="line">    map_va = (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_addr_start; </div>
<div class="line">    alc_phy_add = 0;</div>
<div class="line">    alc_vir_add = 0;</div>
<div class="line"></div>
<div class="line">    tot_len_to_alloc = ( sw_code_len +</div>
<div class="line">                        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap_len +</div>
<div class="line">                        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_mem_bmap_len);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span>( map_pa &lt; (<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_addr_start + tot_len_to_alloc) )</div>
<div class="line">    {</div>
<div class="line">        alc_phy_add = ((map_pa - <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_addr_start) &gt;&gt; <a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap[alc_phy_add &gt;&gt; 5]</div>
<div class="line">                    |= 0x1 &lt;&lt; (31 - (alc_phy_add &amp; 0x1F));</div>
<div class="line"></div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.num_phy_pag_free--;</div>
<div class="line">        map_pa += <a class="code" href="mem__mng_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span>( map_va &lt; ((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_addr_start + tot_len_to_alloc) )</div>
<div class="line">    {</div>
<div class="line">        alc_vir_add = ((map_va - (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_addr_start) &gt;&gt; <a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>);</div>
<div class="line"></div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_mem_bmap[alc_vir_add &gt;&gt; 5]</div>
<div class="line">                    |= 0x1 &lt;&lt; (31 - (alc_vir_add &amp; 0x1F));</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.num_vir_pag_free--;</div>
<div class="line">        map_va += <a class="code" href="mem__mng_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> <a class="code" href="page__table_8h.html#a369ffb695e9118ac6e4ee04ea25ac5e6" title="Initialize page table entries.">map_secure_page_table</a>();</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a01d012547538c1911c54c99698f71e3f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sw_phy_addr_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>&#160;</td>
          <td class="paramname"><em>phy_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Frees the pages. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">phy_addr</td><td>start address of the pages to be freed </td></tr>
    <tr><td class="paramname">size</td><td>Size of the memory to be freed</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns zero on success </dd></dl>

<p>Definition at line <a class="el" href="mem__mng_8c_source.html#l00427">427</a> of file <a class="el" href="mem__mng_8c_source.html">mem_mng.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> fr_phy;</div>
<div class="line">    <span class="keywordtype">int</span> tmp_cnt;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(phy_addr &lt; <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_addr_start ||</div>
<div class="line">        phy_addr &gt; (<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_addr_start + <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_memregion_size))</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="uart_8h.html#ada15f9c5fdeff620561f66323e596429">serial_puts</a>(<span class="stringliteral">&quot;SW: Memory out of range\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    fr_phy = (phy_addr - <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_addr_start) &gt;&gt; <a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>;</div>
<div class="line"></div>
<div class="line">    tmp_cnt = fr_phy + (size &gt;&gt; <a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>( ; fr_phy &lt; tmp_cnt ; fr_phy++)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap[fr_phy &gt;&gt; 5] &amp;=</div>
<div class="line">            ~(0x1 &lt;&lt; (31 - (fr_phy &amp; 0x1F)));</div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.num_phy_pag_free++;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ae82ccc964dd993fa83b9b75983bf643a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sw_phy_addr_reserve </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a>&#160;</td>
          <td class="paramname"><em>phy_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reserves the required pages in the bitmap. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">phy_addr</td><td>start address of the area to be reserved </td></tr>
    <tr><td class="paramname">size</td><td>size of the area to be reserved</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns zero on success </dd></dl>

<p>Definition at line <a class="el" href="mem__mng_8c_source.html#l00320">320</a> of file <a class="el" href="mem__mng_8c_source.html">mem_mng.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> res_pa;</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> temp_sz,pg_cnt;</div>
<div class="line">    <span class="keywordtype">int</span> avl_cnt;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(phy_addr &lt; <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_addr_start ||</div>
<div class="line">           phy_addr &gt; ( <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_addr_start + <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_memregion_size)){</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    pg_cnt = (size &gt;&gt; <a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>);</div>
<div class="line">    res_pa = (phy_addr - <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_addr_start) &gt;&gt; <a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>;</div>
<div class="line">    temp_sz = size;</div>
<div class="line"> </div>
<div class="line">    avl_cnt = 0;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> chk_pa = res_pa;</div>
<div class="line">    <span class="keywordflow">for</span>( ;chk_pa &lt; (res_pa + pg_cnt); chk_pa++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap[chk_pa &gt;&gt; 5] &amp; </div>
<div class="line">                        ( 0x1 &lt;&lt; (31 - (chk_pa &amp; 0x1F)))){</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        avl_cnt++;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(avl_cnt != pg_cnt)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span>(temp_sz &gt; 0){</div>
<div class="line"></div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap[res_pa &gt;&gt; 5] |=</div>
<div class="line">            0x1 &lt;&lt; (31 - (res_pa &amp; 0x1F));</div>
<div class="line">        temp_sz -= <a class="code" href="mem__mng_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>;</div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.num_phy_pag_free--;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a1eb57881c30e2e9cd09692a212b44605"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a> sw_phy_page_alloc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates physical pages for the required size. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>Size of the memory to be allocated</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns the address of the memory allocated </dd></dl>

<p>Definition at line <a class="el" href="mem__mng_8c_source.html#l00176">176</a> of file <a class="el" href="mem__mng_8c_source.html">mem_mng.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> req_cnt,start = 0, iter=0, available;</div>
<div class="line">    <span class="keywordtype">int</span> avl_cnt=0, cnt; </div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> map_pa;  </div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> phy_addr;</div>
<div class="line"></div>
<div class="line">        <span class="comment">/*Align to next page size */</span></div>
<div class="line">        <span class="keywordflow">if</span>(size &amp; (<a class="code" href="mem__mng_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a> - 1))      </div>
<div class="line">                        size = (size &amp; (~<a class="code" href="mem__mng_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a> - 1)) + <a class="code" href="mem__mng_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>;</div>
<div class="line">    req_cnt = size &gt;&gt; <a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(req_cnt &gt; <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.num_phy_pag_free){</div>
<div class="line">        <a class="code" href="uart_8h.html#ada15f9c5fdeff620561f66323e596429">serial_puts</a>(<span class="stringliteral">&quot;SW: Page allocation failed \n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    available = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(start = 0; </div>
<div class="line">        start &lt; ((<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap_len &lt;&lt; 3) - req_cnt);</div>
<div class="line">        start++)</div>
<div class="line">    {</div>
<div class="line">        avl_cnt = 0;</div>
<div class="line">        <span class="keywordflow">for</span>(iter = start; iter &lt; ( start + req_cnt) ; iter++){</div>
<div class="line">            <span class="keywordflow">if</span>(<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap[iter&gt;&gt;5] &amp; (1 &lt;&lt; (31-(iter &amp; 0x1F))))</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">            avl_cnt++;</div>
<div class="line">        }</div>
<div class="line">       <span class="keywordflow">if</span>(avl_cnt == req_cnt){</div>
<div class="line">           available = 1;</div>
<div class="line">           <span class="keywordflow">break</span>;</div>
<div class="line">       }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(!available)</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">    </div>
<div class="line">    map_pa = start;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span>(cnt = 0;cnt &lt; req_cnt; cnt++)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_mem_bmap[(start+cnt) &gt;&gt; 5] </div>
<div class="line">                |= 0x1 &lt;&lt; (31 - ((start+cnt) &amp; 0x1F));</div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.num_phy_pag_free--;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    phy_addr = ((start &lt;&lt;  <a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>) + <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.phy_addr_start);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> phy_addr;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a693354d2eff452e5a2c6786a7d965bf9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sw_vir_addr_free </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td>
          <td class="paramname"><em>vir_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reserves the required pages in the bitmap. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">vir_addr,:</td><td>start address of the area to be reserved </td></tr>
    <tr><td class="paramname">size,:</td><td>size of the area to be reserved</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns zero on success </dd></dl>

<p>Definition at line <a class="el" href="mem__mng_8c_source.html#l00466">466</a> of file <a class="el" href="mem__mng_8c_source.html">mem_mng.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> fr_vir;</div>
<div class="line">    <span class="keywordtype">int</span> tmp_cnt;</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a009592c6ee2118c3c17cfb90f22efde3">pa_t</a> phy_addr;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(vir_addr &lt; (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_addr_start ||</div>
<div class="line">        vir_addr &gt; ((<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_addr_start + <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_memregion_size))</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="uart_8h.html#ada15f9c5fdeff620561f66323e596429">serial_puts</a>(<span class="stringliteral">&quot;SW: Memory out of range\n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line"></div>
<div class="line">    fr_vir = (vir_addr - (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_addr_start) &gt;&gt; <a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>;</div>
<div class="line"></div>
<div class="line">    tmp_cnt = fr_vir + (size &gt;&gt; <a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>( ; fr_vir &lt; tmp_cnt ; fr_vir++)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_mem_bmap[fr_vir &gt;&gt; 5] &amp;=</div>
<div class="line">            ~(0x1 &lt;&lt; (31 - (fr_vir &amp; 0x1F)));</div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.num_vir_pag_free++;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    phy_addr = <a class="code" href="cpu__mmu_8c.html#a8ba6341ba7949867e814a83e1699982c" title="Returns the physical address of virtual address based on secure world page table.">va_to_pa</a>(vir_addr);</div>
<div class="line"></div>
<div class="line">    <span class="comment">/* TODO: The address should be unmapped from the page table</span></div>
<div class="line"><span class="comment">     *</span></div>
<div class="line"><span class="comment">     */</span></div>
<div class="line"></div>
<div class="line">    <a class="code" href="mem__mng_8h.html#a01d012547538c1911c54c99698f71e3f" title="Frees the pages.">sw_phy_addr_free</a>(phy_addr , size);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a6ecf177e8665c07728c9c2053cf57807"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sw_vir_addr_reserve </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> *&#160;</td>
          <td class="paramname"><em>vir_addr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Reserves the required pages in the bitmap. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">phy_addr</td><td>start address of the area to be reserved </td></tr>
    <tr><td class="paramname">size</td><td>size of the area to be reserved</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns zero on success </dd></dl>

<p>Definition at line <a class="el" href="mem__mng_8c_source.html#l00374">374</a> of file <a class="el" href="mem__mng_8c_source.html">mem_mng.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> res_va;</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> temp_sz,pg_cnt;</div>
<div class="line">    <span class="keywordtype">int</span> avl_cnt;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(vir_addr &lt; <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_addr_start ||</div>
<div class="line">           vir_addr &gt; ( <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_addr_start + <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_memregion_size)){</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    pg_cnt = (size &gt;&gt; <a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>);</div>
<div class="line">    res_va = (vir_addr - <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_addr_start) &gt;&gt; <a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>;</div>
<div class="line">    temp_sz = size;</div>
<div class="line"> </div>
<div class="line">    avl_cnt = 0;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> chk_va = res_va;</div>
<div class="line">    <span class="keywordflow">for</span>( ;chk_va &lt; (res_va + pg_cnt); chk_va++)</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">if</span>(<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_mem_bmap[chk_va &gt;&gt; 5] &amp; </div>
<div class="line">                        ( 0x1 &lt;&lt; (31 - (chk_va &amp; 0x1F)))){</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        }</div>
<div class="line">        avl_cnt++;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(avl_cnt != pg_cnt)</div>
<div class="line">        <span class="keywordflow">return</span> -1;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span>(temp_sz &gt; 0){</div>
<div class="line"></div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_mem_bmap[res_va &gt;&gt; 5] |=</div>
<div class="line">            0x1 &lt;&lt; (31 - (res_va &amp; 0x1F));</div>
<div class="line">        temp_sz -= <a class="code" href="mem__mng_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>;</div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.num_vir_pag_free--;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line"></div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a240866301f10bb63837178615584c9f4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>* sw_vir_page_alloc </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>&#160;</td>
          <td class="paramname"><em>size</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocates physical pages for the required size. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">size</td><td>Size of the memory to be allocated</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Returns the address of the memory allocated </dd></dl>

<p>Definition at line <a class="el" href="mem__mng_8c_source.html#l00239">239</a> of file <a class="el" href="mem__mng_8c_source.html">mem_mng.c</a>.</p>
<div class="fragment"><div class="line">{</div>
<div class="line">    <span class="keywordtype">int</span> req_cnt,start = 0, iter=0, available;</div>
<div class="line">    <span class="keywordtype">int</span> avl_cnt=0, cnt; </div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> map_va;  </div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> vir_addr;</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> phy_addr;</div>
<div class="line">        <span class="comment">/*Align to next page size */</span></div>
<div class="line">        <span class="keywordflow">if</span>(size &amp; (<a class="code" href="mem__mng_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a> - 1))      </div>
<div class="line">                        size = (size &amp; (~(<a class="code" href="mem__mng_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a> -1) )) + <a class="code" href="mem__mng_8h.html#a7d467c1d283fdfa1f2081ba1e0d01b6e">PAGE_SIZE</a>;</div>
<div class="line">    req_cnt = size &gt;&gt; <a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(req_cnt &gt; <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.num_vir_pag_free){</div>
<div class="line">        <a class="code" href="uart_8h.html#ada15f9c5fdeff620561f66323e596429">serial_puts</a>(<span class="stringliteral">&quot;SW: Page allocation failed \n&quot;</span>);</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    available = 0;</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">for</span>(start = 0; start &lt; ((<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_mem_bmap_len &lt;&lt; 3) - req_cnt);</div>
<div class="line">                                                                     start++)</div>
<div class="line">    {</div>
<div class="line">        avl_cnt = 0;</div>
<div class="line">        <span class="keywordflow">for</span>(iter = start; iter &lt; ( start + req_cnt) ; iter++){</div>
<div class="line">            <span class="keywordflow">if</span>(<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_mem_bmap[iter&gt;&gt;5] &amp; (1 &lt;&lt; (31-(iter &amp; 0x1F))))</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">            avl_cnt++;</div>
<div class="line">        }</div>
<div class="line">       <span class="keywordflow">if</span>(avl_cnt == req_cnt){</div>
<div class="line">           available = 1;</div>
<div class="line">           <span class="keywordflow">break</span>;</div>
<div class="line">       }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span>(!available)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    </div>
<div class="line">    phy_addr = (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)<a class="code" href="mem__mng_8h.html#a1eb57881c30e2e9cd09692a212b44605" title="Allocates physical pages for the required size.">sw_phy_page_alloc</a>(size);</div>
<div class="line">    <span class="keywordflow">if</span>(phy_addr == 0){</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code" href="sw__types_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line">    }</div>
<div class="line">    </div>
<div class="line">    map_va = start;</div>
<div class="line">    </div>
<div class="line">    <span class="keywordflow">for</span>(cnt = 0;cnt &lt; req_cnt; cnt++)</div>
<div class="line">    {</div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_mem_bmap[(start+cnt) &gt;&gt; 5] </div>
<div class="line">               |= 0x1 &lt;&lt; (31 - ((start+cnt) &amp; 0x1F));</div>
<div class="line">        <a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.num_vir_pag_free--;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    vir_addr = ((start &lt;&lt; <a class="code" href="mem__mng_8h.html#a850d80ca2291d26b40dc6b25c419f81a">PAGE_SHIFT</a>) + (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>)<a class="code" href="mem__mng_8c.html#aa0a92d30027b97bf859f280f51bd16e0">sw_mem_info</a>.vir_addr_start);</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> sec_phy_addr = phy_addr;</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> sec_vir_addr = vir_addr;</div>
<div class="line"></div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> end_addr = ((phy_addr + size) &amp; <a class="code" href="mem__mng_8h.html#a16f225cca51a80c5cf1c9c002cfd2dba">SECTION_MASK</a>);</div>
<div class="line">    <a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a> start_addr = (phy_addr &amp; <a class="code" href="mem__mng_8h.html#a16f225cca51a80c5cf1c9c002cfd2dba">SECTION_MASK</a>);</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">while</span>(end_addr &gt;= start_addr){</div>
<div class="line">        <a class="code" href="page__table_8h.html#aa7920ee52ee57fc11fadc11928d92987">map_to_secure</a>(sec_phy_addr, sec_vir_addr);</div>
<div class="line">        size-= <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">        start_addr += <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">        sec_phy_addr += <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">        sec_vir_addr += <a class="code" href="mem__mng_8h.html#af736426da3c7639cf81900258bdd8a05">SECTION_SIZE</a>;</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">return</span> (<a class="code" href="sw__types_8h.html#a10e94b422ef0c20dcdec20d31a1f5049">u32</a>*)vir_addr;</div>
<div class="line">}</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a class="anchor" id="aa0a92d30027b97bf859f280f51bd16e0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct secure_world_mem_info sw_mem_info</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="mem__mng_8c_source.html#l00066">66</a> of file <a class="el" href="mem__mng_8c_source.html">mem_mng.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Jan 3 2013 00:33:52 by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.2
</small></address>
</body>
</html>
